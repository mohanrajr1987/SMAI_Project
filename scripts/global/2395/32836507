<p><strong>Background</strong></p>  <hr>  <p>I have an input table looks like:</p>  <p><a href="http://i.stack.imgur.com/pvra2.png" rel="nofollow"><img src="http://i.stack.imgur.com/pvra2.png" alt="input_table"></a></p>  <p>What I want to do is to sort each <code>name</code> by its <code>weight</code> for each <code>id</code> and <code>type</code>, and then reserve top 10 names and corresponding weights, cast them to string and concatenate them.  My output table should be like this: <a href="http://i.stack.imgur.com/MGPF2.png" rel="nofollow"><img src="http://i.stack.imgur.com/MGPF2.png" alt="output_table"></a></p>  <hr>  <p><strong>Analysis</strong></p>  <hr>  <p>If I write a map reduce program, the map key should be the <code>id</code>, and <code>type</code>, <code>name</code> and <code>weight</code> should be the map value. In the reducer, I can use a <code>HashMap</code> to put <code>type</code> as <code>K</code>, <code>name</code> and <code>weight</code> as <code>V</code> and then do some sorting and string concatenation things to fulfil my goal.</p>  <hr>  <p><strong>Question</strong></p>  <hr>  <p>But now I need to write a UDAF and use it with <code>group by id</code> to accomplish this. I'm new to UDAF and I want to know in each method (<code>init</code>, <code>iterate</code>, <code>merge</code>,  <code>terminate</code>) what should I do? Does <code>init</code> set the output field? And which part should do the sorting? Which part should do the string concatenation?</p>