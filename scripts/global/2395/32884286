<p>How can I calculate the quantile (ntile, or percentile) for a value, for each group of rows of the same item?</p>  <p>I would like to know for item '101', considering only the rows where 'p' is 1, which is the value needed to be in the top 25% for example.</p>  <pre><code>create table t1 (item INT, p INT, value FLOAT );  insert into t1 values ('101', '1', '.5'); insert into t1 values ('101', '2', '.4'); insert into t1 values ('101', '1', '.6'); insert into t1 values ('101', '2', '.2'); insert into t1 values ('101', '1', '.7'); insert into t1 values ('101', '2', '.3'); insert into t1 values ('102', '1', '1.5'); insert into t1 values ('102', '2', '1.4'); insert into t1 values ('102', '1', '1.6'); insert into t1 values ('102', '2', '1.2'); insert into t1 values ('102', '1', '1.7'); insert into t1 values ('102', '2', '1.3'); </code></pre>  <p>I have tried the following but get an error.</p>  <pre><code>SELECT      item,     p,     value, NTILE(4) OVER (ORDER BY value DESC) AS quartile FROM t1 group by item where p=1 </code></pre>  <p>Error message:</p>  <blockquote>   <p>Error while compiling statement: FAILED ParseException line 8:0   missing EOF at 'where' near item</p> </blockquote>  <p>I can do it in R, with a command like:</p>  <pre><code>d[p==1, quantile(value, .75, na.rm=TRUE), by=item] </code></pre>  <p>but I need this in Hadoop for performance reasons.</p>