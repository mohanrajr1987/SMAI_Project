<p>I am deploying my sinatra project via ansible, and one of the tasks is precompiling assets.</p>  <p>At first I stacked into question <a href="http://stackoverflow.com/questions/22115936/install-bundler-gem-using-ansible">how to initialize rbenv properly</a>.</p>  <p>Then, what I did is:</p>  <pre><code>- name: Precompiling assets   command: bash -lc "cd {{ build_path }} &amp;&amp; bundle exec rake assetpack:build" </code></pre>  <p>But then I got error <code>Encoding::UndefinedConversionError at assets/application.js</code></p>  <p>When I connected by ssh to server and run <code>bundle exec rake assetpack:build</code> - everything worked perfectly. So, I presumed, this is related to <a href="http://stackoverflow.com/questions/9525381/asset-pipeline-encoding-problems-utf-8-vs-ascii-8bit-with-external-gem">setting environment variables</a></p>  <p><code>lookup('env', 'LANG')</code> says it is <code>"msg": "ru_RU.UTF-8"</code> but echo $LANG says it's "C" (<a href="https://groups.google.com/forum/#!topic/ansible-project/XwJmFPfMfo0" rel="nofollow">look there</a>).</p>  <p>Look to <a href="https://github.com/ansible/ansible/issues/7060" rel="nofollow">this issue</a>. It says:</p>  <blockquote>   <p>Ansible sets LANG to C on modules which don't need it</p> </blockquote>  <p>Ansible modules set "$LANG=C" automatically.</p>  <p>Adding environment variable <em>didn't give desired result</em>:</p>  <pre><code>environment:   LANG: ru_RU.UTF-8 command: bash -lc "cd {{ build_path }} &amp;&amp; bundle exec rake assetpack:build" </code></pre>  <p>At the same time shell module seem to know nothing about <code>bundle</code>, so <em>this didn't work</em> as well:</p>  <pre><code>- name: Precompiling assets   command: bash -lc "cd {{ build_path }} &amp;&amp; bundle exec rake assetpack:build" </code></pre>  <p>I tried huge bunch of commands, such as <code>export LANG=ru_RU.UTF-8</code>, <code>command</code> module, <code>shell</code> module, but nothing helps, all my attempts failed miserably.</p>  <p>I do not really know how to workaround this issue.</p>  <p>Need help!</p>