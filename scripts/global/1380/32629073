<p>I am writing some tests with phpunit for several classes. each of the classes has the following method:</p>  <pre><code>  function getDbh() {     if ($this-&gt;dbh === null){       $this-&gt;dbh = Slim::getInstance()-&gt;db-&gt;getConnection();     }     return $this-&gt;dbh;   } </code></pre>  <p>but the problem is that after the first test slim create this Environment singleton that i have no clue i can i use in following tests.</p>  <p>to make my specific issue a bit clearer, each of my test classes has this method:</p>  <pre><code>public function testGetDbh_dbhIsNull() {     $fixture = new testedClass();      $app = new Slim();     $DB = $this-&gt;getMockBuilder('DB')                  -&gt;disableOriginalConstructor()                  -&gt;getMock();     $DB-&gt;method('getConnection')-&gt;willReturn('connection');     $app-&gt;db = $DB;      $this-&gt;assertEquals($fixture-&gt;getDbh(), 'connection'); } </code></pre>  <p>but from the second test, the test fails due to the following error:</p>  <pre><code>1) GroupTest::testSlim Failed asserting that 'connection' matches expected null. </code></pre>  <p>any idea how can i use the Slim singleton in each of the tests? thx</p>