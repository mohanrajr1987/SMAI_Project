<p>I've got a frustration here. Folders with static files:</p>  <pre><code> /home/jenkins/shared/images/    /project       /folder         EyZvhbPJg.jpg         EyZvhbPJg.jpg?width=200.jpg </code></pre>  <p>Nginx backend configuration</p>  <pre><code>    location @render {        rewrite ^ /img$target break;        proxy_pass http://127.0.0.1:3001;     } </code></pre>  <p>Imagine a URL /images/project/folder/EyZvhbPJg.jpg?width=200</p>  <p>The logic is. If file is not found, @render location is triggered (which creates the files - resizes or does whatever's needed)</p>  <p>After that, the file is served by nginx. The problem is $args and $ext Theoretically the target path for nginx should look like this:</p>  <pre><code> /home/jenkins/shared/images/$uri?$args$ext </code></pre>  <p>There has to be a condition, if $args are not set, ?$args should ignored along with $ext</p>  <p>I tried many possible variations, but it does not seem to work. Something  gets broken in the middle. It turns out i cannot use if conditions and alias.</p>  <pre><code>  location ~ ^\/images(?&lt;target&gt;.*\.(?&lt;ext&gt;jpg|png|jpeg|gif).*) {        try_files /cached @render;     }     location ~ ^\/cached(?&lt;target&gt;.*(?&lt;ext&gt;\.jpg|\.png|\.jpeg|\.gif).*) {          alias /home/jenkins/shared/images/$target?$args$ext;     }      location @render {        rewrite ^ /img$target break;        proxy_pass http://127.0.0.1:3001;     }     location / {         proxy_pass          http://127.0.0.1:3001;     } </code></pre>  <p>Any hints or directions are greatly appreciated! Thanks in advance!</p>