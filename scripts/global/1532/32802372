<p>I tried to generate xsd from 2 xml documents. In those 2 xml documents, there are some simple elements (<code>&lt;SubTotal&gt;</code> and <code>&lt;Tax&gt;</code>) and complex type element (<code>&lt;SubTotals&gt;</code>) are optional; that means they may be present or absent from XML documents. Below are 2 sample XML documents and 1 broken xsd document.</p>  <p>I generated xsd document, but it did not work well. By using generated xsd document, when I validated XML documents, the first XML document was valid but the second xml document was not. <strong>I want that the xsd should work well with both XML documents</strong>. The xml data in those 2 xml documents are valid.</p>  <p>In the first xml document, optional simple type <code>&lt;SubTotal&gt;</code> and <code>&lt;Tax&gt;</code> elements are <strong>present</strong>, but optional complex type <code>&lt;SubTotals&gt;</code> element is <strong>absent</strong>.  </p>  <p>In the second xml document, optional complex type <code>&lt;SubTotals&gt;</code> element is <strong>present</strong>, but 2 optional simple type <code>&lt;SubTotal&gt;</code> and <code>&lt;Tax&gt;</code> elements are <strong>absent</strong>.</p>  <p>The following is the 1st xml document. Is was validated <strong>successfully</strong>.  </p>  <pre><code>&lt;ReceiptMessage&gt;   &lt;DeviceId&gt;AA-BB-CC-DD-EE-FF&lt;/DeviceId&gt;   &lt;From&gt;temp@somewhere.com&lt;/From&gt;   &lt;To&gt;abc@xyz.com&lt;/To&gt;   &lt;Subject&gt;Your Receipt  - Version 1&lt;/Subject&gt;   &lt;OptIn&gt;255&lt;/OptIn&gt;   &lt;Receipt&gt;     &lt;CheckNo&gt;13254&lt;/CheckNo&gt;     &lt;TableId&gt;1&lt;/TableId&gt;     &lt;ReceiptDate&gt;2015-09-23T11:20:00&lt;/ReceiptDate&gt;     &lt;Server&gt;Joy Server&lt;/Server&gt;     &lt;CardNo&gt;48757-Loyalty&lt;/CardNo&gt;     &lt;PaymentMode&gt;Credit Card&lt;/PaymentMode&gt;     &lt;ReceiptHeader&gt;       &lt;string&gt;Some Header 1&lt;/string&gt;       &lt;string&gt;Some header 2&lt;/string&gt;     &lt;/ReceiptHeader&gt;     &lt;SubTotal&gt;35.00&lt;/SubTotal&gt;     &lt;Tax&gt;1.00&lt;/Tax&gt;     &lt;Total&gt;36.00&lt;/Total&gt;     &lt;Gratuity&gt;2.00&lt;/Gratuity&gt;     &lt;SplitCheckTotal&gt;38.00&lt;/SplitCheckTotal&gt;     &lt;Tip&gt;1.50&lt;/Tip&gt;     &lt;AmountPaid&gt;39.50&lt;/AmountPaid&gt;     &lt;ReceiptItems&gt;       &lt;ReceiptItem&gt;         &lt;ItemName&gt;Pizza Hut ABC&lt;/ItemName&gt;         &lt;Qty&gt;2&lt;/Qty&gt;         &lt;Price&gt;4.00&lt;/Price&gt;       &lt;/ReceiptItem&gt;       &lt;ReceiptItem&gt;         &lt;ItemName&gt;Burito 289&lt;/ItemName&gt;         &lt;Qty&gt;1&lt;/Qty&gt;         &lt;Price&gt;8.35&lt;/Price&gt;       &lt;/ReceiptItem&gt;     &lt;/ReceiptItems&gt;     &lt;ReceiptFooter&gt;       &lt;string&gt;Thank you for your shopping at our site&lt;/string&gt;       &lt;string&gt;Please come back&lt;/string&gt;     &lt;/ReceiptFooter&gt;     &lt;ReceiptSurvey&gt;       &lt;string&gt;Survey 1 content&lt;/string&gt;       &lt;string&gt;Survey - go to our site and register for sweeptakes&lt;/string&gt;     &lt;/ReceiptSurvey&gt;   &lt;/Receipt&gt; &lt;/ReceiptMessage&gt; </code></pre>  <p>The following is the 2nd xml document. Is was <strong>not valid</strong>.</p>  <pre><code>&lt;ReceiptMessage&gt;   &lt;DeviceId&gt;AA-BB-CC-DD-EE-FF&lt;/DeviceId&gt;   &lt;From&gt;temp@somedomain.com&lt;/From&gt;   &lt;To&gt;abc@somedomain.com&lt;/To&gt;   &lt;Subject&gt;Your Receipt from XYZ- Version 2&lt;/Subject&gt;   &lt;OptIn&gt;255&lt;/OptIn&gt;   &lt;Receipt&gt;     &lt;CheckNo&gt;17282&lt;/CheckNo&gt;     &lt;TableId&gt;Table ABC&lt;/TableId&gt;     &lt;ReceiptDate&gt;2015-09-23T16:32:59.4561339-05:00&lt;/ReceiptDate&gt;     &lt;Server&gt;John Doe&lt;/Server&gt;     &lt;CardNo&gt;2920202&lt;/CardNo&gt;     &lt;PaymentMode&gt;Credit Card&lt;/PaymentMode&gt;     &lt;ReceiptHeader&gt;       &lt;string&gt;Header 1&lt;/string&gt;       &lt;string&gt;Header 2&lt;/string&gt;     &lt;/ReceiptHeader&gt;     &lt;SubTotals&gt;       &lt;SubtotalItem Label="Subtotal"&gt;25.00&lt;/SubtotalItem&gt;       &lt;SubtotalItem Label="Sales Tax"&gt;3.00&lt;/SubtotalItem&gt;       &lt;SubtotalItem Label="City Tax"&gt;1.15&lt;/SubtotalItem&gt;       &lt;SubtotalItem Label="County Tax"&gt;2.25&lt;/SubtotalItem&gt;       &lt;SubtotalItem Label="State Tax"&gt;1.25&lt;/SubtotalItem&gt;     &lt;/SubTotals&gt;     &lt;Total&gt;32.65&lt;/Total&gt;     &lt;Gratuity&gt;2.00&lt;/Gratuity&gt;     &lt;SplitCheckTotal&gt;0.5&lt;/SplitCheckTotal&gt;     &lt;Tip&gt;3.00&lt;/Tip&gt;     &lt;AmountPaid&gt;38.15&lt;/AmountPaid&gt;     &lt;ReceiptItems&gt;       &lt;ReceiptItem&gt;         &lt;ItemName&gt;Pizza&lt;/ItemName&gt;         &lt;Qty&gt;1&lt;/Qty&gt;         &lt;Price&gt;5.32&lt;/Price&gt;       &lt;/ReceiptItem&gt;       &lt;ReceiptItem&gt;         &lt;ItemName&gt;Burito&lt;/ItemName&gt;         &lt;Qty&gt;2&lt;/Qty&gt;         &lt;Price&gt;10.99&lt;/Price&gt;       &lt;/ReceiptItem&gt;     &lt;/ReceiptItems&gt;     &lt;ReceiptFooter&gt;       &lt;string&gt;Footer 1&lt;/string&gt;       &lt;string&gt;Footer 2&lt;/string&gt;     &lt;/ReceiptFooter&gt;     &lt;ReceiptSurvey&gt;       &lt;string&gt;Go to our site to register and win awards to&lt;/string&gt;     &lt;/ReceiptSurvey&gt;   &lt;/Receipt&gt; &lt;/ReceiptMessage&gt; </code></pre>  <p>I would like to have a correct version for the following generated xsd. It should work with those 2 XML documents.</p>  <pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt; &lt;xs:schema elementFormDefault="qualified" xmlns:xs="http://www.w3.org/2001/XMLSchema"&gt;   &lt;xs:element name="ReceiptMessage" nillable="true" type="ReceiptMessage" /&gt;   &lt;xs:complexType name="ReceiptMessage"&gt;     &lt;xs:complexContent mixed="false"&gt;       &lt;xs:extension base="EmailParams"&gt;         &lt;xs:sequence&gt;           &lt;xs:element minOccurs="1" maxOccurs="1" name="OptIn" type="xs:unsignedByte" /&gt;           &lt;xs:element minOccurs="0" maxOccurs="1" name="Receipt" type="ReceiptData" /&gt;         &lt;/xs:sequence&gt;       &lt;/xs:extension&gt;     &lt;/xs:complexContent&gt;   &lt;/xs:complexType&gt;   &lt;xs:complexType name="EmailParams"&gt;     &lt;xs:sequence&gt;       &lt;xs:element minOccurs="0" maxOccurs="1" name="DeviceId" type="xs:string" /&gt;       &lt;xs:element minOccurs="0" maxOccurs="1" name="From" type="xs:string" /&gt;       &lt;xs:element minOccurs="0" maxOccurs="1" name="To" type="xs:string" /&gt;       &lt;xs:element minOccurs="0" maxOccurs="1" name="Subject" type="xs:string" /&gt;     &lt;/xs:sequence&gt;   &lt;/xs:complexType&gt;   &lt;xs:complexType name="ReceiptData"&gt;     &lt;xs:sequence&gt;       &lt;xs:element minOccurs="0" maxOccurs="1" name="CheckNo" type="xs:string" /&gt;       &lt;xs:element minOccurs="0" maxOccurs="1" name="TableId" type="xs:string" /&gt;       &lt;xs:element minOccurs="1" maxOccurs="1" name="ReceiptDate" type="xs:dateTime" /&gt;       &lt;xs:element minOccurs="0" maxOccurs="1" name="Server" type="xs:string" /&gt;       &lt;xs:element minOccurs="0" maxOccurs="1" name="CardNo" type="xs:string" /&gt;       &lt;xs:element minOccurs="0" maxOccurs="1" name="PaymentMode" type="xs:string" /&gt;       &lt;xs:element minOccurs="0" maxOccurs="1" name="ReceiptHeader" type="ArrayOfString" /&gt;       &lt;xs:element minOccurs="1" maxOccurs="1" name="SubTotal" nillable="true" type="xs:double" /&gt;       &lt;xs:element minOccurs="1" maxOccurs="1" name="Tax" nillable="true" type="xs:double" /&gt;       &lt;xs:element minOccurs="0" maxOccurs="1" name="SubTotals" type="ArrayOfSubtotalItem" /&gt;       &lt;xs:element minOccurs="1" maxOccurs="1" name="Total" type="xs:double" /&gt;       &lt;xs:element minOccurs="1" maxOccurs="1" name="Gratuity" type="xs:double" /&gt;       &lt;xs:element minOccurs="1" maxOccurs="1" name="SplitCheckTotal" type="xs:double" /&gt;       &lt;xs:element minOccurs="1" maxOccurs="1" name="Tip" type="xs:double" /&gt;       &lt;xs:element minOccurs="1" maxOccurs="1" name="AmountPaid" type="xs:double" /&gt;       &lt;xs:element minOccurs="0" maxOccurs="1" name="ReceiptItems" type="ArrayOfReceiptItem" /&gt;       &lt;xs:element minOccurs="0" maxOccurs="1" name="ReceiptFooter" type="ArrayOfString" /&gt;       &lt;xs:element minOccurs="0" maxOccurs="1" name="ReceiptSurvey" type="ArrayOfString" /&gt;     &lt;/xs:sequence&gt;   &lt;/xs:complexType&gt;   &lt;xs:complexType name="ArrayOfString"&gt;     &lt;xs:sequence&gt;       &lt;xs:element minOccurs="0" maxOccurs="unbounded" name="string" nillable="true" type="xs:string" /&gt;     &lt;/xs:sequence&gt;   &lt;/xs:complexType&gt;   &lt;xs:complexType name="ArrayOfSubtotalItem"&gt;     &lt;xs:sequence&gt;       &lt;xs:element minOccurs="0" maxOccurs="unbounded" name="SubtotalItem" nillable="true" type="SubtotalItem" /&gt;     &lt;/xs:sequence&gt;   &lt;/xs:complexType&gt;   &lt;xs:complexType name="SubtotalItem"&gt;     &lt;xs:simpleContent&gt;       &lt;xs:extension base="xs:double"&gt;         &lt;xs:attribute name="Label" type="xs:string" /&gt;       &lt;/xs:extension&gt;     &lt;/xs:simpleContent&gt;   &lt;/xs:complexType&gt;   &lt;xs:complexType name="ArrayOfReceiptItem"&gt;     &lt;xs:sequence&gt;       &lt;xs:element minOccurs="0" maxOccurs="unbounded" name="ReceiptItem" nillable="true" type="ReceiptItem" /&gt;     &lt;/xs:sequence&gt;   &lt;/xs:complexType&gt;   &lt;xs:complexType name="ReceiptItem"&gt;     &lt;xs:sequence&gt;       &lt;xs:element minOccurs="0" maxOccurs="1" name="ItemName" type="xs:string" /&gt;       &lt;xs:element minOccurs="1" maxOccurs="1" name="Qty" type="xs:double" /&gt;       &lt;xs:element minOccurs="1" maxOccurs="1" name="Price" type="xs:double" /&gt;     &lt;/xs:sequence&gt;   &lt;/xs:complexType&gt; &lt;/xs:schema&gt; </code></pre>  <p><em>I use the following free online tool to validate my XML documents based on generated XSD:</em></p>  <p><a href="http://www.freeformatter.com/xml-validator-xsd.html" rel="nofollow">http://www.freeformatter.com/xml-validator-xsd.html</a></p>