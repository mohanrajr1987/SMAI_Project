<p>I have created a Symfony 2 Bundle that supports private messages between users. I gave them the ability to send messages from their <code>inbox</code> or <code>sent</code> folder to the <code>trash</code> one. Messages will be marked as trash through the <code>isRTrash</code> and <code>isSTrash</code> fields, marked by receiver and by sender, respectively. That is because, being the same message in my database, if I had one single field here, one user marking it as trash, would mark it for the other one, as well. </p>  <p>Now, I want to give them the possibility to <code>delete</code> them, too, from their trash folder. Messages won't be deleted, but marked similarly to trash ones, just that they are forever gone from standard user view. I'm having problems with marking them like this, because I have to mark both messages that are sent and received by the user.</p>  <p>I've made the following query in the entity's repository:</p>  <pre><code>    public function delete($user, $msg)     {         $qb = $this-&gt;createQueryBuilder('a')             -&gt;update('PrivateMessageBundle:Message', 'a')             -&gt;where('a IN(:msg)')             -&gt;andwhere('a.receiver = :user AND a.isRTrash IS NOT null AND a.isRDeleted = false')-&gt;set('a.isRDeleted', true)             -&gt;orWhere('a.sender = :user AND a.isSTrash IS NOT null AND a.isSDeleted = false')-&gt;set('a.isSDeleted', true)             -&gt;setParameters(                 array('user' =&gt; $user, 'msg' =&gt; $msg)             ); echo '&lt;pre&gt;'; \Doctrine\Common\Util\Debug::dump($qb-&gt;getQuery()-&gt;getSQL()); exit; echo '&lt;/pre&gt;';         return $qb-&gt;getQuery();     } </code></pre>  <p>And the output query is <code>string(196) "UPDATE message SET isRDeleted = 1, isSDeleted = 1 WHERE (id IN (?) AND (receiver_id = ? AND isRTrash IS NOT NULL AND isRDeleted = 0)) OR (sender_id = ? AND isSTrash IS NOT NULL AND isSDeleted = 0)"</code></p>  <p>I give as input the curent logged in user and an array of message id's. Then, I check messages that are in trash, are not marked as deleted and have the curent user as receiver or sender and want to mark them as deleted.</p>  <p>The problem is that both conditions are met, and both <code>SET</code> are being called, marking a message's <code>isRDeleted</code> and <code>isSDeleted</code> to true, regardless.</p>  <p>I am very close, but don't know how to make it so that the fields are marked separately, only if their condition is met.</p>  <p>Meanwhile, I'm using a foreach loop, but I think it can be done faster with a query</p>  <pre><code>   $em = $this-&gt;getDoctrine()-&gt;getManager();     foreach ($msgs as $msgid) {         $msg = $messages-&gt;findOneBy(array('id' =&gt; $msgid));           if ($msg-&gt;getSender() == $this-&gt;getUser() &amp;&amp; $msg-&gt;getIsSTrash() &amp;&amp; $msg-&gt;getIsSDeleted() == false) {             $msg-&gt;setIsSDeleted(true);             $changedno++;         } else if ($msg-&gt;getReceiver() == $this-&gt;getUser() &amp;&amp; $msg-&gt;getIsRTrash() &amp;&amp; $msg-&gt;getIsRDeleted() == false) {             $msg-&gt;setIsRDeleted(true);             $changedno++;         }          $em-&gt;flush();     } </code></pre>