<p>Is it possible to use the Haswell CPU feature PEBS (Precise Event Based Sampling) directly from a Linux userspace process instead of using a kernel interface?</p>  <p>I have succeeded in accessing performance counters from userspace using the RDPMC instruction and only using the kernel for WRMSR. This makes me very happy.</p>  <p>Now I want to also access PEBS. To do this I need to use the MSR IA32_DS_AREA to supply a "debug store" memory area. However, I am not sure how to allocate this memory and what address I need to use. I can allocate 2MB of contiguous physical memory (Linux HugeTLB with mlock()). I can also resolve the physical address of this memory (via procfs). However, I am not sure whether either the virtual or physical address is suitable as the "linear address" to supply for the MSR. (My concern is that the address may have to be in the kernel's virtual address space that I don't have access to.)</p>  <p>How can I prepare suitable memory for IA32_DS_AREA and logging PEBS events without writing a custom kernel module?</p>