<p>Given an xml file in a recursive/hierarchical format like this:</p>  <p><em>taxonomy.xml</em></p>  <pre class="lang-xml prettyprint-override"><code>&lt;taxonomy&gt;   &lt;record code="B"&gt;     &lt;name&gt;Basic Needs&lt;/name&gt;         &lt;facet&gt;Service&lt;/facet&gt;     &lt;record code="BD"&gt;       &lt;name&gt;Food&lt;/name&gt;       &lt;facet&gt;Service&lt;/facet&gt;       &lt;record code="BD-1800"&gt;         &lt;name&gt;Emergency Food&lt;/name&gt;         &lt;facet&gt;Service&lt;/facet&gt;         &lt;record code="BD-1800.1000"&gt;           &lt;name&gt;Brown Bag Food Programs&lt;/name&gt;           &lt;facet&gt;Service&lt;/facet&gt;         &lt;/record&gt;         &lt;record code="BD-1800.1500"&gt;           &lt;name&gt;Commodity Supplemental Food Program&lt;/name&gt;           &lt;facet&gt;Named Programs&lt;/facet&gt;         &lt;/record&gt;         &lt;record code="BD-1800.1900"&gt;           &lt;name&gt;Food Lines&lt;/name&gt;           &lt;facet&gt;Service&lt;/facet&gt;         &lt;/record&gt;         ...       &lt;/record&gt;       ...      &lt;/record&gt;     ...   &lt;/record&gt;   &lt;record code="D"&gt;     &lt;name&gt;Consumer Services&lt;/name&gt;         &lt;facet&gt;Service&lt;/facet&gt;     ...   &lt;/record&gt;   ... &lt;/taxonomy&gt; </code></pre>  <p>Is there a way to use T-SQL to load and flatten the structure into a tabular format like this:</p>  <ul> <li>code</li> <li>name</li> <li>facet</li> <li>depth (the depth in the hierarchy)</li> </ul>  <p>For example, the desired result for the XML above would be:</p>  <p><img src="http://i.imgur.com/Atk9BSW.png" alt="table"></p>  <p>I've written a little console application to do this after failing to come up with the correct SQL but I can't help thinking there's an easier way.</p>  <p>Here's a SQL Fiddle with the xml: <a href="http://sqlfiddle.com/#!6/9eecb7/3265/0" rel="nofollow">http://sqlfiddle.com/#!6/9eecb7/3265/0</a></p>