<p>I'm quite new to SQL Server and am having trouble coming up with a solution to this. My query aggregates total numbers of leavers and achievers by Area and Ethnicity, dividing achievers by leavers to give a success rate. I want to show the difference between the success rate for White British and BME within each Area grouping. My plan is to use this value to highlight Areas where the difference between the ethnicities is greater than (for example) 5%. </p>  <p>The data source for the query is an excel sheet of ~20,000 rows</p>  <pre><code>SELECT  [AssDir Name] AS Area,  Ethnicity2 AS Ethnicity,  SUM([Leavers Overall]) AS Leavers,   SUM([Ach Overall]) AS Achievers,  SUM([Ach Overall]) / NULLIF (SUM([Leavers Overall]), 0) * 100 AS Success  FROM Sheet1$  GROUP BY [AssDir Name], Ethnicity2 ORDER BY [AssDir Name],  CASE WHEN [Ethnicity2]='White British' THEN '1' ELSE [Ethnicity2] END </code></pre>  <p>It produces the first five columns like this - I want to be able to add the Difference column:</p>  <pre><code>    Area    Ethnicity       Leavers Achievers   Success      Difference     ====================================================================             ABC     White British   325     253         77.84615385  3.234927235     ABC     BME             111     90          81.08108108  3.234927235     ABC     Not Provided    7       5           71.42857143  3.234927235     DEF     White British   291     196         67.35395189  -13.11666375     DEF     BME             59      32          54.23728814  -13.11666375     DEF     Not Provided    1       1           100          -13.11666375     GHI     White British   684     578         84.50292398  4.487901711     GHI     BME             109     97          88.99082569  4.487901711     GHI     Not Provided    2       2           100          4.487901711 </code></pre>  <p>It's getting it to work within the groups that's causing the headache - this does it for all Areas but I can't see a way to adapt it so that it works when Area is a grouped column:</p>  <pre><code>SELECT   Ethnicity2 AS Ethnicity,  SUM([Leavers Overall]) AS Leavers,  SUM([Completed Overall]) AS Completers,  SUM([Ach Overall]) AS Achievers,  SUM([Ach Overall]) / NULLIF (SUM([Leavers Overall]), 0) * 100 AS Success, (SELECT          SUM([Ach Overall]) / NULLIF (SUM([Leavers Overall]), 0) * 100          FROM Sheet1$          WHERE Ethnicity2 = 'BME'         GROUP BY  Ethnicity2) - (SELECT          SUM([Ach Overall]) / NULLIF (SUM([Leavers Overall]), 0) * 100          FROM Sheet1$          WHERE Ethnicity2 = 'White British'         GROUP BY  Ethnicity2) AS Diff  FROM Sheet1$ GROUP BY  Ethnicity2  </code></pre>  <p>Sorry about the length, hopefully there's an elegant solution that I'm missing but hours of googling/searching has drawn a blank.</p>