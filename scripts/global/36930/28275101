<p>I am trying to place a recent pages widget on wordpress. i created the js myself. on IE7 it always breaks. I have included <code>json2</code>,<code>json3</code>,<code>prototype.js</code>.</p>  <p>my code is below</p>  <pre><code>var newRecentlyViewed = function(opts) {     var that = {};     var opts = opts || {};     var cookieName = opts.cookieName || 'recently-viewed';     var popupId = opts.popupId || 'recently-viewed-popup';     var maxRecent = opts.maxRecent || 5;     var cookieLifeHours = opts.cookieLifeHours || (24 * 0 * 0); /* 24 hours * 30 days * 24 months = 2 years */      var futureDate = function(nHours) {         var expire = null;         if (nHours != null &amp;&amp; nHours != 0) {             var today = new Date();             expire = new Date();             expire.setTime(today.getTime() + 3600000 * nHours);         }         return expire;     };      var setCookie = function(name, value, path, domain, secure, nHours) {         var expires = futureDate(nHours);         var curCookie = name + "=" + escape(value)                 + ((path) ? "; path=" + path : "")                 + ((domain) ? "; domain=" + domain : "")                 + ((expires) ? "; expires=" + expires : "")                 + ((secure) ? "; secure" : "");         document.cookie = curCookie;     };      var getCookie = function(name) {         var dc = document.cookie;         var prefix = name + "=";         var begin = dc.indexOf("; " + prefix);         if (begin == -1) {             begin = dc.indexOf(prefix);             if (begin != 0)                 return null;         } else {             begin += 2;         }         var end = document.cookie.indexOf(";", begin);         if (end == -1) {             end = dc.length;         }         return unescape(dc.substring(begin + prefix.length, end));     };      var recent = function() {         var cookie = getCookie(cookieName);         var recentlyViewed = [];         if (cookie != null) {             recentlyViewed = cookie.evalJSON();         }         return recentlyViewed;     };      var remember = function(recentObj, uniqueKey) {         var recently = recent();         var now = new Date();         now = now.getTime();         var i;         var dup_idx = -1;         for (i = 0; i &lt; recently.length; i += 1) {             if (recently[i][uniqueKey] == recentObj[uniqueKey])                 dup_idx = i;         }         if (dup_idx &gt; -1)             recently.splice(dup_idx, 1);         recently.push(recentObj);         if (recently.length &gt; maxRecent) {             recently.splice(0, recently.length - maxRecent);         }         setCookie(cookieName, JSON.stringify(recently), "/", document.domain, false,                 cookieLifeHours);     };      /* Public functions are assigned to that */      that.rememberPage = function(obj) {         if (obj == null) {             obj = {                 url : '' + document.location,                 title : document.title             };         }         remember(obj, 'url');     };      that.toggleDisplayPopup = function() {         if ($(popupId).style.display != 'inline') {             $(popupId).style.display = 'inline';         } else {             $(popupId).style.display = 'none';         }     };      that.renderPopup = function() {         var recentlyViewed = recent();         var s, i;         var url = top.location.href;         if (url.search(/multi-client-data-library/i) &lt; 1) {             var recentlyViewedItemsContainer = $$("#" + popupId + " .recently-viewed-items")[0];             if(jQuery(recentlyViewedItemsContainer).length){                 var recentlyViewedItems = recentlyViewedItemsContainer.select(".item");                 /* remove any existing div.item */                 for (i = 0; i &lt; recentlyViewedItems.length; i++) {                     recentlyViewedItems[i].remove();                 }                 for (i = 0; i &lt; recentlyViewed.length; i++) {                                    var recently = recentlyViewed[i];                     var title = recently.title.substring(0, recently.title.length - 15);                     if(title.length &gt; 30) title = title.substring(0,27) + "... ";                     s = "&lt;div class=\"item\"&gt;&lt;a href=\"" + recently.url + "\"&gt;"                             + title + "&lt;/a&gt;&lt;/div&gt;";                     recentlyViewedItemsContainer.insert({                         top : s                     });                 }             }         }     };      that.clear = function() {         setCookie(cookieName, JSON.stringify([]), "/", document.domain, false,                 cookieLifeHours);         that.renderPopup();     };      that.onload = function() {         that.rememberPage(); /* accessing a public function from a public function require that.*/         that.renderPopup();     };      return that; }; </code></pre>  <p>My <a href="http://www.spectrumasa.com" rel="nofollow">current</a> site seems to work fine. if you browse to some of the pages with recent pages widgt on right hand side in IE7 you will see there are no errors. if you browse to <a href="https://gateway.spectrumasa.com:10443/investors/shareholder-information/trading" rel="nofollow">developing</a> site it does not work.</p>  <p><img src="http://i.stack.imgur.com/YlExV.png" alt="ie7 screenshot"></p>  <p>I have reverted back to <code>prototype.js</code> <code>v1.6.1</code>. JSON is not complaining anymore, however my code breaks which does not make sense as nothing has been changed from live version. also i get an error in <code>prototype.js</code></p>  <pre><code>Object doesn't support property or method 'getElementsByClassName' </code></pre>