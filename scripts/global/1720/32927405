<p>I am getting an <code>Image</code> in the <code>YUV_420_888</code> format as the result of a capture using the <code>Camera2</code> APIs. I need to convert the image to the RGB format, but the colors of the resulting image are wrong.</p>  <p><a href="http://i.stack.imgur.com/TL4qf.jpg" rel="nofollow"><img src="http://i.stack.imgur.com/TL4qf.jpg" alt="enter image description here"></a></p>  <p>This is the function that performs the conversion, using OpenCV:</p>  <pre><code>@TargetApi(Build.VERSION_CODES.KITKAT)     public static Bitmap createBitmapFromYUV420(Image image) {         Image.Plane[] planes = image.getPlanes();          byte[] imageData = new byte[image.getWidth() * image.getHeight() * ImageFormat.getBitsPerPixel(ImageFormat.YUV_420_888) / 8];          ByteBuffer buffer = planes[0].getBuffer();         int lastIndex = buffer.remaining();         buffer.get(imageData, 0, lastIndex);         int pixelStride = planes[1].getPixelStride();          for (int i = 1; i &lt; planes.length; i++) {             buffer = planes[i].getBuffer();             byte[] planeData = new byte[buffer.remaining()];             buffer.get(planeData);              for (int j = 0; j &lt; planeData.length; j += pixelStride) {                 imageData[lastIndex++] = planeData[j];             }         }          Mat yuvMat = new Mat(image.getHeight() + image.getHeight() / 2, image.getWidth(), CvType.CV_8UC1);         yuvMat.put(0, 0, imageData);          Mat rgbMat = new Mat();         Imgproc.cvtColor(yuvMat, rgbMat, Imgproc.COLOR_YUV420p2RGBA);          Bitmap bitmap = Bitmap.createBitmap(rgbMat.cols(), rgbMat.rows(), Bitmap.Config.ARGB_8888);         Utils.matToBitmap(rgbMat, bitmap);          return bitmap;     } </code></pre>  <p>I think that the way the bytes from the 3 planes are appended into the byte array is correct, so perhaps the error is somewhere else?</p>  <hr>  <p><strong>SOLVED</strong></p>  <p>Apparently, there is a bug in Android API 21 that causes the U and V arrays to be full of 0 except for a few bytes, resulting in a green image.  This issue has been fixed with API 22.</p>