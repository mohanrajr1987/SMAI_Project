<p>What would be the simplest example of sending an expression to ghci via its api for evaluation and printing the result? I am not able to find a complete example that would work. Yes, I have tried <a href="https://wiki.haskell.org/GHC/As_a_library">https://wiki.haskell.org/GHC/As_a_library</a> but I keep getting errors that do not tell me much: <code>no package state yet: call GHC.setSessionDynFlags</code>. Wherever I try <code>setSessionDynFlags</code> with whatever arguments, or <code>setContext</code>, I always end up with an error. I currently have (no <code>setXYZ</code>):</p>  <pre><code>import GHC import GHC.Paths ( libdir ) import GhcMonad import Debugger import DynFlags import Outputable import Language.Haskell.HsColour import Language.Haskell.HsColour.Colourise  colour :: String -&gt; String colour = hscolour TTY defaultColourPrefs True True "" False  ghci :: IO () ghci = runGhc (Just libdir) $ do     r &lt;- runStmt "[1, 2, 3]" RunToCompletion     case r of         RunOk ns -&gt; do             mapM_ ( \n -&gt; do                   mty &lt;- lookupName n                   case mty of                       Just (AnId id) -&gt; do                           t  &lt;- obtainTermFromId maxBound True id                           fl &lt;- getSessionDynFlags                           liftIO $ putStrLn $ colour $ show $ withPprStyleDoc fl defaultUserStyle $ ppr t                           return ()                       otherwise -&gt; return ()                   ) ns         otherwise -&gt; return ()  main :: IO () main = ghci </code></pre>