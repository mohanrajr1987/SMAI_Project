<p>Imagine you have a tree representing a family that you want to persist to tables, but preserve nesting levels. I'd like to get the post data below into the structure underneath. </p>  <p>I believe a RecursiveIterator might be the way to do this, but I am not sure how I would do so. I have code that works for most cases, but it has become an ugly, bloated thing. I can post that if you'd like. </p>  <pre><code>stdClass Object (     [name] =&gt; Smith     [type] =&gt; Family     [children] =&gt; Array(             [1] =&gt; stdClass Object                 (                     [name] =&gt; Michael                     [type] =&gt; Uncle                     [children] =&gt; Array(                             [0] =&gt; stdClass Object                                 (                                     [name] =&gt; Jared                                     [type] =&gt; cousin                                 )                         )                 )             [2] =&gt; stdClass Object                 (                     [name] =&gt; Jeff                     [type] =&gt; Dad                     [children] =&gt; Array(                             [0] =&gt; stdClass Object                                 (                                     [name] =&gt; Jonas                                     [type] =&gt; self                                 )                             [1] =&gt; stdClass Object                                 (                                     [name] =&gt; Leah                                     [type] =&gt; sister                                     [children] =&gt; Array(                                             [0] =&gt; stdClass Object                                                 (                                                     [name] =&gt; Jacob                                                     [type] =&gt; nephew                                                 )                                         )                                 )                         )                 )         ) ) </code></pre>  <p>The records for persistence should look like this:</p>  <pre><code>Array (     stdClass Object ( [name] =&gt; Smith [type] =&gt; Family [subgroup] =&gt; 0 [parent_subgroup] =&gt; )     stdClass Object ( [name] =&gt; Michael [type] =&gt; Uncle [subgroup] =&gt; 1 [parent_subgroup] =&gt; 0 )     stdClass Object ( [name] =&gt; Jared [type] =&gt; Cousin [subgroup] =&gt; 2 [parent_subgroup] =&gt; 1 )     stdClass Object ( [name] =&gt; Jeff [type] =&gt; Dad [subgroup] =&gt; 1 [parent_subgroup] =&gt; 0 )     stdClass Object ( [name] =&gt; Jonas [type] =&gt; self [subgroup] =&gt; 3 [parent_subgroup] =&gt; 1 )     stdClass Object ( [name] =&gt; Leah [type] =&gt; sister [subgroup] =&gt; 3 [parent_subgroup] =&gt; 1 )     stdClass Object ( [name] =&gt; Jacob [type] =&gt; nephew [subgroup] =&gt; 4 [parent_subgroup] =&gt; 3 )      ) </code></pre>  <p>P.S. No, me and my sister didn't have a kid. That was just my analogy falling on its face. ;)</p>