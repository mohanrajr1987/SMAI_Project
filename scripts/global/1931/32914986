<p>I have in my controller action (I removet try/catch block for more clear code):</p>  <pre><code>   [HttpPost]     public ActionResult SendMessage(ContactViewModel model)     {                   if (ModelState.IsValid)         {                  MailMessage message = new MailMessage();                  var administrator = new MailAddress("xxxx@gmail.com");                 var customer = new MailAddress(model.Email, model.Name);                  message.Bcc.Add(customer);                 message.Bcc.Add(administrator);                 message.Subject = "Message Subject";                 message.Body = model.Message;                  SmtpClient client = new SmtpClient();                                     client.Send(message);          }          return PartialView("_ContactPartial", model);     } </code></pre>  <p>The action works correctly, the info about host are in web.config.</p>  <p>I want create unit test's for this action. I created in my project with test web.config:</p>    <pre><code>&lt;configuration&gt;   &lt;system.net&gt;     &lt;mailSettings&gt;       &lt;smtp deliveryMethod="SpecifiedPickupDirectory"&gt;         &lt;specifiedPickupDirectory pickupDirectoryLocation="C:\MailTest\"/&gt;               &lt;/smtp&gt;     &lt;/mailSettings&gt;   &lt;/system.net&gt; &lt;/configuration&gt; </code></pre>  <p>And there is basic unit test:</p>  <pre><code>    [TestMethod]     public void ContactControllerTest_SendMessage_PartialView()     {         //Arrange         var controller = new ContactController();          //Act         var result = controller.SendMessage(contactViewModel) as PartialViewResult;          //Asset         Assert.AreEqual("_ContactPartial", result.ViewName");     } </code></pre>  <p>In the line </p>  <pre><code>Elmah.ErrorSignal.FromCurrentContext().Raise(ex);  </code></pre>  <p>I have exception:  The SMTP host was not specified. Why it need it if in my web.config I selected SpecifiedPickupDirectory as delivery method?</p>