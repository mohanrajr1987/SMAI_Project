<p>I need to adjust background cell colors depending on adjacent cells.  </p>  <p>My template is a word document and I set the cell color to some random color so my xml of interest looks like this:</p>  <pre><code>&lt;w:tc&gt;   &lt;w:tcPr&gt;     &lt;w:tcW w:w="5400" w:type="dxa"/&gt;     &lt;w:tcBorders&gt;       &lt;w:left w:val="single" w:sz="4" w:space="0" w:color="D9D9D9" w:themeColor="background1" w:themeShade="D9"/&gt;     &lt;/w:tcBorders&gt;     &lt;w:shd w:val="clear" w:color="auto" w:fill="D9D9D9" w:themeFill="background1" w:themeFillShade="D9"/&gt;   &lt;/w:tcPr&gt;   &lt;w:pPr&gt;&lt;w:rPr&gt;&lt;w:sz w:val="20"/&gt;&lt;w:szCs w:val="20"/&gt;&lt;/w:rPr&gt;&lt;/w:pPr&gt;   &lt;w:r&gt;   &lt;w:rPr&gt;      &lt;w:sz w:val="20"/&gt;&lt;w:szCs w:val="20"/&gt;    &lt;/w:rPr&gt;    &lt;w:t&gt;[title.bg;att=w:shd#w:fill][title.quoteFOB]&lt;/w:t&gt;   &lt;/w:r&gt; </code></pre>  <p>With the important points being:</p>  <ul> <li>I have a w:shd tag with a wfill='D9D9D9' attribute assigned </li> <li>I have a [title.bg;att=w:shd#w:fill] entry in the template intended to route the merge block title.bg to the wfill attribute.</li> <li>I have a merge entry [title.quoteFOB] intended to route the merge field title.quoteFOB to the cell contents.</li> </ul>  <p>The call to perform the merge looks like this:</p>  <pre><code>$TBS-&gt;MergeField('title', array('custName' =&gt; $custName,      'compName' =&gt; $compName, 'custAddress1' =&gt; $custAddr1,      'custAddress2' =&gt; $custAddr2, 'quoteNum' =&gt; $quoteNum,      'quoteRev' =&gt; $quoteRev, 'quoteForm' =&gt; $quoteForm,      'quoteExpDate' =&gt; $quoteExp, quoteTerms' =&gt; $quoteTerm,      'quoteFOB' =&gt; $quoteFob, bg'=&gt;'00FF00')); </code></pre>  <p>This is one of multiple merge blocks containing multiple cell updates all of which seem to work as expected. Everything except the cell color change. </p>  <p>I tried numerous things that could be causing the problem, like: disabling all but one merge, rearranging the order of the fields, and reading way to many stackoverflow entries.  None of which worked.  </p>  <p>I assumed I was an idiot, and I could figure this out by looking at the code. and tracing through the code. What I found was that prior to the Show() call the TBS->Source was as expected. All merges took place and the w:fill value was substituted correctly in the modified XML.  But when I call </p>  <pre><code>$TBS-&gt;Show(OPENTBS_DOWNLOAD, "$fileName.docx") and $TBS-&gt;Show(OPENTBS_STRING); </code></pre>  <p>The output docx file does not contain the -w:fill change. Everything before it and after it, but not that change. Now I am back to thinking I am an idiot and I am doing something wrong. </p>  <p>Any ideas what I am doing wrong ?,  please help me.</p>