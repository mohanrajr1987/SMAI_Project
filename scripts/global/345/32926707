<p>I have the following code:</p>  <pre><code>// get location where application data director is located var appData = Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData);  // create dir if it doesnt exist var folder = System.IO.Path.Combine(appData, "SomeDir"); if (System.IO.Directory.Exists(folder) == false)     System.IO.Directory.CreateDirectory(folder);  // create file if it doesnt exist var file = System.IO.Path.Combine(folder, "test.txt"); if(System.IO.File.Exists(file)== false)      System.IO.File.Create(file);  // write something to the file System.IO.File.AppendAllText(file,"Foo"); </code></pre>  <p>This code crashes on the last line (<code>An unhandled exception of type 'System.IO.IOException' occurred in mscorlib.dll</code>). If I put a <code>Thread.Sleep(400)</code> after creating the file the code works great. <strong>What is the proper way of waiting until the file is created?</strong></p>  <p>P.S. I am using .net framework 3.5</p>  <p>Even if I wait it crashes :/</p>  <p><a href="http://i.stack.imgur.com/ZKJ0c.png" rel="nofollow"><img src="http://i.stack.imgur.com/ZKJ0c.png" alt="enter image description here"></a></p>