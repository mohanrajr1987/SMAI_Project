<p>I would like to create Table Valued Parameter in MSSQL Server using ODBC and c++. Such a SQL Code works fine in SQL Server:</p>  <pre><code>DECLARE @T1 as TABLE (  PK INT IDENTITY NOT NULL,  Wert CHAR(20),  Name CHAR(20)  )  INSERT INTO @T1(Wert,Name) VALUES ('123','Babio')   INSERT INTO @T1(Wert,Name) VALUES ('214','Martin')   INSERT INTO @T1(Wert,Name) VALUES ('236','Karo')    select * FROM @T1 where  Wert=123  </code></pre>  <p>I have written this block of code in c++ to send this SQL Code to SQL Server using ODBC:</p>  <pre><code>int main() {     SQLHENV henv=SQL_NULL_HENV;     SQLHDBC hdbc=SQL_NULL_HDBC;     SQLHSTMT hstmt=SQL_NULL_HSTMT;     SQLRETURN rc;      SQLCHAR Statement[] = "DECLARE @T1 as TABLE (PK INT IDENTITY NOT NULL, Wert CHAR(20), Name CHAR(20)) INSERT INTO @T1(Wert,Name) VALUES ('123','Babak')  INSERT INTO @T1(Wert,Name) VALUES ('214','Martin') INSERT INTO @T1(Wert,Name) VALUES ('236','Karo')  select Name FROM @T1 Where Wert=123" ;      SQLWCHAR dsn[30] = L"mssqltest"; //Name DNS    SQLWCHAR user[10] = L"di_test";    SQLWCHAR pass[10] = L"di_test";     SQLCHAR retValFName[256];    SQLCHAR retValLName[256];    SQLINTEGER cbLName,cbFName;     rc = SQLAllocHandle(SQL_HANDLE_ENV, SQL_NULL_HANDLE, &amp;henv);      rc= SQLSetEnvAttr(henv,SQL_ATTR_ODBC_VERSION,(void *) SQL_OV_ODBC3,0);    rc = SQLAllocHandle(SQL_HANDLE_DBC, henv, &amp;hdbc);      rc = SQLConnectW(hdbc, (SQLWCHAR *)dsn, SQL_NTS, (SQLWCHAR *) user, SQL_NTS, (SQLWCHAR *) pass, SQL_NTS);     rc = SQLAllocHandle(SQL_HANDLE_STMT,hdbc,&amp;hstmt);    rc = SQLPrepareA(hstmt, (SQLCHAR *)Statement, SQL_NTS);    rc = SQLExecute(hstmt);     if(rc==SQL_SUCCESS)    {    while(true)         {           rc=SQLFetch(hstmt); // In this line rc=-1           if(rc==SQL_SUCCESS || rc==SQL_SUCCESS_WITH_INFO)           {              SQLGetData(hstmt,1,SQL_C_CHAR,retValFName,256, &amp;cbLName);              std::cout &lt;&lt; retValFName &lt;&lt;"   "&lt;&lt; std::endl;              system("pause");           }           else           {               break;           }         }    }    return 0; } </code></pre>  <p>If I check the error, I see this error which says: </p>  <blockquote>   <p>Invalid Cursor state</p> </blockquote>  <p>How could be my code changes to run this code to create and make a query on Table Valued Parameter in SQL?</p>