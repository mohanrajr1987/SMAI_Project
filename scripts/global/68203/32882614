<p>I'm trying to make a test for a login webpage where there is the possibility of using Thirdparties social login. When you click on facebook icon, for example, a new popup appears asking for user/password. I'm using waitForPopup and withPopup as specified by the documentation to handle that, but is not working. Is never finding the element (via xpath) inside the xpath, so I can never log in using facebook in our test.</p>  <p>This is an example code that check if the facebook button is there, click on it and wait for the popup:</p>  <pre><code>  casper.then(function() {     test.comment("When we click facebook button");     casper.waitForSelector(x(facebookButton),  function() {       test.assertExists(x(facebookButton), "Facebook icon is showing");       casper.click(x(facebookButton));     }, function timeout() { // step to execute if check has failed       casper.test.fail("Timeout loading login page");     });   });    casper.then(function() {     casper.waitForPopup(/facebook\.com\/login/,  function() {       test.comment("And we fill facebook login info");       casper.withPopup(/facebook\.com\/login/,  function() {         this.viewport(1600, 900);         casper.sendKeys(x(facebookEmail), facebookLogin[0]);         casper.sendKeys(x(facebookPassword), facebookLogin[1]);         casper.click(x(facebookLogin));       });     }, function timeout() { // step to execute if check has failed       casper.test.fail("Timeout loading faceebook login");     });   }); </code></pre>  <p>The output of the test is:</p>  <pre><code># When we click facebook button PASS Facebook icon is showing # And we fill facebook login info FAIL Cannot get informations from xpath selector: //input[@id='email']: element not found. #    type: uncaughtError #    file: casper/import-login-testing.js:1058 #    error: Cannot get informations from xpath selector: //input[@id='email']: element not found. #           CasperError: Cannot get informations from xpath selector: //input[@id='email']: element not found. #               at getElementInfo (/Users/ginogalotti/testing-presentation/node_modules/casperjs/modules/casper.js:1058) #               at /Users/ginogalotti/testing-presentation/node_modules/casperjs/modules/casper.js:1589 #               at casper/import-login-testing.js:84 #               at runStep (/Users/ginogalotti/testing-presentation/node_modules/casperjs/modules/casper.js:1553) #               at checkStep (/Users/ginogalotti/testing-presentation/node_modules/casperjs/modules/casper.js:399) #    stack: not provided </code></pre>  <p>For me, that means that is finding the popup, the waitForPopup is triggering and is just not using the popup to look for the facebookEmail element. I'm still learning about casperjs, so probably this is not even the best way to approach the problem; but I would really thank some guidance.</p>  <p>Thanks in advance,</p>  <p>Example website that I'm testing: <a href="https://import.io/login/" rel="nofollow">https://import.io/login</a></p>