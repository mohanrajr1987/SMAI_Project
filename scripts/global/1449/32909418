<p>I have two columns of data:</p>  <pre><code>Member  Time A        1 B        1 B        2 A        2 A        3 A        4 A        5 B        3 B        4 </code></pre>  <p>Say this data starts from <code>A1</code> to <code>B11</code>. </p>  <p>If I want to subtract consecutive time values after the column values have been sorted in ascending order all I need is this formula:</p>  <p><code>=B3-B2</code></p>  <p>The formula works fine to get me the difference. However, if I filter to get the difference only for member A, the formula considers the hidden rows as well, hence giving the wrong output.</p>  <p>I am new to VBA. Based on an answer provided in <a href="http://www.mrexcel.com/forum/excel-questions/45637-have-formula-consider-only-visible-rows.html" rel="nofollow">another website</a>, I tried writing a function as follows:</p>  <pre><code>Function MyDiff (MyRange As Range) As Integer  Dim c As Range For Each c In MyRange     If (c.Value = 1) And (c.EntireRow.Hidden = False) Then         Worksheets("Sheet1").Range("B2").value - Range("B1").value      End If Next c  End Function </code></pre>  <p>This function is not providing the anticipated output. Should I be using a different approach or is there something fundamentally wrong with my code? </p>