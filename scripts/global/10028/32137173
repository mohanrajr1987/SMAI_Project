<p>I need to be able to dynamically create 'n' number of XElements inside an XDocument using a loop and depending on the number of files found within a directory.</p>  <p>My WIP bare bones project code is possibly slightly long to paste here so I have added it to pastie.org - <a href="http://pastie.org/private/qfjfrg5tfia6fjeu4e3dcq#3" rel="nofollow">here</a></p>  <p>You will see that between lines 73-91 that I have a foreach loop that searches through a directory &amp; it's sub-directories and locates the paths of all the files contained within. I know that this on it's own works as I have used:</p>  <p><code>int x = filePaths.Length;</code></p>  <p>and the output of <code>x</code> matches the number of files in the given directory.</p>  <p>The main bulk of the code also works and creates a HTML file as I require but I also need it to dynamically create 'n' XElements between line 215 where I have placed:</p>  <p><code>///  **** NEED TO INSERT LOOP HERE TO DYNAMICALLY CREATE NUMBER OF ELEMENTS DEPENDING ON NUMBER OF FILES IN DIRECTORY ****</code></p>  <p>just before the opening of a <code>&lt;TR&gt;</code> tag &amp; line 280, just after the closing of a <code>&lt;TR&gt;</code> tag so each file found within the specified directory will have it's own <code>&lt;TABLE&gt;</code> row.</p>  <p>I have lost count as to the number of ways I have tried to achieve this by moving the loop around throughout the code but keep hitting a brick wall with masses of errors.</p>  <p>Initially I thought it would be as simple as to just place the loop in the code at line 215 but doing this causes numerous errors such as missing:</p>  <ul> <li>;</li> <li>}</li> </ul>  <p>etc...</p>  <p>Now I am completely stuck.</p>  <p>I am trying to emulate in C# a batch file I made some time ago that uses WMIC that works perfectly well but is limited &amp; I wish to add a few more features, this is where C# comes in.</p>  <p>The batch file uses a loop, just as I am trying to here, without any problems at all.</p>  <p>Here is the loop from the WMIC batch file:</p>  <pre><code>(FOR /f "delims=" %%a IN ('dir /b /a-d /s /n "C:\Users\1CM69\Pics &amp; Vids\Archives\Family\2002"') DO ( FOR /f "tokens=1-3*" %%x IN ('dir /a-d /tc "%%~a"^|findstr "^[0-9]"') DO (   for /f %%c in ("%%~ta") do ( ECHO ^&lt;TR^&gt;^&lt;td style="border-width: 1px;padding: 10px;border-style: inset;border-color: gray;background-color: white;" align="center" valign="middle"^&gt;^&lt;a href="%%a" target="_new"^&gt;^&lt;img src="%%a" width="100px" border="0"^&gt;^&lt;/a^&gt;^&lt;/TD^&gt;^&lt;td style="border-width: 1px;padding: 10px;border-style: inset;border-color: gray;background-color: white;" align="left" valign="middle"^&gt;^&lt;B^&gt;%%~nxa^&lt;/B^&gt;^&lt;/TD^&gt;^&lt;td style="border-width: 1px;padding: 10px;border-style: inset;border-color: gray;background-color: white;" align="center" valign="middle"^&gt;^&lt;B^&gt;%%~c^&lt;/B^&gt;^&lt;/TD^&gt;^&lt;td style="border-width: 1px;padding: 10px;border-style: inset;border-color: gray;background-color: white;" align="center" valign="middle"^&gt;^&lt;B^&gt;%%x^&lt;/B^&gt;^&lt;/TD^&gt;^&lt;/TR^&gt; &gt;&gt; 2002.html)))) </code></pre>  <p>I found <a href="http://stackoverflow.com/questions/7946830/create-xml-with-xdocument-with-a-variable-number-of-xelements-using-for-loop">Create XML with XDocument with a variable number of XElements using for loop</a> will searching around &amp; was initially hopeful and although I did get it to dynamically create 'n' number of XElements based on the number of files, the variable <code>DateTaken</code> only showed the value of the last file within the directory, so I had a <code>&lt;TABLE&gt;</code> with 68 rows <code>&lt;TR&gt;</code>, in the case of the test directory I am using, and they all contained the values retrieved from the final file that the loop found.</p>  <p>Any help would be kindly appreciated.</p>  <p>Regards..,</p>