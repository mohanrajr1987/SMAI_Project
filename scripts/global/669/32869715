<p>At my company we have an initiative that allows users to submit "Winning Ideas". There is a form to fill out, and the user can upload documents on the form. The ideas are voted on by other employees, reviewed by a committee, and the user has the ability to win cash prizes and have their idea implemented in the company.</p>  <p>I created a custom webpart using ASP.NET that allows users to insert a row into a SQL table, and add documents to a SharePoint document list. The list of documents they upload is added to a field in the SQL table, and displayed as hyperlinks on the .aspx page.</p>  <p>Here are some of the <strong>issues</strong> I have seen with the document upload:<br />  - Document is not uploaded at all.<br />  - Document is uploaded, but not checked in.<br />  - Document is uploaded and checked in, but not linked to a record (the field did not update in SQL).<br />  - If adding multiple documents, both documents are uploaded but the content of the first document is repeated for all documents.<br />  - Multiple entries are created with the Insert statement.<br /></p>  <p>I can't figure out if this is a problem with my SQL or my VB. Is there a better way I should be doing this? Any help would be appreciated.</p>  <p>My current <strong>environment</strong> is as such:<br />  - SharePoint 2013<br />  - SQL Server 2012<br />  - Microsoft Visual Studio Professional 2013<br /></p>  <pre><code>Partial Public Class WinningIdeasFormUserControl Inherits UserControl Public conn As SqlConnection Public strDatabase As String Public MyUserInfo As SPUser Public strFiles As String Public IdeaId As String Public uploads As HttpFileCollection  Private Sub btnSubmit_Click(ByVal sender As Object, ByVal e As System.EventArgs) Handles btnSubmit.Click     'reference to file collection that was sent by the browser request'     uploads = HttpContext.Current.Request.Files       Try         conn = New SqlConnection(strDatabase)         Dim cmd As SqlCommand = New SqlCommand()         strFiles = ""          'SQL command to insert results into the database'         cmd.Connection = conn         cmd.CommandType = CommandType.Text         cmd.CommandText = "INSERT INTO [WinningIdeas] (Title, Idea, Submitter, SPUserID) OUTPUT INSERTED.ID VALUES (@Title, @Idea, @Submitter, '" &amp; MyUserInfo.ID &amp; "')"          cmd.Parameters.AddWithValue("@Title", txtTitle.Text)         cmd.Parameters.AddWithValue("@Idea", txtIdea.InnerText)         cmd.Parameters.AddWithValue("@Submitter", MyUserInfo.Name)          'confirms that the database has been updated'         cmd.Connection.Open()         Dim reader As SqlDataReader = cmd.ExecuteReader()         reader.Read()         'set IdeaId to the output of the record that was just added (ID it was assigned in database)'         IdeaId = reader(0).ToString         cmd.Connection.Close()         cmd.Connection = Nothing          If uploads.Count &gt; 1 Then             Try                 'if the user uploaded documents, make sure we add them'                 uploadDocuments()             Catch ex As Exception                 Span1.InnerHtml = "An error has occurred while trying to upload your document(s). Please contact WinnDESK@winnco.com for more information. " &amp; ex.Message &amp; "."             End Try         ElseIf (reader.RecordsAffected = 1) Then 'if a record has been successfully created'             SendEmail()             Response.Redirect("/Pages/Submitted.aspx?IdeaId=" &amp; IdeaId)         End If      Catch ex As Exception         'change the &lt;span&gt; to show the error message'         Span1.InnerHtml = ex.Message     End Try End Sub  Public Sub uploadDocuments()     'upload files'     For i As Integer = 0 To (uploads.Count - 1)         Dim fileSize As Int64         fileSize = uploads(i).ContentLength         'get the file name from whichever file we are currently saving'         Dim filName As String = System.IO.Path.GetFileName(uploads(i).FileName)         'TODO: Size exception is bringing the user to an exception page. catch as my exception'         'make sure there are no empty files, make sure file is less than 50MB'         If (fileSize &gt; 0 And fileSize &lt; 52428800) Then             Dim spfile As SPFile = SPContext.Current.Web.Files.Add("/Documents/User%20Uploads/" + IdeaId + "_" + filName, FileField.PostedFile.InputStream)             spfile.CheckIn("Checked in by " &amp; MyUserInfo.Name &amp; " for Idea " &amp; IdeaId, SPCheckinType.MajorCheckIn)             spfile.Publish("Published by " &amp; MyUserInfo.Name &amp; " for Idea " &amp; IdeaId)             'separate files with a ";" in the database'             strFiles = strFiles + IdeaId + "_" + filName + ";"         Else             Throw New Exception("Your file, " &amp; filName &amp; ", was not uploaded correctly due to its size.")         End If     Next      Try         conn = New SqlConnection(strDatabase)         Dim cmd As SqlCommand = New SqlCommand()          cmd.Connection = conn         cmd.CommandType = CommandType.Text         cmd.CommandText = "UPDATE WinningIdeas SET Documents = @Documents WHERE ID = " &amp; IdeaId          cmd.Parameters.AddWithValue("@Documents", strFiles)          cmd.Connection.Open()         cmd.ExecuteNonQuery()         cmd.Connection.Close()         cmd.Connection = Nothing          Response.Redirect("/Pages/Submitted.aspx?IdeaId=" &amp; IdeaId)     Catch ex As Exception         'change the &lt;span&gt; to show the error message'         Span1.InnerHtml = ex.Message     End Try End Sub </code></pre>