<p>I am trying to load an application's icon(s) using the <code>LoadImage</code> WinAPI function, but for some reason it always returns 0.</p>  <p>I have read the <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms648045(v=vs.85).aspx" rel="nofollow">documentation</a>, but I cannot understand what I've done wrong. I get no exceptions except for when trying to convert <code>IconPtr</code> to <code>Icon</code> (which is becasue <code>IconPtr</code> is 0).</p>  <pre><code>Public Shared Function ExtractAssociatedIconArray(ByVal File As String, ByVal Sizes() As Size) As Icon()     Dim ReturnArray(Sizes.Length) As Icon     Dim Index As Integer = 0      For Each s As Size In Sizes         'IconPtr is always zero for some reason.         Dim IconPtr As IntPtr = NativeMethods.LoadImage(Nothing, File, NativeMethods.Enumrations.IMAGE_ICON, s.Width, s.Height, NativeMethods.Enumrations.LR_DEFAULTCOLOR Or NativeMethods.Enumrations.LR_LOADFROMFILE)         ReturnArray(Index) = Icon.FromHandle(IconPtr)         Index += 1     Next      Return ReturnArray End Function </code></pre>  <p>The <code>NativeMethods</code> class:</p>  <pre><code>Public Class NativeMethods     &lt;DllImport("user32.dll", SetLastError:=True)&gt; _     Public Shared Function LoadImage(ByVal hInst As IntPtr, _                      ByVal lpszName As String,                      ByVal uType As UInt32, _                      ByVal cxDesired As Integer, _                      ByVal cyDesired As Integer, _                      ByVal fuLoad As UInt32) As IntPtr     End Function      Public Enum Enumrations As UInteger         '' LoadImage ''         IMAGE_BITMAP = 0         IMAGE_ICON = 1         IMAGE_CURSOR = 2         LR_CREATEDIBSECTION = &amp;H2000         LR_DEFAULTCOLOR = &amp;H0         LR_DEFAULTSIZE = &amp;H40         LR_LOADFROMFILE = &amp;H10         LR_LOADMAP3DCOLORS = &amp;H1000         LR_LOADTRANSPARENT = &amp;H20         LR_MONOCHROME = &amp;H1         LR_SHARED = &amp;H8000         LR_VGACOLOR = &amp;H80     End Enum End Class </code></pre>  <p>Usage example:</p>  <pre><code>Dim Icons() As Icon = ExtractAssociatedIconArray("C:\MyApp.exe", New Size() {New Size() {48, 48}}) </code></pre>