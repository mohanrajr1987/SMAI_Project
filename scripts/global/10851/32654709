<p>I would like to replace all uses of an instruction, which is a function call that I want to delete, with an Undef value.</p>  <p>First, I declare my undef value like this</p>  <pre><code>UndefValue *undefval; </code></pre>  <p>and then I try to replace all the uses of my instruction</p>  <pre><code>currentInst-&gt;replaceAllUsesWith(undefval); </code></pre>  <p><strong>currentInst</strong> is an </p>  <pre><code>Instruction* currentInst;  </code></pre>  <p>value which refers to my current instruction. This causes LLVM to produce the following error ans assertion:</p>  <blockquote>   <p>opt: /home/troulakis/Documents/LLVM_Project/llvm/llvm/lib/IR/Value.cpp:332: void llvm::Value::replaceAllUsesWith(llvm::Value *): Assertion `New->getType() == getType() &amp;&amp; "replaceAllUses of value with new value of different type!"' failed.</p>      <p>0 0x160e678 llvm::sys::PrintStackTrace(_IO_FILE*)   (/usr/local/bin/opt+0x160e678) 1 0x160fbdb   (/usr/local/bin/opt+0x160fbdb) 2 0x7f7752596340 __restore_rt   (/lib/x86_64-linux-gnu/libpthread.so.0+0x10340) 3 0x7f77515aacc9   gsignal (/lib/x86_64-linux-gnu/libc.so.6+0x36cc9) 4 0x7f77515ae0d8   abort (/lib/x86_64-linux-gnu/libc.so.6+0x3a0d8) 5 0x7f77515a3b86   (/lib/x86_64-linux-gnu/libc.so.6+0x2fb86) 6 0x7f77515a3c32   (/lib/x86_64-linux-gnu/libc.so.6+0x2fc32) 7 0x15be04f   (/usr/local/bin/opt+0x15be04f) 8 0x7f775136fda7 (anonymous   namespace)::MyPass::runOnFunction(llvm::Function&amp;)   (../../../Release+Asserts/lib/PassRAF.so+0x6da7) 9 0x15a1ab4   llvm::FPPassManager::runOnFunction(llvm::Function&amp;)   (/usr/local/bin/opt+0x15a1ab4) 10 0x15a1d3b   llvm::FPPassManager::runOnModule(llvm::Module&amp;)   (/usr/local/bin/opt+0x15a1d3b) 11 0x15a22d7   llvm::legacy::PassManagerImpl::run(llvm::Module&amp;)   (/usr/local/bin/opt+0x15a22d7) 12 0x5af6db main   (/usr/local/bin/opt+0x5af6db) 13 0x7f7751595ec5 __libc_start_main   (/lib/x86_64-linux-gnu/libc.so.6+0x21ec5) 14 0x59f559 _start   (/usr/local/bin/opt+0x59f559) </p>      <p>Stack dump:</p>      <ol>   <li><p>Program arguments: opt -load ../../../Release+Asserts/lib/PassRAF.so -time-passes -instnamer   -PassRAF </p></li>   <li><p>Running pass 'Function Pass Manager' on module ''.</p></li>   <li>Running pass 'R A F' on function '@main'</li>   </ol>      <p>./PassRAF: line 15:  7227 Aborted                 (core dumped)</p> </blockquote>  <p>Any ideas what's wrong? I have wrong declare of undef value?</p>