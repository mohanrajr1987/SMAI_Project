<p>I have a piece of code in Fortran 90 in which I have to solve both a non-linear (for which I have to invert the Jacobian matrix) and a linear system of equations. When I say small I mean <em>n</em> unknowns for both operations, with <em>n&lt;=4</em>. Unfortunately, <em>n</em> is not known <em>a priori</em>. What do you think is the best option?</p>  <p>I thought of writing explicit formulas for cases with <em>n=1,2</em> and using other methods for <em>n=3,4</em> (e.g. some functions of the Intel MKL libraries), for the sake of performance. Is this sensible or should I write explicit formulas for the inverse matrix also for <em>n=3,4</em>?</p>