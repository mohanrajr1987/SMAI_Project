<p>I am a bit confused about how the <code>QTextBlock::iterator</code> works:</p>  <p>The documentation shows clear examples of how to use it, on normal text:</p>  <pre><code>QTextBlock::iterator it; for (it = currentBlock.begin(); !(it.atEnd()); ++it) {     QTextFragment currentFragment = it.fragment();     if (currentFragment.isValid())         processFragment(currentFragment); } </code></pre>  <p>I encounter problems on empty lines of text. On those lines,</p>  <pre><code>it = currentBlock.begin(); if(it.atEnd())     // returns true ! </code></pre>  <p>I still need to be able to read formatting (char and block) </p>  <p>Should I check the block at end ? Is there any other way to test blocks with nothing except the new line ?</p>  <p>My current solution: check the last iterator as well, separate from the "for" loop, and also test if it is the last block in the document (if I try to get the fragment of the last block in the document, the program crashes).</p>  <p>It seems that I am working against the documentation... How should I get the formatting of empty lines ?</p>  <p>Edit:</p>  <p>My old solution:</p>  <pre><code>QTextBlock currentBlock = document()-&gt;findBlock(selStart); QTextBlock lastBlock = document()-&gt;lastBlock(); while (currentBlock.isValid()) {     QTextBlock::iterator it = currentBlock.begin();     if(currentBlock != lastBlock &amp;&amp; it.atEnd())     {         QTextFragment currentFragment = it.fragment();         if (currentFragment.isValid())         {             QTextCharFormat f = currentFragment.charFormat();             // do something         }     }      else     {         for (; !(it.atEnd()); ++it)         {             QTextFragment currentFragment = it.fragment();             if (currentFragment.isValid())             {                 // do stuff                 QTextCharFormat f = currentFragment.charFormat();                 // do stuff             }         }     } } </code></pre>  <p>New solution based from answer from Tarod eliminates one test (but seems to have less consistent behavior)</p>  <pre><code>QTextBlock currentBlock = document()-&gt;findBlock(selStart); QTextBlock lastBlock = document()-&gt;lastBlock(); while (currentBlock.isValid()) {     QTextBlock::iterator it = currentBlock.begin();     if(currentBlock != lastBlock &amp;&amp; it.atEnd())     {         QTextCharFormat f = currentBlock.charFormat();         // do something     }      else     {         for (; !(it.atEnd()); ++it)         {             QTextFragment currentFragment = it.fragment();             if (currentFragment.isValid())             {                 // do stuff                 QTextCharFormat f = currentFragment.charFormat();                 // do stuff             }         }     } } </code></pre>  <p>I still need to check against last block and avoid using it if empty, sometimes it crashes.</p>