<p>We use a clone of Amazon S3 called GreenQloud Storage. But they are shutting down so we have to take all the files here and migrate them in S3.</p>  <p>Our app is a little similar to a CMS in that our DB has fields that contains HTML fragments. And these fragments may reference GreenQloud urls, so we have to replace all these urls with S3 urls. </p>  <p>The files are already migrated. Here is a sample file in both storage providers:</p>  <ul> <li><a href="https://s.greenqloud.com/com.stample.s3/stample-1420827843028-spotlight.png" rel="nofollow">https://s.greenqloud.com/com.stample.s3/stample-1420827843028-spotlight.png</a></li> <li><a href="https://stample-files.s3.amazonaws.com/stample-1420827843028-spotlight.png" rel="nofollow">https://stample-files.s3.amazonaws.com/stample-1420827843028-spotlight.png</a></li> </ul>  <p>I'm thinking of using a HTML parser to extract tags like <code>a</code>, <code>img</code> and http urls found in text nodes, but I'm frightened to miss some urls this way. Do you see any problem with that?</p>  <p>I'm also considering using regexes but some people advice <a href="http://stackoverflow.com/a/1732454/82609">against using regexes to parse HTML</a>. But anyway, in my case I'm not really sure this could be considered "parsing HTML" as I just want to replace a pattern by another.</p>  <p>So, I would appreciate to know which solution is the best / most secure for this migration. I'm not concerned so much about migration throughput / performances but rather to migrate correctly all the links accurately.</p>  <p>We use Java/Scala, and all our fields to migrate are in MongoDB so any Java / MongoDB based snippets are welcome.</p>  <p>Also note that some old HTML fragments may not be well-formed in our DB, but a Java parser can generally fix that.</p>  <p>Thanks</p>  <hr>  <p><strong>Edit</strong></p>  <p>A typical MongoDB document might look like:</p>  <pre><code>{   _id: ObjectId(xxx),   title: "yyy",   content: "HTML FRAGMENT CONTAINING GREENQLOUD URLS",   mainPictureUrl: "GREENQLOUD URL" } </code></pre>  <p>I can't really give any example for the html fragment, as it can come in many different shapes.</p>