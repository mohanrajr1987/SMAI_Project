<p>I am using the following example to better explain my need. </p>  <p>I have a set of points(users) on a map and collection schema is as below</p>  <pre><code>{   location:{     latlong:[long,lat]   },   maxDistance:Number } </code></pre>  <p>i have another collection with events happening in the area. schema is given below</p>  <pre><code>{   eventLocation:{     latlong:[long,lat]   } } </code></pre>  <p>now users can add their location and the maximum distance they want to travel for to attend an event and save it. </p>  <p>whenever a new event is posted , all the users satisfying their preferences will get a  notification. Now how do i query that. i tried following query on user schema</p>  <pre><code>{   $where: {     'location.latlong': {       $near: {         $geometry: {           type: "Point",           coordinates: [long,lat]         },         $maxDistance: this.distance       }     }   } } </code></pre>  <p>got an error</p>  <pre><code>error: {     "$err" : "Can't canonicalize query: BadValue $where got bad type",     "code" : 17287 } </code></pre>  <p>how do i query the above case as maxDistance is defined by user and is not fixed. i am using 2dsphere index. </p>