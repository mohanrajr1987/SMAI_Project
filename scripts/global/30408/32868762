<p>I have this sample data and part of the query <a href="http://sqlfiddle.com/#!6/b53e9/2" rel="nofollow">See the Fiddle</a>. It shows the segment start time and end time. The task is get the sum of all the time segments between 6am to 10pm in seconds. I have filter it on the day but how can I restrict between 6am and 10 pm is difficult for me (May be another condition in the Case statement). The second difficulty is how to get part of a segment when its start time is  5am and endtime is 7am then I want to display 3600 seconds for the part which lies between 6am to 10pm. Similarly if a segment starts at 9pm and finished at 5am then I want to get 3600 seconds i.e. the part before 10pm.</p>  <pre><code>Select    userid,   CASE     WHEN DateDiff(day, starttime, endtime) = 0 THEN datediff(second, starttime, endtime)    END As TotalSecondsFromSixAMToTenPM       FROM   Test </code></pre>  <p>Here is the expected result, Note the first and second last value is obtained by taking these values </p>  <pre><code>Select datediff(second,  '2015-01-14 06:00:00.000', '2015-01-14 09:25:54.000') Select datediff(second, '2015-01-14 21:30:14.000', '2015-01-14 22:00:00.000')   ╔════════╦══════════════════════════════╗ ║ userid ║ TotalSecondsFromSixAMToTenPM ║ ╠════════╬══════════════════════════════╣ ║ abc    ║ 12354                        ║ ║ abc    ║ 3600                         ║ ║ abc    ║ 15150                        ║ ║ abc    ║ 14684                        ║ ║ abc    ║ 1786                         ║ ║ abc    ║ NULL                         ║ ╚════════╩══════════════════════════════╝ </code></pre>