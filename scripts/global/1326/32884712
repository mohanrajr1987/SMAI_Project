<p>Can anybody help me to understand how to get the markers to render on the path in the following example?</p>  <p><div class="snippet" data-lang="js" data-hide="false"> <div class="snippet-code"> <pre class="snippet-code-js lang-js prettyprint-override"><code>    var size = {width: 500, height: 180},         svg = d3.select("body").append("svg").attr(size),         markers = Marker(svg, "red");      var circles = svg.append("ellipse").datum({})             .attr({                 class: "circle",                 'cx': size.width / 2,                 'cy': size.height / 2,                 'ry': 50,                 'rx': 100,                 "fill": "steelblue"             }),         shadePath = svg.append("path")             .attr({                 class: "arrow",                 d: d3.svg.line()([[100,50], [400,150]]),                 stroke: "red"             }).style({                 "marker-start": markers.start,                 "marker-end": markers.end             });      function Marker(svg, color){         var id = "filter-marker", defs = svg.selectAll("defs").data([id]),             idS = id + "-start", idE = id + "-end";          defs.enter().append("defs");         var markers = defs.selectAll("#"+id).data([             {                 attr: {id: idS, viewBox: "0 0 7 7",                     markerWidth: "7", markerHeight: "7",                     refX: "4", refY: "4",orient: "auto"},                 symbol: {                     type: "rect",                     attr: {x: "1", y: "1", width: "5", height: "5", style: "stroke: none; fill: " + color + ";"}                 }             },             {                 attr: {id: idE, viewBox: "0 0 13 13",                     markerWidth: "13", markerHeight: "13",                     refX: "2", refY: "7", orient: "auto"},                 symbol: {                     type: "path",                     attr:{d: "M2,2 L2,13 L8,7 L2,2", style: "stroke: none; fill: " + color + ";"}                 }             }         ]);         markers.enter().append("marker")             .each(function(d){                 return d3.select(this).attr(d.attr)             });         var marker = markers.selectAll(".symbol").data(function(d){return [d.symbol]});         marker.enter().append(function(d) {             return document.createElement(d.type)         })             .each(function(d){                 return d3.select(this).attr(d.attr)             });          return {             start: ["url(#", idS, ")"].join(""),             end: ["url(#", idE, ")"].join("")         }     };</code></pre> <pre class="snippet-code-css lang-css prettyprint-override"><code>        body{margin:0; position: relative}         svg{outline:solid 1px #ccc;             overflow: visible;         }</code></pre> <pre class="snippet-code-html lang-html prettyprint-override"><code>&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.4.11/d3.min.js"&gt;&lt;/script&gt; &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/tinycolor/1.1.2/tinycolor.min.js"&gt;&lt;/script&gt;</code></pre> </div> </div> </p>  <p>If I manually edit the marker elements in chrome devtools for example, and delete the viewBox attribute, the markers render.  Then if I remove the viewBox attribute from the code and try again, the markers are still not rendered.  Then if I manually add the viewBox, the markers render.</p>  <p>I tried adding the markers in a timer callback in case it was a timing issue but no change.  </p>  <p>The rendered HTML looks like this...</p>  <pre><code>&lt;svg width="500" height="180"&gt;     &lt;defs&gt;         &lt;marker id="filter-marker-start" viewBox="0 0 7 7" markerWidth="7"                 markerHeight="7" refX="4" refY="4"                 orient="auto"&gt;             &lt;rect x="1" y="1" width="5" height="5"                   style="stroke: none; fill: red;"&gt;&lt;/rect&gt;         &lt;/marker&gt;         &lt;marker id="filter-marker-end" viewBox="0 0 13 13" markerWidth="13"                 markerHeight="13" refX="2" refY="7"                 orient="auto"&gt;             &lt;path d="M2,2 L2,13 L8,7 L2,2" style="stroke: none; fill: red;"&gt;&lt;/path&gt;         &lt;/marker&gt;     &lt;/defs&gt;     &lt;ellipse class="circle" cx="250" cy="90" ry="50" rx="100" fill="steelblue"&gt;&lt;/ellipse&gt;     &lt;path class="arrow" d="M100,50L400,150" stroke="red"           style="marker-start: url(#filter-marker-start); marker-end: url(#filter-marker-end);"&gt;     &lt;/path&gt; &lt;/svg&gt; </code></pre>