<p>I need to number islands in SQL Server 2012. Island is defined as a set of rows where there is no day gaps between <code>DateFrom</code> and <code>DateTo</code> within the same <code>ItemId</code>). </p>  <p>The following dataset:</p>  <pre><code>CREATE TABLE #Ranges (ItemId INT, DateFrom DATETIME, DateTo DATETIME)  INSERT INTO #Ranges VALUES (1,'2015-01-31','2015-02-17') INSERT INTO #Ranges VALUES (1,'2015-02-18','2015-03-31') INSERT INTO #Ranges VALUES (1,'2015-04-14','2015-05-21') INSERT INTO #Ranges VALUES (2,'2015-07-12','2015-07-19') INSERT INTO #Ranges VALUES (2,'2015-07-20','2015-07-24') INSERT INTO #Ranges VALUES (2,'2015-07-26','2015-08-02') INSERT INTO #Ranges VALUES (2,'2015-08-03','2015-08-07') </code></pre>  <p>should be numbered as following:</p>  <pre><code>ItemId;  DateFrom;    DateTo;      Number 1;       2015-01-31;  2015-02-17;  1 1;       2015-02-18;  2015-03-31;  1 1;       2015-04-14;  2015-05-21;  2 2;       2015-07-12;  2015-07-19;  3 2;       2015-07-20;  2015-07-24;  3 2;       2015-07-26;  2015-08-02;  4 2;       2015-08-03;  2015-08-07;  4 </code></pre>  <p>Any help much appreciated.</p>  <p>Regards, Przemek</p>