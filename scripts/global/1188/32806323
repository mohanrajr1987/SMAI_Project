<p>I m getting mad with Jboss WildFly9 with JPA and JTA. In my project requirements i have to implement multitenancy so i have to change dynamically datasource inside my persistence.xml. </p>  <p>Using jee approach this is not possibile so someone suggest me to use the classic:</p>  <pre><code>EntityManagerFactory emf = Persistence.createEntityManagerFactory("idelivery");  EntityManager em = emf.createEntityManager(); </code></pre>  <p>So till now it's working, i can create on by myself the enetitymanager and i can set jpa properties in a hashmap (included datasource).</p>  <p>Now i want to use JTA at least to handle transaction using transaction manager. </p>  <p>So these are the properties i set by code:</p>  <pre><code>Properties properties = new Properties();  properties.put ("hibernate.dialect", "org.hibernate.dialect.Oracle10gDialect"); properties.put("javax.persistence.provider", "org.hibernate.jpa.HibernatePersistenceProvider");  properties.put("javax.persistence.transactionType", "JTA"); properties.put("javax.persistence.jtaDataSource", dataSourcePath);  </code></pre>  <p>Transaction type now is JTA. So i expect that i can use some code like:</p>  <pre><code>EntityManagerFactory emf = Persistence.createEntityManagerFactory("idelivery");  EntityManager em = emf.createEntityManager(); MyEntity exUser= new MyEntity(); try{ Context context = new InitialContext(); UserTransaction userTransaction = (UserTransaction)context.lookup("java:comp/UserTransaction"); userTransaction.begin(); em.persist(exUser); userTransaction.commit(); </code></pre>  <p>Of course this code doesn't work at all as Hibernate rises an exception:</p>  <pre><code>java.lang.NullPointerException at org.hibernate.engine.transaction.internal.jta.JtaStatusHelper.getStatus() </code></pre>  <p>Telling me being not able to join a transaction at the creation of entity manager moment.</p>  <p>So ... how can i respect my project requirements... creating my own persistence with my dynamic datasouce and at the same time using the Transaction Manager?</p>