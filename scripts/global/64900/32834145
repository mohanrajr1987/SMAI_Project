<p>I have a working AngularJS project and I am configuring Karma for the first time. </p>  <p>This test works: </p>  <pre><code>describe('myFactory', function () {     // Load your module.     beforeEach(module('MyApp'));      it('can get an instance of my factory', inject(function(sampleSvc) {         expect(sampleSvc).toBeDefined();     })); }); </code></pre>  <p>This test does not work:</p>  <pre><code>describe('myFactory', function () {     // Load your module.     beforeEach(module('MyApp'));      // Setup the mock service in an anonymous module.     beforeEach(module(function ($provide) {         $provide.service('$window', function(){             this.alert= jasmine.createSpy('alert');         });     }));      it('can get an instance of my factory', inject(function(sampleSvc) {         expect(sampleSvc).toBeDefined();     })); }); </code></pre>  <p>Fails on 3rd party angulartics:</p>  <p><a href="http://i.stack.imgur.com/2Dxc1.png" rel="nofollow"><img src="http://i.stack.imgur.com/2Dxc1.png" alt="Karma result"></a></p>  <p>When I remove angulartics from the app.config it fails on hotkeys: <a href="http://i.stack.imgur.com/rajt7.png" rel="nofollow"><img src="http://i.stack.imgur.com/rajt7.png" alt="enter image description here"></a></p>  <p>This is new for me. </p>  <ol> <li>Should I use a different app.js for testing?</li> <li>Is there a reason why Karma fails on 3rd party DOM providers? Is there a DOM ready on time?</li> </ol>  <p>My config part of app.js:</p>  <pre><code> app.config(['$routeProvider', '$translateProvider', 'i18n', '$analyticsProvider', function ($routeProvider, $translateProvider, i18n, $analyticsProvider) {     $analyticsProvider.developerMode(true);     $analyticsProvider.firstPageview(true);     /* Records pages that don't use $state or $route */     $analyticsProvider.withAutoBase(true);      $routeProvider.         when('/welcome', {             templateUrl: 'partials/welcome/welcome.html',             controller: 'WelcomeCtrl'         }).         when('/main', {             templateUrl: 'partials/main/main.html',             controller: 'MainCtrl',             hotkeys: [                 ['tab', 'Add a new task', 'addNewEventByTab()']             ]         }).         when('/migration', {             templateUrl: 'partials/migration/migration.html',             controller: 'MigrationCtrl'         }).         when('/loadingPage', {             templateUrl: 'partials/loadingPage/loadingPage.html',             controller: 'LoadingPageCtrl'         }).         when('/beta', {             templateUrl: 'partials/closedBeta/closedBeta.html',             controller: 'ClosedBetaCtrl'         }).         otherwise({             redirectTo: '/loadingPage'         }); }]); </code></pre>