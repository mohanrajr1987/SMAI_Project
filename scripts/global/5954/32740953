<p>I am trying to configure a security domain for my JBoss EAP 6 application in which the primary means of authentication will be a Smart Card, but in the absence of the card will accept LDAP authentication. I have been able to do either one, but not both. The password stacking option is supposed to allow each module to be run, to allow the LDAP module, for instance, to retrieve the roles even when the Certificate module has returned the user identity. However, the application's web.xml needs to specify a login-config with an auth-method. In the case of Certificate, this is CLIENT-CERT, and with LDAP it's BASIC. Has anyone found a way to allow both of these modules to be chained together successfully? My standalone security domain looks like this:</p>  <pre><code>    &lt;security-domain name="MySecurityDomain" cache-type="default"&gt; &lt;authentication&gt;     &lt;login-module code="Certificate" flag="required"&gt;         &lt;module-option name="password-stacking" value="useFirstPass"/&gt;         &lt;module-option name="securityDomain" value="MySecurityDomain"/&gt;         &lt;module-option name="verifier" value="org.jboss.security.auth.certs.AnyCertVerifier"/&gt;     &lt;/login-module&gt;     &lt;login-module code="LdapExtended" flag="required"&gt;         &lt;module-option name="password-stacking" value="useFirstPass"/&gt;         &lt;module-option name="java.naming.factory.initial" value="com.sun.jndi.ldap.LdapCtxFactory"/&gt;         &lt;module-option name="java.naming.security.authentication" value="simple"/&gt;         &lt;module-option name="java.naming.provider.url" value="ldap://my.fully.qualified.domain:389"/&gt;         &lt;module-option name="bindDN" value="FULLY\username"/&gt;         &lt;module-option name="bindCredential" value="mypassword"/&gt;         &lt;module-option name="baseCtxDN" value="CN=Users,DC=fully,DC=qualified,DC=domain"/&gt;         &lt;module-option name="baseFilter" value="(sAMAccountName={0})"/&gt;         &lt;module-option name="rolesCtxDN" value="CN=Users,DC=fully,DC=qualified,DC=domain"/&gt;         &lt;module-option name="roleFilter" value="(member={1})"/&gt;         &lt;module-option name="roleAttributeIsDN" value="true"/&gt;         &lt;module-option name="roleAttributeID" value="memberOf"/&gt;         &lt;module-option name="roleNameAttributeID" value="name"/&gt;         &lt;module-option name="allowEmptyPasswords" value="false"/&gt;     &lt;/login-module&gt;     &lt;login-module code="org.picketlink.identity.federation.bindings.jboss.auth.RegExUserNameLoginModule" flag="optional"&gt;         &lt;module-option name="regex" value="CN=(.*?),"/&gt;     &lt;/login-module&gt;     &lt;login-module code="Database" flag="required"&gt;         &lt;module-option name="password-stacking" value="useFirstPass"/&gt;         &lt;module-option name="dsJndiName" value="java:jboss/datasources/myDS"/&gt;         &lt;module-option name="rolesQuery" value="select role, 'Roles' from Principal where name=?"/&gt;     &lt;/login-module&gt; &lt;/authentication&gt; &lt;jsse truststore-password="mykeypass" truststore-url="${jboss.server.config.dir}/truststore.jks" client-auth="true"/&gt; &lt;audit&gt;     &lt;provider-module code="LogAuditProvider"/&gt; &lt;/audit&gt; </code></pre>  <p></p>