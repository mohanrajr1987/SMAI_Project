<p>There are two classes, UserDevice(&lt; ActiveRecord::Base) and NotificationAdapter.<br> In NotificationAdapter, I use AWS SDK, and UserDevice uses NotificationAdapter instance.<br> The Joint point is below,</p>  <pre><code>protected def notificationAdapter   @notificationAdapter ||= NotificationAdapter.new(self) end </code></pre>  <p>In UserDevice test, I want to make temporary NotificationAdapter mock for replacing the original NotificationAdapter, and use this mock only in the test.<br> But I don't know how to do, because this is my first case using mock in test.   </p>  <p>I think it requires two steps below,</p>  <ol> <li><p>Make temporary NotificationAdapter class(NorificationAdapterMock) in test code.</p>  <p><code>NotificationAdapterMock = MiniTest::Mock.new  mock.expect :setEndpoint, 'arn:testEndpoint'  mock.expect :subscribeToAnnouncement, true</code></p></li> <li><p>Change notificationAdapter method of UserDevice to below,</p>  <p><code>protected def notificationAdapter    @notificationAdapter ||= NotificationAdapterMock  end</code></p></li> </ol>  <p>But I don't know whether it is right or wrong. What should I do?</p>