<p>Rather than downloading a file straight, I decide to just download a file via ftp and then rename the downloaded file to the correct name. That way the time where the file is malfunctioning is minimal.</p>  <p>Here is the "essence" of the code</p>  <pre><code>$status=ftp_get($conn_id, $temp , $filename, $mode); rename ( $temp , $filename ); </code></pre>  <p>I basically got an error saying that file $temp is in use so can't rename.</p>  <p>The thing is the download is finish.</p>  <p>Should I close the file or something? How to tell PhP, hello, $temp is done, now I need to rename it.</p>  <p>This is the more comprehensive version of the code</p>  <pre><code>function dealWithOneFile($filename,$conn_id) {     $ftpsize = ftp_size ($conn_id, $filename);      $ext = pathinfo($filename, PATHINFO_EXTENSION);      if ($ext == "php" || $ext == "bin" || $ext == "dat" || $ext == "BIN" || $ext == "inc")     {     }     else     {         return;     }      while(false)     if (file_exists ($filename ))     {         $filesize =filesize ($filename);          if ($filesize==$ftpsize)         {             echo "file size is the same with the one we have here\n";             return;         }     }     $temp = "temp.bin";      $mode= FTP_BINARY;      if ($ext=="php")     {         $mode = FTP_ASCII ;     }      $status=ftp_get($conn_id, $temp , $filename, $mode);      if ($status) {         echo "Successfully written $filename to $temp\n";         if (file_exists($filename))         {              $tempsize = filesize ($temp);              if ($filesize==$tempsize)             {                 echo "file size is the same with the one we have here\n";                 return;             }         }         while(false);         //unlink ($filename);         rename ( $temp , $filename );          echo "Succesfully update $filename \n";          } else {         echo "There was a problem\n";     } } </code></pre>