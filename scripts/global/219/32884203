<p>I am working on a data exchange integration with my client and the data they send me is encrypted using their C# <code>encrypt</code> method (below). </p>  <p>My app is running PHP 5.3 and I need an equivalent code to decrypt the data they send. I have the PHP code but it'd not decrypt the client data correctly for me. </p>  <p>Clearly I am making some mistake in my encryption/decryption methods, IV key or something. Can anyone spot the mistake? </p>  <p>Thanks.</p>  <p><strong>C# Code (From my client):</strong></p>  <pre><code>using System; using System.Security.Cryptography; using System.Text; using System.IO;  public class Program {     public static void Main()     {         var text = "this is a plain string";         var enc = Program.Encrypt(text);         Console.WriteLine(enc);         Console.WriteLine(Program.Decrypt(enc));     }      public static string Encrypt(string clearText)     {         var EncryptionKey = "1234567890123456";         byte[] clearBytes = Encoding.Unicode.GetBytes(clearText);         using (Aes encryptor = Aes.Create())         {             byte[] IV = new byte[15];             var rand = new Random();             rand.NextBytes(IV);             Rfc2898DeriveBytes pdb = new Rfc2898DeriveBytes(EncryptionKey, IV);             encryptor.Key = pdb.GetBytes(32);             encryptor.IV = pdb.GetBytes(16);             using (MemoryStream ms = new MemoryStream())             {                 using (CryptoStream cs = new CryptoStream(ms, encryptor.CreateEncryptor(), CryptoStreamMode.Write))                 {                     cs.Write(clearBytes, 0, clearBytes.Length);                     cs.Close();                 }                  clearText = Convert.ToBase64String(IV) + Convert.ToBase64String(ms.ToArray());             }         }          return clearText;     }      public static string Decrypt(string cipherText)     {         var EncryptionKey = "1234567890123456";         byte[] IV = Convert.FromBase64String(cipherText.Substring(0, 20));         cipherText = cipherText.Substring(20).Replace(" ", "+");         byte[] cipherBytes = Convert.FromBase64String(cipherText);         using (Aes encryptor = Aes.Create())         {             Rfc2898DeriveBytes pdb = new Rfc2898DeriveBytes(EncryptionKey, IV);             encryptor.Key = pdb.GetBytes(32);             encryptor.IV = pdb.GetBytes(16);             using (MemoryStream ms = new MemoryStream())             {                 using (CryptoStream cs = new CryptoStream(ms, encryptor.CreateDecryptor(), CryptoStreamMode.Write))                 {                     cs.Write(cipherBytes, 0, cipherBytes.Length);                     cs.Close();                 }                  cipherText = Encoding.Unicode.GetString(ms.ToArray());             }         }          return cipherText;     } } </code></pre>  <p><strong>PHP Code I have:</strong></p>  <pre><code>public function encrypt($plainText) {     $secretKey = '1234567890123456';      return rtrim(         base64_encode(             mcrypt_encrypt(                 MCRYPT_RIJNDAEL_256,                 $secretKey, $plainText,                 MCRYPT_MODE_ECB,                 mcrypt_create_iv(                     mcrypt_get_iv_size(                         MCRYPT_RIJNDAEL_256,                         MCRYPT_MODE_ECB                     ),                     MCRYPT_RAND)             )         ), "\0"     ); }  public function decrypt($encodedData) {     $secretKey = '1234567890123456';      return rtrim(         mcrypt_decrypt(             MCRYPT_RIJNDAEL_256,             $secretKey,             base64_decode($encodedData),             MCRYPT_MODE_ECB,             mcrypt_create_iv(                 mcrypt_get_iv_size(                     MCRYPT_RIJNDAEL_256,                     MCRYPT_MODE_ECB                 ),                 MCRYPT_RAND             )         ), "\0"     ); } </code></pre>