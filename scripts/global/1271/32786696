<p>I have a script that parses DNS info in a certain file. The code looks like this and expects 2 instances of the line from the dump file. </p>  <pre><code>nxdom_1st=`grep 'resulted in NXDOMAIN' $path_tmp/named.stats.tmp | awk '{ print $1 }' | grep -m1 ''` nxdom_2nd=`grep 'resulted in NXDOMAIN' $path_tmp/named.stats.tmp | awk '{ print $1 }' | sort -n | grep -m1 ''` </code></pre>  <p>Then, below another command in the script tells it to subtract the results:</p>  <pre><code>if [ "$nxdom_1st" == '' ] then     nxdomain=0 else     nxdomain=`expr $nxdom_1st - $nxdom_2nd` </code></pre>  <p>Problem is, the dump file eventually contains 4 lines for "resulted in NXDOMAIN", 2 for the actual DNS zone and 2 from localhost, and the script cant handle it so I get no results. For instance, when the dump file contains a pattern like this:</p>  <pre><code>             [localhost.localdomain]              [155.168.192.in-addr.arpa]              20 queries resulted in NXDOMAIN              20 queries resulted in NXDOMAIN </code></pre>  <p>In this example the lines with "20" are causing the problem because they are from a local service (I <em>think</em>) that is querying itself. Hence the "localhost.localdomain" which always appears before the problem lines. On the server I don't want to disable queries to itself using localhost, so how can I modify the script to discard results if the lines above what its looking for contains [155.168.192.in-addr.arpa] or [localhost.localdomain]?</p>  <p>Below is the file dump that the script parses. Unfortunately, right now there have been no queries to localhost, so you will not see what I posted up above.  The localhost.localdomain and the [155.168.192.in-addr.arpa] lines are present, just no queries picked up on these 2 stat dumps. Again, this problem only occurs when there are queries listed under these 2 lines, which is why I was wondering if I could modify the grep string in the script to exclude any "resulted in NXDOMIAN" results that may occur directly after. Something like, "if resulted in NXDOMAIN" is seen within 10 lines below "localhost.localdomain", ignore/discard/etc..</p>  <pre><code>--- Statistics Dump --- (1443199511) [id.server (view: _bind)] [authors.bind (view: _bind)] [hostname.bind (view: _bind)] [version.bind (view: _bind)] [8.B.D.0.1.0.0.2.IP6.ARPA] [B.E.F.IP6.ARPA] [A.E.F.IP6.ARPA] [9.E.F.IP6.ARPA] [8.E.F.IP6.ARPA] [D.F.IP6.ARPA] [0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.IP6.ARPA] [255.255.255.255.IN-ADDR.ARPA] [113.0.203.IN-ADDR.ARPA] [100.51.198.IN-ADDR.ARPA] [2.0.192.IN-ADDR.ARPA] [254.169.IN-ADDR.ARPA] [127.IN-ADDR.ARPA] [0.in-addr.arpa] [1.0.0.127.in-addr.arpa] [1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.ip6.arpa] [localhost] [localhost.localdomain] [155.168.192.in-addr.arpa] [testdns.net] ++ Per Zone Query Statistics ++               53 UDP/IPv6 send errors               26 TCP/IPv4 connections accepted              179 UDP/IPv4 connections established               53 UDP/IPv6 socket connect failures               25 TCP/IPv4 sockets closed               53 UDP/IPv6 sockets closed              181 UDP/IPv4 sockets closed                2 TCP/IPv6 sockets opened                2 TCP/IPv4 sockets opened               54 UDP/IPv6 sockets opened              182 UDP/IPv4 sockets opened ++ Socket I/O Statistics ++ [View: _bind (Cache: _bind)]                4 NXDOMAIN                1 !DS                5 DNSKEY                6 NSEC               30 RRSIG                9 DS               42 AAAA               20 NS               75 A [View: default] ++ Cache DB RRsets ++ [View: _bind]               20 queries with RTT 100-500ms              159 queries with RTT 10-100ms               27 DNSSEC NX validation succeeded               63 DNSSEC validation succeeded               90 DNSSEC validation attempted                2 IPv6 NS address fetch failed               17 IPv6 NS address fetches               17 IPv4 NS address fetches               52 query retries               18 NXDOMAIN received              179 IPv4 responses received               53 IPv6 queries sent              179 IPv4 queries sent [View: default] [Common] ++ Resolver Statistics ++                2 IPv4 notifies sent ++ Zone Maintenance Statistics ++               54 queries caused recursion              625 queries resulted in NXDOMAIN             1270 queries resulted in non authoritative answer              645 queries resulted in successful answer             1251 responses with EDNS(0) sent             1270 responses sent             1251 requests with EDNS(0) received             1270 IPv4 requests received ++ Name Server Statistics ++ [View: _bind]               16 DLV               22 DNSKEY               15 DS               39 AAAA               12 NS              128 A [View: default] ++ Outgoing Queries ++             1270 A ++ Incoming Queries ++             1270 QUERY ++ Incoming Requests ++ +++ Statistics Dump +++ (1443199511) --- Statistics Dump --- (1443199211) [id.server (view: _bind)] [authors.bind (view: _bind)] [hostname.bind (view: _bind)] [version.bind (view: _bind)] [8.B.D.0.1.0.0.2.IP6.ARPA] [B.E.F.IP6.ARPA] [A.E.F.IP6.ARPA] [9.E.F.IP6.ARPA] [8.E.F.IP6.ARPA] [D.F.IP6.ARPA] [0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.IP6.ARPA] [255.255.255.255.IN-ADDR.ARPA] [113.0.203.IN-ADDR.ARPA] [100.51.198.IN-ADDR.ARPA] [2.0.192.IN-ADDR.ARPA] [254.169.IN-ADDR.ARPA] [127.IN-ADDR.ARPA] [0.in-addr.arpa] [1.0.0.127.in-addr.arpa] [1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.ip6.arpa] **[localhost] [localhost.localdomain] [155.168.192.in-addr.arpa]** [testdns.net] ++ Per Zone Query Statistics ++               53 UDP/IPv6 send errors               25 TCP/IPv4 connections accepted              172 UDP/IPv4 connections established               53 UDP/IPv6 socket connect failures               24 TCP/IPv4 sockets closed               53 UDP/IPv6 sockets closed              174 UDP/IPv4 sockets closed                2 TCP/IPv6 sockets opened                2 TCP/IPv4 sockets opened               54 UDP/IPv6 sockets opened              175 UDP/IPv4 sockets opened ++ Socket I/O Statistics ++ [View: _bind (Cache: _bind)]                4 NXDOMAIN                2 !DS                5 DNSKEY                6 NSEC               30 RRSIG                9 DS               43 AAAA               20 NS               75 A [View: default] ++ Cache DB RRsets ++ [View: _bind]               20 queries with RTT 100-500ms              152 queries with RTT 10-100ms               24 DNSSEC NX validation succeeded               60 DNSSEC validation succeeded               84 DNSSEC validation attempted                2 IPv6 NS address fetch failed               17 IPv6 NS address fetches               17 IPv4 NS address fetches               52 query retries               16 NXDOMAIN received              172 IPv4 responses received               53 IPv6 queries sent              172 IPv4 queries sent [View: default] [Common] ++ Resolver Statistics ++                2 IPv4 notifies sent ++ Zone Maintenance Statistics ++               50 queries caused recursion              592 queries resulted in NXDOMAIN             1203 queries resulted in non authoritative answer              611 queries resulted in successful answer             1185 responses with EDNS(0) sent             1203 responses sent             1185 requests with EDNS(0) received             1203 IPv4 requests received ++ Name Server Statistics ++ [View: _bind]               16 DLV               21 DNSKEY               14 DS               39 AAAA               12 NS              123 A [View: default] ++ Outgoing Queries ++             1203 A ++ Incoming Queries ++             1203 QUERY ++ Incoming Requests ++ +++ Statistics Dump +++ (1443199211) </code></pre>  <p>Ok, its happening now, here is a new snippet dump file. Notice the query info under the localhost.localdomain lines: It happens twice in the file. </p>  <pre><code>[localhost.localdomain] [155.168.192.in-addr.arpa]                1 queries resulted in NXDOMAIN                1 queries resulted in nxrrset                3 queries resulted in authoritative answer                1 queries resulted in successful answerenter code here  [localhost] [localhost.localdomain] [155.168.192.in-addr.arpa]                1 queries resulted in NXDOMAIN                1 queries resulted in nxrrset                3 queries resulted in authoritative answer                1 queries resulted in successful answer </code></pre>  <p>Basically I need the script to ignore these queries and only get the ones for the DNS zone I am using. </p>