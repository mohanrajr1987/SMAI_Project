<p>ive been told by my collegue to do this </p>  <p>"Perhaps what you can do is run a second table between #Basic and #Product where you only update the new retail column with the top 1 based on valid from desc for each currency code from #Basic?"</p>  <pre><code>Create Table #Basic( ProductCode Int, ContractNo Int, ProductDescription Varchar (max), CGNo Nvarchar(MAX), SCGNo Nvarchar(MAX), EmpNo Int, CurrencyCode NVARCHAR(MAX), Retail decimal (38,  2), ValidFrom datetime, Active int, ValidForCountry int )  Insert Into #Basic   SELECT c.ProductCode ,ContractNo ,p.Description ,p.CGNo ,p.SCGNo ,p.EmpNo ,r.CurrencyCode ,r.Retail ,r.ValidFrom ,p.active ,c.Validforcountry FROM CONTRACT c LEFT JOIN (SELECT Distinct ProductCode, CurrencyCode, Retail, ValidFrom From DIVRETAIL) as r on c.ProductCode = r.ProductCode LEFT JOIN product p on c.ProductCode = p.ProductCode WHERE ContractNo = 144546 And r.ValidFrom &lt;= @enddate  SELECT Distinct ProductCode, CurrencyCode, Retail, ValidFrom From DIVRETAIL update #Basic  set Retail =(  select top 1 retail From DIVRETAIL    create table #basicretail (ProductCode int ,ContractNo int ,Description varchar(MAX) ,CGNo int ,SCGNo int ,EmpNo int ,CurrencyCode varchar(10) ,Retail int ,ValidFrom datetime ,active int ,Validforcountry int )   CREATE TABLE #Product ( ProductCode Int, ContractNo Int, ProductDescription Varchar (max), CGNo Nvarchar(MAX), SCGNo Nvarchar(MAX), EmpNo Int, CurrencyCode NVARCHAR(MAX), Retail decimal (38,  2), ValidFrom datetime, Active int, ValidForCountry int, Cost decimal (38,3) )  INSERT INTO #Product SELECT ProductCode ,ContractNo ,ProductDescription  ,CGNo ,SCGNo ,EmpNo ,CurrencyCode ,Retail ,ValidFrom ,Active ,ValidForCountry ,NULL FROM #basic  UPDATE #Product SET #Product.Cost = (CASE WHEN #Product.CurrencyCode = 'EUR' THEN (SELECT TOP 1 Case when c.IncoTermtype IN (1,9) then b.DDP/p.Packsize when c.IncoTermtype IN (2,12) then b.DAT/p.Packsize when c.IncoTermtype = 10 then (b.FOB+b.Freight)/p.Packsize when c.IncoTermtype = 13 then (b.ExWorks+Freight)/p.Packsize else 0 End as         Casecost  FROM braketvalue b LEFT JOIN CONTRACT c on b.ContractNo = c.ContractNo LEFT JOIN PRODUCT p on c.ProductCode = p.ProductCode WHERE ValidFrom &lt;= @enddate AND b.DivNo like '8__' AND #Product.CurrencyCode = 'EUR' AND #Product.ContractNo = b.ContractNo) ELSE (SELECT TOP 1 Case when c.IncoTermtype IN (1,9) then b.DDP/p.Packsize when c.IncoTermtype IN (2,12) then b.DAT/p.Packsize when c.IncoTermtype = 10 then (b.FOB+b.Freight)/p.Packsize when c.IncoTermtype = 13 then (b.ExWorks+Freight)/p.Packsize else 0 End as     Casecost  FROM braketvalue b LEFT JOIN CONTRACT c on b.ContractNo = c.ContractNo LEFT JOIN PRODUCT p on c.ProductCode = p.ProductCode WHERE ValidFrom &lt;= @enddate AND b.DivNo like '7__' AND #Product.CurrencyCode = 'Â£' AND #Product.ContractNo = b.ContractNo) END ) </code></pre>