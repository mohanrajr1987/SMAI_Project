<p>When archiving my iOS app the Windows Azure Mobile Services library fails to build.</p>  <p><strong>The App builds fine when using Debug configuration.</strong></p>  <p>While running this script:</p>  <pre><code> /bin/sh -c \"/Users/user/Library/Developer/Xcode/DerivedData/myapp-bxucrfbhixkrpqfwaaovtqqpsvyd/Build/Intermediates/ArchiveIntermediates/MyApp\ (testing)/IntermediateBuildFilesPath/WindowsAzureMobileServices.build/Release-iphoneos/WindowsAzureMobileServices.build/Script-E8E37A27161FAA9600C13F00.sh\" </code></pre>  <p>This turns out to be, this script form the "Build Phases" tab:</p>  <pre><code># Exit immediately on any errors set -e  # Set some variables OUTPUT=${BUILT_PRODUCTS_DIR} WAMS="WindowsAzureMobileServices" WAMS_FRAMEWORK="${WAMS}.framework" WAMS_LIB="lib${WAMS}.a" HEADERS="Headers"  # Create the needed directories for the framework mkdir -p "${OUTPUT}/${WAMS_FRAMEWORK}/Versions/A" mkdir -p "${OUTPUT}/${WAMS_FRAMEWORK}/Versions/A/Headers"  # Add the headers and lib to the framework cp -a "${OUTPUT}/${HEADERS}/" "${OUTPUT}/${WAMS_FRAMEWORK}/Versions/A/Headers" lipo -create "${OUTPUT}/${WAMS_LIB}" -output "${OUTPUT}/${WAMS_FRAMEWORK}/Versions/A/${WAMS}"  # Set up the links to complete the framework ln -sf Versions/Current/Headers "${OUTPUT}/${WAMS_FRAMEWORK}/Headers" ln -sf "Versions/Current/${WAMS}" "${OUTPUT}/${WAMS_FRAMEWORK}/${WAMS}" ln -sf A "${OUTPUT}/${WAMS_FRAMEWORK}/Versions/Current" </code></pre>  <p>It fails with this error:</p>  <blockquote>   <p>cp:   /Users/user/Library/Developer/Xcode/DerivedData/MyApp-bxucrfbhixkrpqfwaaovtqqpsvyd/Build/Intermediates/ArchiveIntermediates/MyApp   (testing)/BuildProductsPath/Release-iphoneos/Headers/: No such file or   directory</p> </blockquote>  <p>I'm assuming that the error corresponds to this line:</p>  <pre><code>cp -a "${OUTPUT}/${HEADERS}/" "${OUTPUT}/${WAMS_FRAMEWORK}/Versions/A/Headers" </code></pre>  <p>I cannot see any differences in the build settings between <code>Release</code> and <code>Debug</code>.</p>  <h2>Update</h2>  <p>After some investigation I have determined that when Xcode archives a product it does not create the "headers" folder in <code>${BUILT_PRODUCTS_DIR}</code>. It instead puts them in `/Build/Intermediates/ArchiveIntermediates/UninstalledProducts'. So the script fails. </p>  <p>Setting the "Skip Install" to <code>NO</code> for the Release build and then checking for the existence of the <code>${INSTALL_DIR}</code> in the script will successfully build the library.</p>  <pre><code>if [ -d "${INSTALL_DIR}" ]; then     cp -a "${INSTALL_DIR}/" "${OUTPUT}/${WAMS_FRAMEWORK}/Versions/A/Headers" else     cp -a "${OUTPUT}/${HEADERS}/" "${OUTPUT}/${WAMS_FRAMEWORK}/Versions/A/Headers" fi </code></pre>  <p>However, Xcode failed to build because it can't find the headers:</p>  <pre><code>fatal error: 'WindowsAzureMobileServices/WindowsAzureMobileServices.h' file not found #import &lt;WindowsAzureMobileServices/WindowsAzureMobileServices.h&gt; </code></pre>  <h2>Update 2</h2>  <p>Setting "Skip install" to no causes archiving issues, see this question: <a href="http://stackoverflow.com/q/5584317/89035">Compile, Build or Archive problems with Xcode 4 (and dependencies)</a></p>  <p>So I have removed the script that fails in the build phases and added <code>"${PROJECT_DIR}/../azure-mobile-services/sdk/iOS/src"</code> to the "User Header Search Paths" list.</p>  <p>This is messy and not my preferred solution.</p>