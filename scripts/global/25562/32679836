<p>I am modifying a script that calculates in time the absence someone is outside of an area.</p>  <p>I have written the script that calculates a person’s absence and I’m now trying to write the absence summary record.</p>  <p>Each absence record in attributed to a date field, denoting the date the absence is representative of.</p>  <p>Now what I would like to do is use the absence figure to find the percentage of someone’s absence, against the duration of time they should have been present. </p>  <pre class="lang-vb prettyprint-override"><code>'create total time record set rstotal = conn.execute("select sum(total) as total, visitdate from table_summaries where repid= " &amp; session("repid") &amp; " and sumtype=1 group by visitdate ")    while not rstotal.eof      sumtdate = rstotal("visitdate")     sumtotal = rstotal("total")      'script for nextid      'insert report summary record     set inssum = conn.execute("insert into table_summaries (sumid,sumtype,repid,visitdate,total) values(" &amp; sumid &amp; ",2," &amp; session("repid") &amp; ",'" &amp; sumtdate &amp; "', " &amp; sumtotal &amp; ")")      'count visits     set rsvcount = conn.execute("select sum(visits) as total, visitdate from table_summaries where repid = " &amp; session("repid") &amp; " and sumtype = 1 group by visitdate")      vcount = rsvcount("total")     vcdate = rsvcount("visitdate")       'insert visits to summary record     set udsummary = conn.execute("update table_summaries set visits = " &amp; vcount &amp; " where sumid = " &amp; sumid &amp; " and visitdate = '" &amp; vcdate &amp; "' ")      'calculate avg time per visit      avg = sumtotal / vcount       'insert avg to summary record       set udsummary = conn.execute("update table_summaries set avgvisit = " &amp; avg &amp; " where sumid = " &amp; sumid &amp; " and visitdate = '" &amp; vcdate &amp; "' ")       'update report status      set udrep = conn.execute("update table_reports set status = 6, published = 1 where repid = " &amp; session("repid") &amp; "")       'calculate duration of reporting period      set rsdur = conn.execute("select datefrom, dateto, convert(date,datefrom,103) as visitdate from table_reports where repid = " &amp; session("repid") &amp; "")        repdat = rsdur("visitdate")       repdur = datediff("s",rsdur("datefrom"),rsdur("dateto"))        'get absence total       set rsab = conn.execute("select sum(total) as total, visitdate from tabel_absence where repid = " &amp; session("repid") &amp; " and type = 2 group by visitdate ")         abdat = rsab("visitdate")          if not rsab.eof then           abdur = rsab("total")         else           abdur = 0         end if                                                                                                 'calculate percentage absence       percent = round(abdur/(repdur/100),2)                                                                                                'calculate percentage on beat      percentTob = round(sumtotal/(repdur/100),2)       'script for nextid       'insert Absence summary record      set inssum = conn.execute("insert into table_summaries (sumid,sumtype,repid,total,visitdate,percentage) values(" &amp; sumid &amp; ",5," &amp; session("repid") &amp; "," &amp; abdur &amp; ",'" &amp; abdat &amp; "'," &amp; percent &amp; ")")        'insert ToB summary record       set inssumTob = conn.execute("insert into table_summaries (sumid,sumtype,repid,total,visitdate,percentage) values(" &amp; sumid &amp; ",8," &amp; session("repid") &amp; "," &amp; repdur &amp; ",'" &amp; repdat &amp; "'," &amp; percentTob &amp; ")")    rstotal.movenext  wend  rstotal.close set rstotal = nothing </code></pre>  <p>The result I'm currently getting is the first row is being inserted and duplicate. The update function appears to update the first days results but not any subsequent days.</p>