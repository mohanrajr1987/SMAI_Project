<p>Can not get coupons to apply the discount to an order. (programmatically creating a new order)</p>  <p>Here's the code:</p>  <pre><code>$order = wc_create_order(); $order-&gt;add_product( get_product( $pid ), $item['quantity'] ); // pid 8 &amp; qty 1 $order-&gt;set_address( $address_billing, 'billing' ); $order-&gt;set_address( $address_shipping, 'shipping' ); $order-&gt;add_coupon( $discount['code'], ($discount['amount']/100) ); // not pennies (use dollars amount) $order-&gt;set_total( ($discount['amount']/100) , 'order_discount'); // not pennies (use dollar amount) $order-&gt;set_payment_method($this); $rate = new WC_Shipping_Rate(  $response_body['shippingMethodCode'] , $ship_method_title, ($response_body['shippingCost']/100), array(), $response_body['shippingMethodCode'] ); $order-&gt;add_shipping( $rate ); $order-&gt;calculate_totals(); $return_url = $this-&gt;get_return_url( $order ); </code></pre>  <p>The order is created in Woocommerce and everything looks good except the coupon code being applied does not reflect the discount amount on the return url thank you page -and- not in the wp-admin when viewing the Woocommerce order -and- not in the New customer order email that gets sent out .... </p>  <p>It does show the coupon code in the wp-admin but the discount line still shows $0 and the total doesn't show any amount subtracted.  </p>  <p>Anyone know what is being done wrong here? been at this for a couple weeks now and can't seem to resolve.</p>