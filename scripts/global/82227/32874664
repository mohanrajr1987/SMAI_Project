<p>After payment by the buyer on my website only comes in the form of a notice of variables</p>  <pre><code>$_POST["Notification_type"]; $_POST["Operation_id"]; $_POST["Amount"]; $_POST["Currency"]; $_POST["Datetime"]; $_POST["Sender"]; $_POST["Codepro"]; $_POST["Label"]; $_POST["Sha1_hash"]; $_POST["Test_notification"]; </code></pre>  <p>The values ​​of variables reported that payment has been made. The value of the variable $ _POST ["Label"] - it is a number of order. I need to order status is changed to "in processing". When the status of processing - the letter is sendig to customer. I am only interested in quick sending messages from the website to the buyer. A payment is correct then I will check.</p>  <p>I'm in front of the gateway insert the following code:</p>  <pre><code>$test='1'; $notification_secret="xxxxxxxxxxxxxxxx"; $notification_type=$_POST["notification_type"];  $operation_id=$_POST["operation_id"]; $amount=$_POST["amount"]; $currency=$_POST["currency"]; $datetime=$_POST["datetime"]; $sender=$_POST["sender"]; $codepro=$_POST["codepro"]; $label=$_POST["label"]; $sha1_hash=$_POST["sha1_hash"]; $test_notification=$_POST["test_notification"];  $hash=$notification_type.'&amp;'.$operation_id.'&amp;'.$amount.'&amp;'.$currency. '&amp;'.$datetime.'&amp;'.$sender.'&amp;'.$codepro.'&amp;'.$notification_secret.'&amp;'.$label;  $sha1=hash("sha1", $hash);  $test_wr=fopen('testlog.txt','a+'); fwrite($test_wr, "$notification_type\r\n$operation_id\r\n$amount\r\n$currency\r\n$datetime\r\n$sender\r\n$codepro\r\n$label\r\n$sha1_hash\r\n$sha1\r\n$test_notification\r\n"); fclose($test_wr); </code></pre>  <p>the value of $ _POST variables are recorded in the testlog.txt, on which I can verify the correctness of payment. But I only need a fast sending letters to the buyer after payment. Because in the gateway after method "public function generate_form ($ order_id)", in the function "function check_ipn_response" I wrote this code:</p>  <pre><code>function check_ipn_response(){             global $woocommerce;                   $order = new WC_Order($_POST['label']);                   $order-&gt;update_status('processing',__('The payment has been paid','woocommerce'));                   $woocommerce-&gt;cart-&gt;empty_cart();         } </code></pre>  <p>However, the code is not running. After payment order remains in the status "Pending payment". And the letter is not sent to the buyer.</p>