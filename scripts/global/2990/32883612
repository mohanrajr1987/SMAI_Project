<p>I've tried to use custom id-generator as in <a href="http://stackoverflow.com/questions/3194721/bypass-generatedvalue-in-hibernate-merge-data-not-in-db">Bypass GeneratedValue in Hibernate (merge data not in db?)</a> and it works fine while working with Postgres DB. My code is equals to the code in example. But while running test with H2 in-memory database I faced the problem, that id is not generated automaticaly.</p>  <p><strong>Without</strong> custom generator</p>  <pre><code>@Column(name = "id", nullable = false) @Id @GeneratedValue(strategy = GenerationType.IDENTITY) private Long id; </code></pre>  <p>Generated create table script</p>  <pre><code>create table db.schema.entity (id  bigserial not null... </code></pre>  <p><strong>With</strong> custom generator</p>  <pre><code>@Column(name = "id", nullable = false) @Id @GeneratedValue(generator = "idGenerator", strategy = GenerationType.IDENTITY) @GenericGenerator(name="idGenerator", strategy = "...UseIdOrGenerate") private Long id; </code></pre>  <p>Generated create table script</p>  <pre><code>create table db.schema.entity (id int8 not null... </code></pre>  <p>As a result tests don't work.</p>