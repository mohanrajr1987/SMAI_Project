<p>Ok, this is a continuation to my original question. (<a href="http://stackoverflow.com/questions/32721334/wso2-esb-filtering-messages-to-an-output-file">WSo2 Esb filtering messages to an output file</a>) After a couple more days of research into the iterate and aggregate mediator I have reached a progress wall and would be very grateful for any advice how to resolve my blocking issue. The task at hand is simple, read and xml file, filter on certain records, and only produce an output xml file with just those records that meet the criteria. After previous discussion and research this tasks solution is as follows: use a iterate mediator to access each xml record and use a filter mediator to decide what I want to keep. Then use a aggregator mediator to write all these records to 1 file. Without the aggregator my configuration is producing 1 record per file. Here is my proxy at this state:</p>  <pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt; &lt;proxy xmlns="http://ws.apache.org/ns/synapse"        name="RenFileFilterProxy"        transports="vfs"        statistics="disable"        trace="disable"        startOnLoad="true"&gt;    &lt;target&gt;       &lt;inSequence&gt;          &lt;log level="full"/&gt;          &lt;clone&gt;             &lt;target sequence="RenIqtFilterSequence"/&gt;          &lt;/clone&gt;       &lt;/inSequence&gt;       &lt;outSequence&gt;          &lt;log level="custom"&gt;             &lt;property name="sequence" value="In the outSequence"/&gt;          &lt;/log&gt;          &lt;log level="full"/&gt;          &lt;aggregate id="QuizType"&gt;             &lt;completeCondition&gt;                &lt;messageCount min="-1" max="-1"/&gt;             &lt;/completeCondition&gt;             &lt;onComplete xmlns:z="RowsetSchema" expression="//z:row"&gt;                &lt;call-template target="FileWriteTemplate"&gt;                   &lt;with-param name="targetFileName" value="TEST_FILE"/&gt;                   &lt;with-param name="addressUri" value="vfs:file:///var/process/ren/rrout"/&gt;                &lt;/call-template&gt;             &lt;/onComplete&gt;          &lt;/aggregate&gt;       &lt;/outSequence&gt;    &lt;/target&gt;    &lt;parameter name="transport.vfs.ActionAfterProcess"&gt;MOVE&lt;/parameter&gt;    &lt;parameter name="transport.PollInterval"&gt;15&lt;/parameter&gt;    &lt;parameter name="transport.vfs.MoveAfterProcess"&gt;file:///var/process/ren/extractedfiles&lt;/parameter&gt;    &lt;parameter name="transport.vfs.FileURI"&gt;file:///var/process/ren/extractedfiles&lt;/parameter&gt;    &lt;parameter name="transport.vfs.MoveAfterFailure"&gt;file:///var/process/ren/failure&lt;/parameter&gt;    &lt;parameter name="transport.vfs.FileNamePattern"&gt;test.xml&lt;/parameter&gt;    &lt;parameter name="transport.vfs.ContentType"&gt;application/xml&lt;/parameter&gt;    &lt;parameter name="transport.vfs.ActionAfterFailure"&gt;MOVE&lt;/parameter&gt;    &lt;description/&gt; &lt;/proxy&gt;  </code></pre>  <p>Here is the RenIqtFilterSequence:</p>  <pre><code>&lt;sequence xmlns="http://ws.apache.org/ns/synapse" name="RenIqtFilterSequence"&gt;    &lt;log level="custom"&gt;       &lt;property name="sequence" value="RenIqtFilterSequence"&gt;&lt;/property&gt;    &lt;/log&gt;    &lt;iterate xmlns:ns2="http://org.apache.synapse/xsd" xmlns:ns="http://org.apache.synapse/xsd" xmlns:z="RowsetSchema" expression="//z:row" id="QuizType"&gt;       &lt;target&gt;          &lt;sequence&gt;             &lt;log&gt;                &lt;property name="iteratesequence" value="Iterating through the the records"&gt;&lt;/property&gt;             &lt;/log&gt;             &lt;filter xmlns:rs="urn:schemas-microsoft-com:rowset" xpath="//z:row/@name='RP'"&gt;                &lt;then&gt;                   &lt;log level="custom"&gt;                      &lt;property name="sequence" value="Condition Write"&gt;&lt;/property&gt;                   &lt;/log&gt;                   &lt;log level="full"&gt;&lt;/log&gt;                   &lt;log level="custom"&gt;                      &lt;property name="sequence" value="Getting ready to aggregate"&gt;&lt;/property&gt;                   &lt;/log&gt;                &lt;/then&gt;                &lt;else&gt;                   &lt;log level="custom"&gt;                      &lt;property name="sequence" value="Condition Drop"&gt;&lt;/property&gt;                   &lt;/log&gt;                   &lt;drop&gt;&lt;/drop&gt;                &lt;/else&gt;             &lt;/filter&gt;          &lt;/sequence&gt;       &lt;/target&gt;    &lt;/iterate&gt; &lt;/sequence&gt; </code></pre>  <p>The issue I am facing now is I cannot get to the outSequence to perform my aggregator logic. The fact is I do not need to call a backend service for this process from the inSequence so I am struggling to find a clean way to get to my outSequence. Any Recomendations? I tried to include the aggregator mediator in my inSequence but it did not work, no output is produced. I figured the aggregator needs to be in the outSequence to capture all the records I filtered and then I can write them all out to 1 file.  I believe I need some configuration here:</p>  <pre><code>            &lt;filter xmlns:rs="urn:schemas-microsoft-com:rowset" xpath="//z:row/@name='RP'"&gt;                &lt;then&gt;                   &lt;log level="custom"&gt;                      &lt;property name="sequence" value="Condition Write"&gt;&lt;/property&gt;                   &lt;/log&gt;                   &lt;log level="full"&gt;&lt;/log&gt;                   &lt;log level="custom"&gt;                      &lt;property name="sequence" value="Getting ready to aggregate"&gt;&lt;/property&gt;                   &lt;/log&gt; ===============&gt; Need to transfer to OutSequence somehow here!!!!&lt;============                &lt;/then&gt;                &lt;else&gt; </code></pre>  <p>I have tried several approaches based on articles and blogs online but I just cannot put the final pieces in place. Any advice would be much appreciated. Thank you for your time reading this.</p>