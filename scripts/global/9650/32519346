<p>I'm a bit of a newbie to Pinvoke.</p>  <p>I have a large project that calls makes a call to a DLL called <code>vtmail.dll</code>. It worked fine in .Net 3.5 but on upgrading to .NET 4.0 I am getting a <code>PinvokeStackImbalance</code> exception</p>  <p>The calling code is a bit like this:</p>  <pre><code>VTMail vtMail = new VTMail(); ec = vtMail.SendMail("servername",    false,    "",    "",    "Subject",    "Sender Name",    "sender@mydomain.com",    "",    "sendto@theirdomain.com",    "reply@mydomain.com,    "Description",    "foldername",    false,    25); </code></pre>  <p>Checking the declaration in vtmail.dll is this:</p>  <pre><code>public int SendMail(string mailServer, bool login, string userName,                      string password, string subject, string fromName,                      string fromAddress, string toName, string toAddress,                      string replyToAddress, string bodyText, string folderToSend,                      bool encrypt, long smtpPortNo); </code></pre>  <p>I've searched around about this and it seems to be a known .Net 4.0 issue. Responses have always suggested adding <code>CallingConvention=CallingConvention.Cdecl</code> to the <code>DllImport</code> statement, but this particular call doesn't have a <code>DllImport</code> statement, the dll is just added as a reference to the project in Visual Studio and is thus available.</p>  <p>How can I fix this?</p>