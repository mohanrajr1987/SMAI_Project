<blockquote>   <p><strong>Combinitorial Explosion</strong> You have lots of code that does almost the same thing.. but with tiny variations in data or behavior. This can be difficult to refactor-- perhaps using generics or an interpreter? - Jeff Atwood via <a href="http://blog.codinghorror.com/code-smells/" rel="nofollow">Coding Horror</a></p> </blockquote>  <p>In this case it is not lots of code, but it is still bugging me. I have a shared problem, that is when trying to connect to an IP, if it fails, I should retry with the next IP.</p>  <p>I have one function which generates a producer for NSQ:</p>  <pre><code>//Since we are in a critical system, we try with each IP until we get a producer var err error for i, success := 0, false; i &lt; len(ips) &amp;&amp; !success; i++ {     publisher, err = nsq.NewProducer(ips[i], nsq.NewConfig())     if err == nil {         success = true     } } </code></pre>  <p>The other function that almost shares the same code is one which takes a NSQ consumer and connects it:</p>  <pre><code>var err error for i, success := 0, false; i &lt; len(ips) &amp;&amp; !success; i++ {     err = consumer.ConnectToNSQD(ips[i])     if err == nil {         success = true     } } </code></pre>  <p>I would like to get rid of this almost repeated code without sacrificing legibility. Ideas?</p>