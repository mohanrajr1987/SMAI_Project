<p>I use the fantastic <a href="https://github.com/mikefourie/MSBuildExtensionPack" rel="nofollow">MSBuild Extension Pack</a> and define some msbuild files to replace text lines in different files.</p>  <p>I create a little example to explain the problem. Here is a file where I wanna replace some lines.</p>  <pre><code> "LINE 1", "with old comment"      "LINE 2", "with old comment"      "LINE 3", "with old comment"      "LINE 4", "with old comment"      "LINE 5", "with old comment" </code></pre>  <p>I used the File Task with the TaskAction Replace in the following project file.</p>  <pre><code>&lt;?xml version="1.0" encoding="utf-8"?&gt; &lt;Project ToolsVersion="12.0" DefaultTargets="Start" xmlns="http://schemas.microsoft.com/developer/msbuild/2003"&gt;   &lt;UsingTask TaskName="MSBuild.ExtensionPack.FileSystem.File" AssemblyFile="build/bin/MSBuild.ExtensionPack.dll" /&gt;     &lt;ItemGroup&gt;     &lt;Backup Include="backup/Text.txt"/&gt;     &lt;Input Include="Text.txt"/&gt;     &lt;/ItemGroup&gt;   &lt;Target Name="Start"&gt;     &lt;Copy SourceFiles="@(Backup)" DestinationFolder="./" /&gt;     &lt;MSBuild.ExtensionPack.FileSystem.File TextEncoding="ASCII" RegexOptionList="CultureInvariant|Multline" TaskAction="Replace" RegexPattern='["]LINE 1["].+' Replacement='"NEW LINE 1", "with new comment"' Files="@(Input)"/&gt;     &lt;MSBuild.ExtensionPack.FileSystem.File TextEncoding="ASCII" RegexOptionList="CultureInvariant|Multline" TaskAction="Replace" RegexPattern='["]LINE 2["].+' Replacement='"NEW LINE 2", "with new comment"' Files="@(Input)"/&gt;     &lt;MSBuild.ExtensionPack.FileSystem.File TextEncoding="ASCII" RegexOptionList="CultureInvariant|Multline" TaskAction="Replace" RegexPattern='["]LINE 3["].+' Replacement='"NEW LINE 3", "with new comment"' Files="@(Input)"/&gt;     &lt;MSBuild.ExtensionPack.FileSystem.File TextEncoding="ASCII" RegexOptionList="CultureInvariant|Multline" TaskAction="Replace" RegexPattern='["]LINE 4["].+' Replacement='"NEW LINE 4", "with new comment"' Files="@(Input)"/&gt;     &lt;MSBuild.ExtensionPack.FileSystem.File TextEncoding="ASCII" RegexOptionList="CultureInvariant|Multline" TaskAction="Replace" RegexPattern='["]LINE 5["].+' Replacement='"NEW LINE 5", "with new comment"' Files="@(Input)"/&gt;   &lt;/Target&gt; &lt;/Project&gt; </code></pre>  <p>The expected result is </p>  <pre><code> "NEW LINE 1", "with new comment  "NEW LINE 2", "with new comment" "NEW LINE 3", "with new comment" "NEW LINE 4", "with new comment" "NEW LINE 5", "with new comment" </code></pre>  <p>The text is replaced as expected for the matching parts. The problem is now that the result is looking different using different MSBuild revisions.</p>  <p>If I use 12.0.31101.0 all works fine and the replace is working as expected. But if I use the MSBuild version 12.0.40629.0 I get a different result.</p>  <pre><code> "NEW LINE 1", "with new comment "NEW LINE 2", "with new comment""NEW LINE 3", with new comment""NEW LINE 4", "with new comment""NEW LINE 5", "with new comment" </code></pre>  <p>The line endings haven change by the usage of rev 12.0.40629.0. The line endings are now '\n' and not \r\n. Another difference is the Environment. The revison 12.0.40629.0 is running under Windows 10 and the other revision is a Windows 8.1 machine.</p>  <p>Any suggestions?</p>