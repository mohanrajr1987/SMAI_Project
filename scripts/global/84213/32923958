<p>I am trying to add some code to my app that gets the average colour of images in a collection view. It works, but the images with the average colours load after the main images, and they are reloaded every time the image reappears on the view when scrolling.</p>  <p>Here is my code:</p>  <pre><code>func filter(originalimage: UIImage) -&gt; UIImage {     let context = CIContext(options: nil)      let convertImage = CIImage(image: originalimage)      let filter = CIFilter(name: "CIAreaAverage")     filter!.setValue(convertImage , forKey: kCIInputImageKey)      let processImage = filter!.outputImage      let finalImage = context.createCGImage(processImage!, fromRect: processImage!.extent)      let newImage = UIImage(CGImage: finalImage)      return newImage }  func collectionView(collectionView: UICollectionView, cellForItemAtIndexPath indexPath: NSIndexPath) -&gt; UICollectionViewCell {     let cell = collectionView.dequeueReusableCellWithReuseIdentifier("projectCell", forIndexPath: indexPath) as! ProjectCollectionViewCell      let project = DataManager.sharedInstance.projectAtLocation(indexPath.row)!      SDWebImageManager.sharedManager().downloadImageWithURL(NSURL(string: project.imageURL!), options: SDWebImageOptions.HighPriority, progress: nil) { (downloadedImage: UIImage!, error: NSError!, cacheType: SDImageCacheType, isDownloaded: Bool, withURL: NSURL!) -&gt; Void in          let priority = DISPATCH_QUEUE_PRIORITY_DEFAULT         dispatch_async(dispatch_get_global_queue(priority, 0)) {             let filteredImage = self.filter(downloadedImage)             dispatch_async(dispatch_get_main_queue()) {                 cell.backgroundColourImageView.image = filteredImage                 cell.imageView.image = downloadedImage             }         }     }      cell.imageView.sd_setImageWithURL(NSURL(string: project.imageURL!))     cell.nameLabel.text = project.name      cell.layer.cornerRadius = 10     cell.layer.masksToBounds = true      return cell } </code></pre>  <p>This isn't a problem if I remove the code to change threads, but I end up with a very laggy collection view.</p>  <p>Can anyone show me how I can get the filtered image and the normal image to be loaded at the same time, and how I can avoid them reloading each time I scroll?</p>