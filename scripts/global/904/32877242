<p>I would like to get some help with the following problem. I'm writing my bsc thesis, and this small part of code would be responsible for registering a user. (I'm new at nodejs actually). I'm using express and mongoose for this too.</p>  <p>I would like to process the request data, and check for some errors, first I would like to check if all fields exist, secondly if someone already registered with this e-mail address.</p>  <p>Based on the errors (or on success), I would like to send different responses. If a field is missing, then a 400 Bad request, if a user exists, then 409 Conflict, and 200 OK, if everything is ok. But I would only like to do the callback if there are no errors, but I'm kinda stuck here... I get the error Can't set headers after they are sent, which is obvious actually, because JS continues processing the code even if a response is set.</p>  <pre><code>app.post('/register', function (req, res) {     var user = new User(req.body);      checkErrors(req, res, user, registerUser); });  var registerUser = function(req, res, user){     user.save(function(err, user){         if (err) return console.log(err);     });     res.sendStatus(200); };  var checkErrors = function(req, res, user, callback){     var properties = [ 'firstName', 'lastName', 'email', 'password', 'dateOfBirth' ];      for(var i = 0; i &lt; properties.length; i++){         if(!req.body.hasOwnProperty(properties[i])){             res.status(400).send('field ' + properties[i] + ' not found');         }     }      var criteria = {         email: req.body.email     };     User.find(criteria).exec(function(err, user){         if(user.length &gt; 0){             res.status(409).send('user already exists');         }     });     callback(req, res, user); }; </code></pre>