<p>Below is a simplified version of my xsd and xml. I am trying to check that each OrderedPart@rPartId has a valid match in Part@PartId.</p>  <p>All tools I have tried tell me this XML is valid against this xsd. But second Order  should give error as 67 is not a valid Part@PartId.</p>  <p>XSD</p>  <pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;  &lt;xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:tns="http://localhost" xmlns="http://localhost" targetNamespace="http://localhost" elementFormDefault="qualified" attributeFormDefault="unqualified" &gt;      &lt;xs:element name="root"&gt;     &lt;xs:complexType&gt;         &lt;xs:sequence&gt;             &lt;xs:element name="Order" type="OrderType" maxOccurs="unbounded"/&gt;             &lt;xs:element name="Parts" type="PartType"/&gt;         &lt;/xs:sequence&gt;     &lt;/xs:complexType&gt;      &lt;xs:keyref name="dummy" refer="pNumKey"&gt;         &lt;xs:selector xpath="tns:OrderedPart" /&gt;         &lt;xs:field xpath="@rPartId"/&gt;     &lt;/xs:keyref&gt;      &lt;xs:key name="pNumKey"&gt;         &lt;xs:selector xpath="tns:Part"/&gt;         &lt;xs:field xpath="@PartId"/&gt;     &lt;/xs:key&gt; &lt;/xs:element&gt;  &lt;xs:complexType name="OrderType"&gt;     &lt;xs:sequence&gt;       &lt;xs:element name="OrderedPart" maxOccurs="unbounded"&gt;           &lt;xs:complexType&gt;               &lt;xs:attribute name="rPartId" type="xs:integer"/&gt;           &lt;/xs:complexType&gt;       &lt;/xs:element&gt;   &lt;/xs:sequence&gt; &lt;/xs:complexType&gt;  &lt;xs:complexType name="PartType"&gt;     &lt;xs:sequence&gt;       &lt;xs:element name="Part" maxOccurs="unbounded"&gt;           &lt;xs:complexType&gt;               &lt;xs:attribute name="PartId" type="xs:integer"/&gt;           &lt;/xs:complexType&gt;       &lt;/xs:element&gt;   &lt;/xs:sequence&gt; &lt;/xs:complexType&gt; &lt;/xs:schema&gt; </code></pre>  <p>and XML:</p>  <pre><code>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;  &lt;root xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  xsi:noNamespaceSchemaLocation="KeyRefs.xsd"  xmlns="http://localhost" &gt; &lt;Order&gt;     &lt;OrderedPart rPartId="1"/&gt; &lt;/Order&gt; &lt;Order&gt;     &lt;OrderedPart rPartId="67"/&gt; &lt;!-- validation should give error --&gt; &lt;/Order&gt; &lt;Parts&gt;     &lt;Part PartId="1"/&gt; &lt;/Parts&gt; &lt;/root&gt; </code></pre>  <p>Suspect its something to do with the xPaths and/or namespaces in selectors. Following input from other posts on this site I have played with the namespace combinations but cannot get this to work.</p>  <p>Any advice welcome.</p>  <p>(updates as OP seem to lose some of the XSD)</p>