<p>I have installed Mesosphere DCOS in AWS using the provided template. Now I would like to restart all the nodes but adding the --insecure-registry parameter to all the slave nodes (and master as well) so that they communicate with my docker registry. So I was reading the best way to do this is on the cloud-config script for the AWS template. </p>  <p>So in the AWS EC2 Launch Configurations I copied the configuration of the master node, then adjusted the User Data then updated the auto scaling groups and restarted the master. (awesome answer how to do this at the end of <a href="http://stackoverflow.com/questions/29796273/how-do-i-use-insecure-docker-registries-with-amazon-ec2-container-service-ecs/29914584#29914584">How do I use insecure docker registries with Amazon EC2 Container Service (ECS)?</a>) </p>  <p>The lines were added to the end of the units section in cloud-config as suggested by CoreOS docs: <a href="https://coreos.com/os/docs/latest/cloud-config.html" rel="nofollow">https://coreos.com/os/docs/latest/cloud-config.html</a></p>  <pre><code> units  ....Many lines here - name: docker.service  drop-ins: |-  - name: 50-insecure-registry.conf    content: |     [Service]     Environment=DOCKER_OPTS='--insecure-registry="10.0.1.0/24"' </code></pre>  <p>But then, the master wouldn't restart. So I had to revert my change.</p>  <p>So many questions:</p>  <p>a. Why is there no docker.service block in this template cloud-config? How and when docker starts?</p>  <p>b. Do I need to edit the flannel_docker_opts.env file? Again there is no mention to such file in this cloud-config. But there is  mention in this page: <a href="https://coreos.com/flannel/docs/latest/flannel-config.html" rel="nofollow">https://coreos.com/flannel/docs/latest/flannel-config.html</a></p>  <p>Of particular interest at the end of that page:</p>  <ol start="5"> <li>ExecStartPost in flanneld.service converts information in /run/flannel/subnet.env into Docker daemon command line args (such as --bip and --mtu), storing them in /run/flannel_docker_opts.env ...</li> <li>docker.service sources in /run/flannel_docker_opts.env which contains env variables with command line options and starts the Docker with them.</li> </ol>  <p>And in fact I can see the mentioned files like early-docker.service, but again no mention of flannel in the cloud-config. </p>  <p>But indeed I found the service files mentioned in the page above:</p>  <pre><code> /usr/lib64/udev/rules.d/80-docker.rules  /usr/lib64/systemd/system/early-docker.service  /usr/lib64/systemd/system/early-docker.socket  /usr/lib64/systemd/system/docker.service  /usr/lib64/systemd/system/docker.socket  /usr/lib64/systemd/system/sockets.target.wants/docker.socket  /usr/lib64/systemd/system/early-docker.target </code></pre>  <p>And indeed the /run/flannel_docker_opts.env file is mentioned in the docker.service file, but does not exist in the /run folder:</p>  <p>vi /usr/lib64/systemd/system/docker.service</p>  <pre><code> [Unit]  Description=Docker Application Container Engine  Documentation=http://docs.docker.com  After=docker.socket early-docker.target network.target  Requires=docker.socket early-docker.target   [Service]  Environment=TMPDIR=/var/tmp  EnvironmentFile=-/run/flannel_docker_opts.env &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; HERE!!!!!  MountFlags=slave  LimitNOFILE=1048576  LimitNPROC=1048576  ExecStart=/usr/lib/coreos/dockerd --daemon --host=fd:// $DOCKER_OPTS $DOCKER_OPT_BIP $DOCKER_OPT_MTU $DOCKER_OPT_IPMASQ   [Install] </code></pre>  <p>c. Where does this docker.service file comes from! There is no mention to it in the cloud-config. Is it part of the CoreOS architecture?</p>  <p>d. If this docker.service is integral part of CoreOS, why are all the files in this /usr/lib64 path? CoreOS docs mentions other path locations for all the files.</p>  <p>Any suggestion would be appreciated. I'm going blind now. I will try and create to this non existent flannel_docker_conf.env file. But I'm not sure if what I'm doing is the correct way.</p>  <p>Thanks!</p>