<p>(Edit: this code actually works, the error was in my original code, which had an incorrect email address!)</p>  <p>I've figured out how to log into Devise from the console, however when I attempt to do the same from a rake task it gives me 401 unauthorised when posting to sign in. This is my rake task. (These same steps work in the console).</p>  <pre><code>task :get_home =&gt; :environment do   app = ActionDispatch::Integration::Session.new Rails.application   app.get '/users/sign_in'   p csrf_token = app.session[:_csrf_token]    app.post '/users/sign_in',{:authenticity_token =&gt; csrf_token, :user =&gt; {:email =&gt; "example@example.com", :password =&gt; "password"}}   app.get ''    p csrf_token = app.session[:_csrf_token]   app.get '/users'    File.open("users", "w+") do |f|     f.write(app.response.body)   end end </code></pre>