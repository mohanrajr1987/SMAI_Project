<p>To test controller, I was using following code to authenticate user created by using seed data. All test cases were failing with 401 </p>  <pre><code>def login_user   before(:each) do     user = User.find_by_email('iberp@gmail.com')     @request.env["devise.mapping"] = Devise.mappings[:user]     sign_in  user # Using factory girl as an example   end end </code></pre>  <p>the issue is resolved after making user as instance variable (@user). why user needs to be instance variable ? sign response is n't sufficient to set cookies?</p>