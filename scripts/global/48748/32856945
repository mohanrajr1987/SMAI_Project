<p>I recently added the ability to sign in to my application using facebook on a page where a user is filling out a form. I followed this helpful post in order to implement it <a href="http://stackoverflow.com/questions/4081744/devise-form-within-a-different-controller">devise form within another controller</a>  I put the button on the first page in my checkout process (its an ecommerce app) so that my buyers can conveniently sign up/sign in and I recently discovered something unfortunate. If a user doesn't sign in the save and continue button is disabled, which is necessary for a user to complete their purchase without signing in.</p>  <p>edit.html.erb</p>  <pre><code>&lt;div class="&lt;%= if @order.state != 'confirm' then 'col-md-9' else 'col-md-12' end %&gt;" data-hook="checkout_form_wrapper"&gt;   &lt;%= form_for @order, :url =&gt; update_checkout_path(@order.state), :html =&gt; { :id =&gt; "checkout_form_#{@order.state}" } do |form| %&gt;     &lt;% unless @order.email? %&gt;       &lt;div class="panel panel-default"&gt;         &lt;div class="panel-body"&gt;           &lt;p class="field" style='clear: both'&gt;             &lt;%= form.label :email %&gt;&lt;span class="required"&gt;&lt;br /&gt;             &lt;%= form.text_field :email %&gt;           &lt;/p&gt;           # render the devise login form here           &lt;%= render 'devise/sessions/fb_form.html.erb' %&gt;         &lt;/div&gt;       &lt;/div&gt;     &lt;% end %&gt;     # render the address form here     &lt;%= render @order.state, :form =&gt; form %&gt;   &lt;% end %&gt; &lt;/div&gt; </code></pre>  <p>_fb_form.html.erb:</p>  <pre><code>&lt;%= form_for(resource, as: resource_name, url: session_path(resource_name), :html =&gt; {:class =&gt; 'well'}) do |f| %&gt;   &lt;%= devise_error_messages! %&gt;   &lt;%= bootstrap_flash %&gt;   &lt;div class="facebook-login"&gt;     &lt;%= link_to omniauth_authorize_path(resource, :facebook) do %&gt;       &lt;i class="fa fa-facebook"&gt;&lt;/i&gt; Sign in with Facebook     &lt;% end %&gt;   &lt;/div&gt;   &lt;div class="text-center"&gt;     &lt;p&gt;&lt;small&gt;By submitting, I acknowledge that I have read, understand and agree to be bound by the leemaeats.com website &lt;a href="/terms-of-use"&gt;Terms of Use&lt;/a&gt; and &lt;a href="/privacy-policy"&gt;Privacy Policy&lt;/a&gt;.&lt;/small&gt;&lt;/p&gt;   &lt;/div&gt; &lt;% end %&gt; </code></pre>  <p>_address.html.erb</p>  <pre><code>&lt;div class="row"&gt;   &lt;div class="col-xs-12"&gt;     &lt;div class="well text-right form-buttons" data-hook="buttons"&gt;       # this gets disabled when the fb_form page is rendered       &lt;%= submit_tag Spree.t(:save_and_continue), :class =&gt; 'btn btn-lg btn-success' %&gt;       &lt;% if try_spree_current_user %&gt;         &lt;div class="checkbox" data-hook="save_user_address"&gt;           &lt;%= check_box_tag 'save_user_address', '1', try_spree_current_user.respond_to?(:persist_order_address) %&gt;           &lt;%= label_tag :save_user_address, Spree.t(:save_my_address) %&gt;         &lt;/div&gt;       &lt;% end %&gt;     &lt;/div&gt;   &lt;/div&gt; &lt;/div&gt; </code></pre>  <p>Aftter much debugging and trial/error I found that sole cause of the problem is when <code>fb_form.html.erb</code> is rendered. Has anyone implemented devise login like this and come across this problem? Am I violating some rails scoping rules here?</p>  <p>I didn't include all of the code in these files, but if anyone thinks that's relevant I can paste more of that here.</p>  <p>Thanks,</p>  <ul> <li>Brandon</li> </ul>