<p>I have two files (File1):</p>  <pre><code>&lt;institution&gt; &lt;ukprn&gt;1234&lt;/ukprn&gt; &lt;course&gt;     &lt;courseID&gt;1&lt;/courseID&gt;     &lt;courseaim&gt;X99&lt;/courseaim&gt; &lt;/course&gt; &lt;student&gt;     &lt;birthdate&gt;30/10/1985&lt;/birthdate&gt;     &lt;instance&gt;         &lt;OWNINST&gt;123456|5&lt;/OWNINST&gt;         &lt;FC&gt;1&lt;/FC&gt;         &lt;STULOAD&gt;100&lt;/STULOAD&gt;         &lt;elq&gt;4&lt;/elq&gt;         &lt;MODE&gt;31&lt;/MODE&gt;     &lt;/instance&gt; &lt;/student&gt; &lt;student&gt;     &lt;birthdate&gt;01/02/1999&lt;/birthdate&gt;     &lt;instance&gt;         &lt;OWNINST&gt;654321|1&lt;/OWNINST&gt;         &lt;FC&gt;2&lt;/FC&gt;         &lt;elq&gt;2&lt;/elq&gt;     &lt;/instance&gt;     &lt;instance&gt;         &lt;OWNINST&gt;654321|2&lt;/OWNINST&gt;         &lt;FC&gt;6&lt;/FC&gt;         &lt;elq&gt;1&lt;/elq&gt;     &lt;/instance&gt; &lt;/student&gt; &lt;/institution&gt; </code></pre>  <p>And (File2):</p>  <pre><code>&lt;studentstoamend&gt;     &lt;STUDENT&gt;&lt;OWNINST&gt;123456|5&lt;/OWNINST&gt;&lt;MODE&gt;01&lt;/MODE&gt;&lt;/STUDENT&gt;     &lt;STUDENT&gt;&lt;OWNINST&gt;111112|1&lt;/OWNINST&gt;&lt;MODE&gt;31&lt;/MODE&gt;&lt;/STUDENT&gt; &lt;/studentstoamend&gt; </code></pre>  <p>For OWNINSTs in File2 I need to update the mode in File1.  Where there is no mode in File1 then I need to add one in after the ELQ node.</p>  <p>I am convinced that this is not difficult in XML stylesheets but can't seem to do it.</p>