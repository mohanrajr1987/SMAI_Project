<p>So I need to add 4 attributes to the root element (&lt;weather&gt;) of an XML output I am creating using XSLT. The 4 elements are the details of the weather station the data is obtained from. Which is contained within the stations.xml file and has a structure as follows:</p>  <pre><code>&lt;stations&gt;    &lt;station&gt;        &lt;site&gt;81123&lt;/site&gt;        &lt;name&gt;Bendigo Airport&lt;/name&gt;        &lt;latitude&gt;36.74&lt;/latitude&gt;        &lt;longitude&gt;144.33&lt;/longitude&gt;        &lt;state&gt;Vic&lt;/state&gt;    &lt;/station&gt;    &lt;station&gt;        &lt;site&gt;81124&lt;/site&gt;        &lt;name&gt;Yarrawonga&lt;/name&gt;        &lt;latitude&gt;36.03&lt;/latitude&gt;        &lt;longitude&gt;146.03&lt;/longitude&gt;        &lt;state&gt;Vic&lt;/state&gt;    &lt;/station&gt; &lt;/stations&gt; </code></pre>  <p>An XPath tester tells me that the following would be the correct predicate to obtain the required station node.</p>  <pre><code>./stations/station[site=81123] </code></pre>  <p>I've tried to do it by matching but I think I've lost my way here. If anyone can offer some assistance that would be great. The code I have so far is below:</p>  <pre><code>&lt;xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" version="1.0"&gt; &lt;xsl:output method="xml" indent="yes"/&gt;  &lt;!-- select the &lt;measurement&gt; elements of all the various input files --&gt; &lt;xsl:variable name="maxTemp" select="document('Max_temp.xml')/*" /&gt; &lt;xsl:variable name="rainfall" select="document('Rainfall.xml')/*" /&gt; &lt;xsl:variable name="solar" select="document('Solar.xml')/*" /&gt; &lt;xsl:variable name="minTemp" select="document('Min_temp.xml')/*" /&gt; &lt;xsl:variable name="stations" select="document('station.xml')/*" /&gt;  &lt;!-- index &lt;measurement&gt; elements by their station and date --&gt; &lt;xsl:key name="kMeasurement" match="measurement"     use="concat(Day, '/', Month, '/', Year)" /&gt;  &lt;xsl:template match="/"&gt;     &lt;weather&gt;         &lt;xsl:apply-templates select="weather" /&gt;         &lt;xsl:apply-templates select="$maxTemp/measurement" /&gt;     &lt;/weather&gt; &lt;/xsl:template&gt;  &lt;xsl:template match="weather"&gt;     &lt;xsl:attribute name="stationID"&gt;&lt;xsl:value-of select="$stations/station[site=81123]/site" /&gt;&lt;/xsl:attribute&gt;     &lt;xsl:attribute name="stationName"&gt;&lt;xsl:value-of select="$stations/station[site=81123]/name" /&gt;&lt;/xsl:attribute&gt;     &lt;xsl:attribute name="latitude"&gt;&lt;xsl:value-of select="$stations/station[site=81123]/latitude" /&gt;&lt;/xsl:attribute&gt;     &lt;xsl:attribute name="longitude"&gt;&lt;xsl:value-of select="$stations/station[site=81123]/longitude" /&gt;&lt;/xsl:attribute&gt; &lt;/xsl:template&gt;  &lt;xsl:template match="measurement"&gt;     &lt;xsl:variable name="currentKey" select="concat(Day, '/', Month, '/', Year)" /&gt;      &lt;measurement&gt;         &lt;Date&gt;&lt;xsl:value-of select="concat(Day, '/', Month, '/', Year)" /&gt;&lt;/Date&gt;          &lt;!-- since we are handling maxTemp measurements here, we can output that directly --&gt;         &lt;MaxTemp&gt;&lt;xsl:value-of select="MaxTemp"/&gt;&lt;/MaxTemp&gt;          &lt;!-- to access the others we need a context switch and a key lookup --&gt;         &lt;xsl:for-each select="$rainfall"&gt;             &lt;Rainfall&gt;&lt;xsl:value-of select="key('kMeasurement', $currentKey)/Volume" /&gt;&lt;/Rainfall&gt;         &lt;/xsl:for-each&gt;         &lt;xsl:for-each select="$solar"&gt;             &lt;Solar&gt;&lt;xsl:value-of select="key('kMeasurement', $currentKey)/dailySolarExposure" /&gt;&lt;/Solar&gt;         &lt;/xsl:for-each&gt;         &lt;xsl:for-each select="$minTemp"&gt;             &lt;MinTemp&gt;&lt;xsl:value-of select="key('kMeasurement', $currentKey)/minTemp" /&gt;&lt;/MinTemp&gt;         &lt;/xsl:for-each&gt;     &lt;/measurement&gt; &lt;/xsl:template&gt; </code></pre>  <p></p>