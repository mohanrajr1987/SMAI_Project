<p>I am working on hosting a mirror of a site using a standard LAMP stack. When trying to return a generated image the Content-type header is not getting set correctly to image/png and is instead returning as Content-Type:text/html; charset=UTF-8. This is causing the browser to just show a steam of garbage rather than an image. I have the function that is attempting to set the headers and have added some of my own debugging to the code, but don't know where to go from here.</p>  <pre><code>    // Generate image header     function Headers() {         error_log("in Headers function",0);         // In case we are running from the command line with the client version of         // PHP we can't send any headers.         $sapi = php_sapi_name();         error_log("sapi = $sapi",0);         if( $sapi == 'cli' ) return;          // These parameters are set by headers_sent() but they might cause         // an undefined variable error unless they are initilized         $file='';         $lineno='';         if( headers_sent($file,$lineno) ) {             error_log("headers already sent",0);             $file=basename($file);             $t = new ErrMsgText();             $msg = $t-&gt;Get(10,$file,$lineno);             die($msg);         }          if ($this-&gt;expired) {             error_log("expired",0);             header("Expires: Mon, 26 Jul 1997 05:00:00 GMT");             header("Last-Modified: " . gmdate("D, d M Y H:i:s") . "GMT");             header("Cache-Control: no-cache, must-revalidate");             header("Pragma: no-cache");         }         header("Content-type: image/$this-&gt;img_format");         header("Custom-header: gnm image/$this-&gt;img_format");         error_log("end of  Headers function, img_format = $this-&gt;img_format",0);     } </code></pre>  <p>With the above code I get the error log showing that I have entered the function, the sapi is apache2handler, expired is true, the image format is png, and that I am at the end of the function. I also get all headers in the expired block set correctly and the added "Custom-header" gets set as expected. The only header that isn't set as expected is the Content-type.</p>  <p>This function is being called from a php file that is generating and then streaming an image. Any and all help tracking this down is appreciated.</p>