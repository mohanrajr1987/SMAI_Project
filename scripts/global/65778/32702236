<p>I have a 'Bogus' table with some news stories stored under 'Title' and their respective dates stored under 'Date'. </p>  <p>Every x minutes, I fetch a new title. I want to compare it to every item that has been stored in the DB during the last 3 hours (using similar_text() function). </p>  <p>If the new item is similar to the item already in the DB, then combine the new title with the one already in the DB and update the existing item. If not, then insert new title in DB as new item.</p>  <p>The problem with my code is that it updates all items instead of only the similar ones and even if the new item is not similar to any of the old ones, it fails to be added into the DB. </p>  <p>Here's the table structure:</p>  <pre><code>ID Titlu                                     Data                  1  Cum să decojești simultan mai multe       2015-09-21 20:17:09 2  David Cameron, rataciri cu marijuana,     2015-09-21 20:17:09 3  Dalai Lama vrea sa vina in Europa         2015-09-21 20:17:09 4  Judecătorul lui Oprescu cere DNA          2015-09-21 20:17:09 </code></pre>  <p>And my code:</p>  <pre><code>$nou = 'Dalai Lama vrea sa vina in Europa'; $delim = '///';  $last3hours = "SELECT * FROM Bogus WHERE Data &gt;= now() - INTERVAL 3 HOUR ORDER BY Data DESC"; $result3hours = mysqli_query($mysqli, $last3hours) or Die (mysqli_error());  if ($result3hours)  {     while($row = mysqli_fetch_assoc($result3hours))     {         similar_text($nou, $row['Titlu'], $percent);         if ($percent &gt;= 40)         {             $titlu_update = $row['Titlu'] . $delim . $nou;             //Update             $update_item = "UPDATE Bogus SET Titlu = '$titlu_update'";             if (!mysqli_query($mysqli, $update_item))              {                 die('Eroare (update_item): ' . mysqli_error($mysqli));             }             $already_in_db = true;         }     }     if (!$already_in_db)     {         $insert_new_item = "INSERT INTO Bogus (Titlu) VALUES ('$nou')";         if (!mysqli_query($mysqli, $insert_new_item))          {             die('Eroare (Single_Item_Update): ' . mysqli_error($mysqli));         }        } } // Free result set mysqli_free_result($result3hours);  //Close connection mysqli_close($mysqli); </code></pre>  <p>The desired result should be:</p>  <pre><code>ID Titlu                                       1  Cum să decojești simultan mai multe       2  David Cameron, rataciri cu marijuana,    3  Dalai Lama vrea sa vina in Europa///Dalai Lama vrea sa vina in Europa                                    4  Judecătorul lui Oprescu cere DNA        </code></pre>  <p>Instead, I get:</p>  <pre><code>ID Titlu                                      1  Dalai Lama vrea sa vina in Europa///Dalai Lama vrea sa vina in Europa 2  Dalai Lama vrea sa vina in Europa///Dalai Lama vrea sa vina in Europa 3  Dalai Lama vrea sa vina in Europa///Dalai Lama vrea sa vina in Europa 4  Dalai Lama vrea sa vina in Europa///Dalai Lama vrea sa vina in Europa </code></pre>  <p>What am I doing wrong?!</p>