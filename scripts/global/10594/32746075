<p>I want to match an array against a text string where words matching with the array keys will be replaced by a span tag with a title with the matching array value.</p>  <p>I can do that with str_ireplace but then the matched words lose their case:</p>  <pre><code>$glossary = array(     'word1' =&gt; '&lt;span title="Explanation for Word 1"&gt;word1&lt;/span&gt;',     'word2' =&gt; '&lt;span title="Explanation for Word 2"&gt;word2&lt;/span&gt;',     'word3' =&gt; '&lt;span title="Explanation for Word 3"&gt;word3&lt;/span&gt;' );  $text = "This is a text about Word1. We also talk about word2 and WORD3. Also woRd3, word2 and WORD1";  list($keys, $values) = array_divide($glossary);  $result = str_ireplace($keys, $values, $text); </code></pre>  <p>As said, this works but in this solution all matching words will be in lowercase.</p>  <p><strong>What I want to achieve is this:</strong></p>  <pre><code>'This is a text about &lt;span title="Explanation for Word 1"&gt;Word1&lt;/span&gt;.  We also talk about &lt;span title="Explanation for Word 2"&gt;word2&lt;/span&gt; and &lt;span title="Explanation for Word 3"&gt;WORD3&lt;/span&gt;. Also &lt;span title="Explanation for Word 3"&gt;woRd3&lt;/span&gt;,  &lt;span title="Explanation for Word 2"&gt;word2&lt;/span&gt; and &lt;span title="Explanation for Word 1"&gt;WORD1&lt;/span&gt;' </code></pre>  <p>Do the replacements and <strong>keep the case intact</strong>.</p>  <p>I found a great reply that came close but it only works with the addition of the span tag around the matched words, it does not add a second variable for the title (<a href="http://stackoverflow.com/questions/16740116/php-str-ireplace-without-losing-case">php str_ireplace without losing case</a>).</p>  <p>I don't know enough regex (It dazzles me) to change it by adding a second variable for the span titles:</p>  <pre><code>$txt = 'Hi! How are you doing? Have some stars: * * *!'; $array_of_words = array('Hi!', 'stars', '*');  $pattern = '#(?&lt;=^|\W)('         . implode('|', array_map('preg_quote', $array_of_words))        . ')(?=$|\W)#i';  echo preg_replace($pattern,        "&lt;span style='background-color:#EEEE00'&gt;$1&lt;/span&gt;", $txt); </code></pre>