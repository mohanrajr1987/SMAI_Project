<p>I have a question about preg_replace. I have the following HTML in WordPress:</p>  <pre><code>&lt;img width="256" height="256" src="http://localhost/wp-content/uploads/2015/08/spiderman-avatar.png" class="attachment-post-thumbnail wp-post-image" alt="spiderman-avatar"&gt; </code></pre>  <p>I change it to the following:</p>  <pre><code>&lt;img src="" data-breakpoint="http://localhost/wp-content/uploads/2015/08/" data-img="theme-{folder}.jpg" class="srcbox" alt="spiderman-avatar"&gt; </code></pre>  <p>with the following preg_replace:</p>  <pre><code>$html = preg_replace(     '/src="(https?:\/\/.+\/)(.+\-)([0-9]+)(.jpg|.jpeg|.png|.gif)"/',     'src="" data-breakpoint="$1" data-img="$2{folder}$4"', // Replace and split src attribute into two new attributes     preg_replace(         '/(width|height)="[0-9]*"/',         '', // Remove width and height attributes         preg_replace(             '/&lt;img ?([^&gt;]*)class="([^"]*)"?/',             '&lt;img $1 class="$2 srcbox"', // Add class srcbox to class attribute             $html         )     ) ); </code></pre>  <p>I have the feeling I have written some serious slow code, and it can be done in a single preg_replace.</p>  <p>Chris85 mentioned the HTML parser, so I found this and got this so far:</p>  <p><a href="http://nimishprabhu.com/top-10-best-usage-examples-php-simple-html-dom-parser.html" rel="nofollow">http://nimishprabhu.com/top-10-best-usage-examples-php-simple-html-dom-parser.html</a></p>  <pre><code>include('simple_html_dom.php');  $html = file_get_html($html); </code></pre>  <p>From here I COULD loop through all images and change the <code>th</code> attribute. But how do I put the new element were it came from?</p>