<p>I am stuck with a weird problem. I've never seen anything like that before and I can't find any similar cases to my problem. I am on Windows 7, PHP 5.5.x and Apache.</p>  <p>My framework is serving javascript by itself (e.g. with <code>readfile(...)</code>) . This approach allows me to translate and serve javascript files on the fly (duh!). For instance, if JS code contains smth like <code>var msg="&lt;translate&gt;This string&lt;/translate&gt;";</code> then, when it's being served by the framework, <code>&lt;translate&gt;</code> tags are translated with </p>  <pre><code>preg_replace_callback('/&lt;translate&gt;(.*?)&lt;\/translate&gt;/i', $callback, $content); </code></pre>  <p>Where <code>$callback</code> is the function that translates <code>$content</code>. </p>  <p>The <code>$callback</code> can be boiled down to this simple code (which still will cause JS to render improperly):</p>  <pre><code>$callback = function($matches) {     return $matches[1]; }; </code></pre>  <p>All in all it works well on Linux, but when I try running that on Windows, my Firefox refuses to interpret translated JS code!</p>  <p>Has anyone had any similar problems?</p>  <p>I've also tried <code>preg_replace</code>, <code>preg_replace_callback</code> and even <code>str_replace</code> just for fun. Any string replacement in JS code leads to errors on client side. Explicitly setting <code>charset=utf-8</code> in <code>Content-Type</code> header doesnt help either. </p>