<p>While trying to work out an integration between <a href="https://www.fogcreek.com/kiln/" rel="nofollow">Kiln</a> and <a href="https://www.atlassian.com/software/bamboo" rel="nofollow">Bamboo</a> I ran into an issue that Fog Creek support indicated might be a problem of having too many topological heads in my repository. We typically have a pattern of closing a branch prior to merging back into a main branch but that clearly gets forgotten from time to time.</p>  <pre><code>$ hg head -t | grep ^changeset: | wc -l 1361 </code></pre>  <p>My understanding is that those heads need to be communicated one way or the other when pulling from the hosting Mercurial server to know which heads need to by sync'd. That's a lot of wasted effort given that over 1100 of those heads are completely dead to us -- so I'd like to get rid of those heads!</p>  <p>It's fairly straightforward to identify the heads I want to eliminate:</p>  <pre><code>$ hg log -r "heads(all()) - ( head() and not closed() )" --template "{node}\n" | wc -l 1199 </code></pre>  <p>I initially thought it would be fairly straightforward to clean this up:</p>  <ol> <li>Create a new dummy branch</li> <li>Iteratively merge all of the closed topological heads into the dummy branch (keep local)</li> </ol>  <p>Unfortunately, I ran into a couple of issues:</p>  <ul> <li>If I started the dummy branch from my current default head, merges took a really long time ( I estimate it will take weeks to do all 1100+ merges )</li> <li>If I start from changeset 0, I get quickly run into an ambiguous merge issue that I don't know how to resolve ("ambiguous merge - picked m action"?)</li> </ul>  <p>Any ideas or suggestions on how I should proceed? Is my iterative merge idea sane? Are one of the two ideas for where to start from more reasonable than the other? </p>  <p>Any help is greatly appreciated!</p>