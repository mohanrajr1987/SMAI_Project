<p>I have the following table t1:</p>  <pre><code>key  value  1   38.76  1   41.19  1   42.22  2   29.35182  2   28.32192  3   33.66  3   33.47  3   33.35  3   33.47  3   33.11  3   32.98  3   32.5 </code></pre>  <p>I want to compute the median for each key group. According to the <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+UDF" rel="nofollow">documentation</a>, the percentile_approx function should work for this. The median values for each group are:</p>  <pre><code>1  41.19 2  28.83 3  33.35 </code></pre>  <p>However, the percentile_approx function returns these:</p>  <pre><code>1  39.974999999999994 2  28.32192 3  33.23.0000000000004 </code></pre>  <p>Which clearly are not the median values. </p>  <p>This was the query I ran:</p>  <pre><code>select key, percentile_approx(value, 0.5, 10000) as median from t1 group by key </code></pre>  <p>It seems to be not taking into account one value per group, resulting in a wrong median. Ordering does not affect the result. Any ideas?</p>