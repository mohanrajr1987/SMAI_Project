<p>Question: Why won't a var <code>things</code> return a value from outside the <code>walk()</code> function? And how do I fix it?</p>  <p>Hypothosis:  this is async and the console.log is happening too early.  Which would lead me to how can I make this a <code>Promise</code> (i'm using node 4.1.1)</p>  <pre><code>var walk = function(dir, done) {   var results = [];   fs.readdir(dir, function(err, list) {     if (err) return done(err);     var i = 0;     (function next() {       var file = list[i++];       if (!file) return done(null, results);       file = dir + '/' + file;       fs.stat(file, function(err, stat) {         if (stat &amp;&amp; stat.isDirectory()) {           walk(file, function(err, res) {             results = results.concat(res);             next();           });         } else {           results.push(file);           next();         }       });     })();   }); };  function traverseDirectories() {     var things = walk('src/', function(err, results){         if(err) throw err;         console.log(results) // ['dir/thing.png', 'dir/thing2.png']         return results;     });     console.log(things) // undefined }; traverseDirectories(); </code></pre>