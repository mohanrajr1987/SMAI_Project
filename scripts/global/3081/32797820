<p>I have this in my spec_helper:</p>  <pre><code>config.use_transactional_fixtures = false  config.before(:suite) do   DatabaseCleaner.clean_with(:truncation) end  config.before(:each) do   DatabaseCleaner.strategy = :truncation   FactoryGirl.reload end  config.before(:each) do   DatabaseCleaner.start end  config.after(:each) do   Capybara.reset_sessions!   DatabaseCleaner.clean end </code></pre>  <p>So basically no transactions should be used.</p>  <p>I have this callback in my Absence after_save:</p>  <pre><code>ActiveRecord::Base.connection.execute( %Q[insert into time_checks (user_id, date, minimal_hours) select users.id, calendar.date, 0 from calendar inner join users on users.id in (#{user_ids}) where not exists (select * from time_checks where time_checks.user_id = users.id and time_checks.date = calendar.date) and calendar.date between '#{from}' and '#{to}']) </code></pre>  <p>It's definitely hitting that code while doing the test.  When I try the SQL it inserts something in time_checks as well.</p>  <p>However when I do:</p>  <pre><code>@absence = create(:absence, user: @user, from: "2015-09-10", to: "2015-09-10", hours: 3, category: 0) Absence.count.should eq(1) TimeCheck.count.should eq(1) </code></pre>  <p>The last line is saying there are no records in time_checks.  Why would this be?</p>