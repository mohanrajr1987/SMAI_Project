<p>I'm trying to test to make sure the notification mailer is not sending after an invalid record but I keep getting below error before test can complete</p>  <blockquote>   <p>"ActiveRecord::RecordInvalid:</p> </blockquote>  <pre><code>      it 'does not call send_email_notification' do         expect(NotificationMailer).not_to receive(:user_notification)         FactoryGirl.create(:invalid_user, shop: shop)       end </code></pre>  <p>How can I test this properly?</p>  <p>EDIT: here's the code where the mail gets sent:</p>  <pre><code>after_create :send_email_notification     private     def send_email_notification     if self.shop.email_notifications         NotificationMailer.user_notification(self).deliver_now     end   end end </code></pre>