<p>I am creating an abstraction layer for Dart WebSocket who is also protocol compatible with Socket.IO, but it has a problem I can not solve.</p>  <p>The follow code convert the HttpRequest into a WebSocket and save the socket instance on the Transport... Here you can see I change the value of the <code>writable</code> flag to true in order to inform the socket is open.</p>  <pre><code>WebSocketTransformer.upgrade(req).then((socket) {   this._socket = socket;   this.writable = true;    this._socket.handleError(() {     this.onClose();   });    // start listen the socket;   socket.listen((packet) {     this.onData(packet);   }); }).catchError((Exception e) {   this.onError('Can\'t conenct with the socket.', e.toString()); }); </code></pre>  <p>(The full code can be founded <a href="https://github.com/Designture/Connexa/blob/master/lib/src/transports/WebSocket.dart" rel="nofollow">here</a>.)</p>  <p>When I debug the code first the debugger stops inside that closure and only then stops here, where the check is make but <code>writable</code> still false :/</p>  <pre><code>void flush([_]) {   if (this._readyState != SocketStates.closed &amp;&amp; this.transport.writable &amp;&amp;       !this._writeBuffer.isEmpty) { </code></pre>  <p>(The full code can be founded <a href="https://github.com/Designture/Connexa/blob/master/lib/src/Socket.dart" rel="nofollow">here</a>) I really need help...</p>