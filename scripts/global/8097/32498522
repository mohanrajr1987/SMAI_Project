<p>I am having problems grouping by the month of a date when using a function. It was working before but the query was less complicated as I am now using a function that uses a rolling year from the current month. Here is my code.</p>  <pre><code>SELECT     CASE  WHEN DATEDIFF(mm,dbo.fn_firstofmonth(getdate()), dbo.fn_firstofmonth(D.expected_date)) &lt; 12 THEN DATEDIFF(mm,dbo.fn_firstofmonth(getdate()), dbo.fn_firstofmonth(D.expected_date)) + 1 ELSE 13 END AS [Expected Month],     P.probability AS [Category], COUNT(O.id) AS [Customers] FROM opportunity_probability P INNER JOIN opportunity_detail D ON D.probability_id = P.id INNER JOIN opportunities O ON D.opportunity_id = O.id INNER JOIN (     SELECT opportunity_id     FROM opportunity_detail     GROUP BY opportunity_id ) T ON T.opportunity_id = O.customer_id GROUP BY P.probability, MONTH(D.expected_date) ORDER BY  P.probability, MONTH(D.expected_date) </code></pre>  <p>It works if I have D.expected_date in the GROUP BY but I need to group on the MONTH of this date as it does not bring through the data correctly.</p>