<p>I think I posted similar question before. But this time I am struggling with data ID. </p>  <p>My data looks like</p>  <pre><code> date        Stock    value    standard_deviation 01/01/2015    VOD      18       ... 01/01/2015    VOD      15       ... 01/01/2015    VOD       5       ... 03/01/2015    VOD      66       ... 03/01/2015    VOD       7       ... 04/01/2015    VOD      19       ... 04/01/2015    VOD       7       ... 05/01/2015    VOD      3        ... 06/01/2015    VOD      7        ...  .....          ...     ...     ... 01/01/2015    RBS      58       ... 01/01/2015    RBS      445      ... 01/01/2015    RBS      44       ... 03/01/2015    RBS      57       ... </code></pre>  <p>I need to work out the moving average/std deviation <strong>for each stock</strong> based on (-3,+3) trading days.</p>  <p>Since those are trading days (not calendar days), and there are different number of trades in each day, I created a sub-query and applied the following code.</p>  <pre><code>data want; set input; by   date; retain gdate; if first.date then gdate+1; run;  proc sort data=want; by stock gdate ; run;   proc sql; create table want1 as select    h.stock, h.date, h.value, ( select std(s.value) from want s where h.gdate between s.gdate-2 and s.gdate+2) as std from  want h   group  by  stock;   quit; </code></pre>  <p>I tried <code>group  by  stock</code>. However, the code <strong>ignored the stock group and only gave me the moving std of the whole period</strong>. I need the moving std <strong>for different stocks</strong>. </p>  <p>Anyone can give me some idea ? Thanks !</p>