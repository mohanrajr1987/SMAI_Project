<p>Is there a way to remove just the leading and trailing stopwords from a token n-gram?</p>  <p>Currently I have the following combination which removes any n-gram that contains a stopword:</p>  <pre><code>&lt;analyzer type="index"&gt;             &lt;tokenizer class="solr.StandardTokenizerFactory" /&gt;             &lt;filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords.txt" enablePositionIncrements="true" /&gt;             &lt;filter class="solr.LowerCaseFilterFactory" /&gt;             &lt;filter class="solr.ShingleFilterFactory" minShingleSize="2" maxShingleSize="3"                     outputUnigrams="true" outputUnigramsIfNoShingles="false" tokenSeparator=" "/&gt;             &lt;filter class="solr.PatternReplaceFilterFactory" pattern=".*_.*" replacement=""/&gt; &lt;/analyzer&gt; </code></pre>  <p>For example, if my document contains these ngrams: </p>  <p>"Tower of London", "Tower in London", "and London", "London", </p>  <p>with "of, in" as stopwords, the shingle filter will produce:</p>  <p>tower _ london, tower _ london, _ london, london</p>  <p>(note that however the second "tower _ london" is different from the first but this bit of information is lost)</p>  <p>and the pattern filter will then delete the first 3 n-grams.</p>  <p>What I really want to do though is to keep "tower of london", "tower in london", "london", "london".</p>  <p>Is this possible?</p>  <p>Many thanks!</p>