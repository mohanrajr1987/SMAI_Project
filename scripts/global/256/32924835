<p>Together with my team, I am working on a functionality to generate invoice numbers. The requirements says that:</p>  <ul> <li>there should be no gaps between invoice numbers</li> <li>the numbers should start from 0 every year (the together with the year we will have a unique key)</li> <li>the invoice numbers should grow accordinlgy to the time of the creation of the invoices</li> </ul>  <p>We are using php and postgres. We tought to implement this in the following way:</p>  <ul> <li>each time a new invoice is persisted on the database we use a BEFORE INSERT trigger</li> <li>the trigger executes a function that retrieves a new value from a postgres sequence and writes it on the invoice as its number</li> </ul>  <p>Considering that multiple invoices could be created during the same transaction, my question is: is this a sufficiently safe approach? What are its flaws? How would you suggest to improve it?</p>