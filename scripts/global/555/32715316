<p>I would like to add some 'prop' tags under the 'header' section and preserve existing whitespaces. The source XML:</p>  <pre><code>&lt;?xml version="1.0" encoding="utf-16"?&gt; &lt;tmx version="1.4"&gt;    &lt;header creationtool="SDL Language Platform" creationtoolversion="8.0" o-tmf="SDL TM8 Format" datatype="xml" segtype="sentence" adminlang="en-GB" srclang="en-GB" creationdate="20131030T110637Z" creationid="anyvalue"&gt;      &lt;prop type="x-Doc. No.:MultipleString"&gt;&lt;/prop&gt;      &lt;prop type="x-Year:MultiplePicklist"&gt;1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020&lt;/prop&gt;      &lt;prop type="x-Obs.:MultipleString"&gt;&lt;/prop&gt;      &lt;prop type="x-Doc. Type:MultiplePicklist"&gt;anyvalue&lt;/prop&gt;      &lt;prop type="x-Req. Serv.:MultiplePicklist"&gt;any value&lt;/prop&gt;      &lt;prop type="x-Recognizers"&gt;anyvalue&lt;/prop&gt;      &lt;prop type="x-TMName"&gt;anyvalue&lt;/prop&gt; &lt;/header&gt; &lt;body&gt;  &lt;tu creationdate="20150917T131740Z" creationid="anyvalue" changedate="20150917T131740Z" changeid="anyvalue" lastusagedate="20150917T131740Z"&gt;   &lt;tuv xml:lang="en-GB"&gt;     &lt;seg&gt;An &lt;bpt i="1" type="6" x="1" /&gt;increase&lt;ept i="1" /&gt; in &lt;bpt i="2" type="7" x="2" /&gt;advance payments by a total of 7 percentage points&lt;ept i="2" /&gt; in 2015 and 2016 for the funding of the 2014-2020 period.&lt;/seg&gt;   &lt;/tuv&gt;   &lt;tuv xml:lang="fr-FR"&gt;     &lt;seg&gt;une &lt;bpt i="1" type="6" x="1" /&gt;augmentation&lt;ept i="1" /&gt; &lt;bpt i="2" type="7" x="2" /&gt;des avances de 7 points de pourcentage au total&lt;ept i="2" /&gt; en 2015 et 2016 pour le financement de la période 2014-2020.&lt;/seg&gt;   &lt;/tuv&gt;  &lt;/tu&gt; &lt;/body&gt; &lt;/tmx&gt; </code></pre>  <p>The resulting XML should be:</p>  <pre><code>&lt;?xml version="1.0" encoding="utf-16"?&gt; &lt;tmx version="1.4"&gt;    &lt;header creationtool="SDL Language Platform" creationtoolversion="8.0" o-tmf="SDL TM8 Format" datatype="xml" segtype="sentence" adminlang="en-GB" srclang="en-GB" creationdate="20131030T110637Z" creationid="anyvalue"&gt;      &lt;prop type="x-Doc. No.:MultipleString"&gt;&lt;/prop&gt;      &lt;prop type="x-Year:MultiplePicklist"&gt;1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020&lt;/prop&gt;      &lt;prop type="x-Obs.:MultipleString"&gt;&lt;/prop&gt;      &lt;prop type="x-Doc. Type:MultiplePicklist"&gt;anyvalue&lt;/prop&gt;      &lt;prop type="x-Req. Serv.:MultiplePicklist"&gt;any value&lt;/prop&gt;      &lt;prop type="x-Recognizers"&gt;anyvalue&lt;/prop&gt;      &lt;prop type="x-TMName"&gt;anyvalue&lt;/prop&gt;      &lt;prop type="NewProp1"&gt;prop1_val&lt;/prop&gt;      &lt;prop type="NewProp2"&gt;prop2_val&lt;/prop&gt;      &lt;prop type="NewProp3"&gt;prop3_val&lt;/prop&gt;      &lt;prop type="NewProp4"&gt;prop4_val&lt;/prop&gt; &lt;/header&gt; &lt;body&gt;  &lt;tu creationdate="20150917T131740Z" creationid="anyvalue" changedate="20150917T131740Z" changeid="anyvalue" lastusagedate="20150917T131740Z"&gt;   &lt;tuv xml:lang="en-GB"&gt;     &lt;seg&gt;An &lt;bpt i="1" type="6" x="1" /&gt;increase&lt;ept i="1" /&gt; in &lt;bpt i="2" type="7" x="2" /&gt;advance payments by a total of 7 percentage points&lt;ept i="2" /&gt; in 2015 and 2016 for the funding of the 2014-2020 period.&lt;/seg&gt;   &lt;/tuv&gt;   &lt;tuv xml:lang="fr-FR"&gt;     &lt;seg&gt;une &lt;bpt i="1" type="6" x="1" /&gt;augmentation&lt;ept i="1" /&gt; &lt;bpt i="2" type="7" x="2" /&gt;des avances de 7 points de pourcentage au total&lt;ept i="2" /&gt; en 2015 et 2016 pour le financement de la période 2014-2020.&lt;/seg&gt;   &lt;/tuv&gt;  &lt;/tu&gt; &lt;/body&gt; &lt;/tmx&gt; </code></pre>  <p>The problem with my code (.net V4):</p>  <pre><code>    Private Function PatchTMX(ByVal inputtmxfilename As String, ByVal outputfilename As String, ByVal propval1 As String, ByVal propval2 As String, ByVal propval3 As String, ByVal propval4 As string) As Boolean         Dim xmldoc As Xml.XmlDocument         Dim header_node As Xml.XmlNode         Dim rcb As Boolean          Try             xmldoc = New Xml.XmlDocument             xmldoc.XmlResolver = Nothing             xmldoc.PreserveWhitespace = True             xmldoc.Load(inputtmxfilename)              Dim xmlQuery As String             xmlQuery = "/tmx/header"             Dim selNode As XmlNode = xmldoc.SelectSingleNode(xmlQuery)             Dim root As XmlNode = xmldoc.DocumentElement              header_node = GetNodeByName("HEADER", root)              Dim el0_node As Xml.XmlNode             Dim elem0 As XmlElement = xmldoc.CreateElement("prop")             Dim attrib0 As XmlAttribute = xmldoc.CreateAttribute("type")             attrib0.Value = "NewProp1"             elem0.Attributes.Append(attrib0)             elem0.InnerText = propval1             el0_node = header_node.InsertAfter(elem0, selNode.LastChild)              Dim el1_node As Xml.XmlNode             Dim elem1 As XmlElement = xmldoc.CreateElement("prop")             Dim attrib1 As XmlAttribute = xmldoc.CreateAttribute("type")             attrib1.Value = "NewProp2"             elem1.Attributes.Append(attrib1)             elem1.InnerText = propval2             el1_node = header_node.InsertAfter(elem1, selNode.LastChild)              Dim el2_node As Xml.XmlNode             Dim elem2 As XmlElement = xmldoc.CreateElement("prop")             Dim attrib2 As XmlAttribute = xmldoc.CreateAttribute("type")             attrib2.Value = "NewProp3"             elem2.Attributes.Append(attrib2)             elem2.InnerText = propval3             el2_node = header_node.InsertAfter(elem2, selNode.LastChild)              Dim el3_node As Xml.XmlNode             Dim elem3 As XmlElement = xmldoc.CreateElement("prop")             Dim attrib3 As XmlAttribute = xmldoc.CreateAttribute("type")             attrib3.Value = "NewProp4"             elem3.Attributes.Append(attrib3)             elem3.InnerText = propval4             el3_node = header_node.InsertAfter(elem3, selNode.LastChild)              Dim writer As XmlTextWriter = New XmlTextWriter(outputfilename, System.Text.Encoding.UTF8)             writer.Formatting = Formatting.None             writer.Indentation = 1             writer.IndentChar = " "              xmldoc.Save(writer)             writer.Flush()             writer.Close()             xmldoc = Nothing             writer = Nothing              PatchTMX = True         Catch ex As Exception             xmldoc = Nothing             PatchTMX = False         End Try      End Function      Private Function GetNodeByName(node_name As String, xmlnode_info As Xml.XmlNode) As Xml.XmlNode         Dim i As Integer         Dim found_node As Xml.XmlNode = Nothing          For i = 0 To xmlnode_info.ChildNodes.Count - 1             If xmlnode_info.ChildNodes.Item(i).Name.ToLower = node_name.ToLower Then                 found_node = xmlnode_info.ChildNodes.Item(i)             End If         Next          GetNodeByName = found_node      End Function </code></pre>  <p>As it gives a badly formatted XML output (see the inserted props):</p>  <pre><code>&lt;?xml version="1.0" encoding="utf-16"?&gt; &lt;tmx version="1.4"&gt;    &lt;header creationtool="SDL Language Platform" creationtoolversion="8.0" o-tmf="SDL TM8 Format" datatype="xml" segtype="sentence" adminlang="en-GB" srclang="en-GB" creationdate="20131030T110637Z" creationid="anyvalue"&gt;      &lt;prop type="x-Doc. No.:MultipleString"&gt;&lt;/prop&gt;      &lt;prop type="x-Year:MultiplePicklist"&gt;1990,1991,1992,1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018,2019,2020&lt;/prop&gt;      &lt;prop type="x-Obs.:MultipleString"&gt;&lt;/prop&gt;      &lt;prop type="x-Doc. Type:MultiplePicklist"&gt;anyvalue&lt;/prop&gt;      &lt;prop type="x-Req. Serv.:MultiplePicklist"&gt;any value&lt;/prop&gt;      &lt;prop type="x-Recognizers"&gt;anyvalue&lt;/prop&gt;      &lt;prop type="x-TMName"&gt;anyvalue&lt;/prop&gt;    &lt;prop type="NewProp1"&gt;prop1_val&lt;/prop&gt;&lt;prop type="NewProp2"&gt;prop2_val&lt;/prop&gt;&lt;prop type="NewProp3"&gt;prop3_val&lt;/prop&gt;&lt;prop type="NewProp4"&gt;prop4_val&lt;/prop&gt; &lt;/header&gt; &lt;body&gt;  &lt;tu creationdate="20150917T131740Z" creationid="anyvalue" changedate="20150917T131740Z" changeid="anyvalue" lastusagedate="20150917T131740Z"&gt;   &lt;tuv xml:lang="en-GB"&gt;     &lt;seg&gt;An &lt;bpt i="1" type="6" x="1" /&gt;increase&lt;ept i="1" /&gt; in &lt;bpt i="2" type="7" x="2" /&gt;advance payments by a total of 7 percentage points&lt;ept i="2" /&gt; in 2015 and 2016 for the funding of the 2014-2020 period.&lt;/seg&gt;   &lt;/tuv&gt;   &lt;tuv xml:lang="fr-FR"&gt;     &lt;seg&gt;une &lt;bpt i="1" type="6" x="1" /&gt;augmentation&lt;ept i="1" /&gt; &lt;bpt i="2" type="7" x="2" /&gt;des avances de 7 points de pourcentage au total&lt;ept i="2" /&gt; en 2015 et 2016 pour le financement de la période 2014-2020.&lt;/seg&gt;   &lt;/tuv&gt;  &lt;/tu&gt; &lt;/body&gt; &lt;/tmx&gt; </code></pre>  <p>There is certainly a way of correclty outputing the XML !</p>  <p>Thanks, MrJo.</p>