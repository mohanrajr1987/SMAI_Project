<p>I'm using Virtual Box 4.1.40 and the Java API to control it. My code is:</p>  <pre><code>    VirtualBoxManager mgr = VirtualBoxManager.createInstance(null);     String  url = cfg.url;     String  user = cfg.localUsername;     String  passwd = cfg.localPassword;      mgr.connect(url, user, passwd);     IVirtualBox vbox = mgr.getVBox();     IMachine vm = vbox.findMachine(cfg.vmName);     ISession session = mgr.getSessionObject();            IProgress progress= vm.launchVMProcess(session, "headless", "");     progress.waitForCompletion(-1);     // do something on machine     IProgress p = session.getConsole().powerDown();     p.waitForCompletion(-1);      ISnapshot snapshot = vm.findSnapshot("cleanv3");     vm.lockMachine(session, LockType.Write);     ... </code></pre>  <p>But when I try to lock the machine to restore a snapshot after i have powered down the machine I get the following exception:</p>  <pre><code>org.virtualbox_4_1.VBoxException: VirtualBox error: The given session is busy (0x80BB0007) </code></pre>  <p>So, the machine seems to be locked still. Using session.unlock does not help.</p>