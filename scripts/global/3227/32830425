<p>I have a string column in the database that needs to be converted to an array type. The database should not be locked during the process in which I also need to set the indexes.</p>  <pre><code>ALTER TABLE sites ALTER COLUMN rtb_id TYPE varchar[] USING string_to_array(rtb_id, ''); CREATE INDEX CONCURRENTLY rtb_id_search ON sites(rtb_id) USING array_to_string; DROP INDEX CONCURRENTLY ix_sites_bundle_trgm_gin ON sites; DROP INDEX CONCURRENTLY ix_sites_name_trgm_gin ON sites; </code></pre>  <p>Is this the way to do it ?</p>  <p>Edit:</p>  <pre><code>ALTER TABLE sites ADD COLUMN rtb_ids varchar[] ... BEFORE INSERT OR UPDATE ... FOR EACH ROW trigger that sets NEW.rtb_id_new := string_to_array(NEW.rtb_id,' ') for each row. In batches, UPDATE sites SET rtb_id_new = string_to_array(rtb_id,' ') ... VACUUM sites;  CREATE INDEX CONCURRENTLY rtb_ids_search ON sites(rtb_ids) USING array_to_string(rtb_ids, '');  ALTER TABLE sites DROP COLUMN rtb_id;  </code></pre>  <p>Thanks</p>