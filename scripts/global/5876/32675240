<p>My goal is to take an URL of the format</p>  <pre><code>www.mydomain.com(/dir1)?(/dir2)?/(index.php|login.php)((:?\?code=)[a-Z0-9]+)? </code></pre>  <p>Force the browser url change into:</p>  <pre><code>www.mydomain.com/(home|welcomepage)/code/%1/ </code></pre>  <p>a much simplified example would be:</p>  <pre><code> www.mydomain.com/dir1/dir2/index.php?code=khkdh239 </code></pre>  <p>changes to :</p>  <pre><code> www.mydomain.com/home/code/khkdh239/ </code></pre>  <p>and redirects <strong>internally</strong> to </p>  <pre><code> www.mydomain.com/dir1/dir2/index.php?code=khkdh239 </code></pre>  <p>Here is one of many of my attempts;</p>  <pre><code>#RewriteCond %{QUERY_STRING} !^$  # I was experimenting with simple urls, no ?code=.... #RewriteRule .? - [S=2] RewriteRule ^(?:dir1/)?(?:dir2/)?(?:login.php)$ /welcomepage/? [R=301,NC] RewriteRule ^.*welcomepage.*$ code/login.php? [QSA,L] </code></pre>  <p>Observations based on the results of my attempts:</p>  <ol> <li><p>The rule</p>  <pre><code>RewriteRule ^welcomepage/$ code/login.php? [QSA,L] </code></pre>  <p>does not redirect, so I used <code>^.*welcomepage.*$</code>.</p></li> <li><p>The rule</p>  <pre><code>RewriteRule ^(?:dir1/)?(?:dir2/)?(?:login.php)$ /welcomepage/? [R=301,NC,L] RewriteRule ^.*welcomepage.*$ code/login.php? [QSA,L] </code></pre>  <p>Redirects to <code>www.domain.com/welcomepage/</code> but the internal redirection fails.</p></li> <li><p>The rules</p>  <pre><code>RewriteRule ^(?:dir1/)?(?:dir2/)?(?:login.php)$ /welcomepage/? [R=301,NC] RewriteRule ^.*welcomepage.*$ code/login.php? [QSA,L] </code></pre>  <p>redirects to the second link but not to the first.</p></li> <li>I added in the site's configuration a <a href="http://httpd.apache.org/docs/2.2/mod/mod_rewrite.html" rel="nofollow">RewriteLog</a> file setting however it does not seem to work.</li> <li>At some point the redirections were working, however file uploads etc were failing (<code>POST</code> operation).</li> </ol>  <h1>Questions:</h1>  <ol> <li><strong>Does anyone know how to achieve the hidden redirection, without loosing functionality, such as file upload.</strong></li> <li>If not, does anyone know how to setup properly a redirect log, so that I can debug the redirections more efficiently?</li> </ol>  <p>PS: I know there are multiple questions in stack overflow, and I have been going over them as well as through the manual for .htaccess redirection, however there always seems to be some issue.</p>  <p>Thank you all in advance.</p>