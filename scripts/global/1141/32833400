<p>I'm having a problem building a query with Yii2.</p>  <p>Let's say we have four related models: Customer, Order, Orderitem and Orderitempicture.</p>  <p>Order is related to Customer, Orderitem is related to Order, and Orderitempicture is related to Orderitem.</p>  <p>Below is the code:</p>  <pre><code>Customers::find()             -&gt;where(['id' =&gt; $id])             -&gt;with(['orders' =&gt; function($q) {                     $q-&gt;select(['id', 'name', 'customer_id', '(select COUNT(*) from orders where customer_id=order.id) AS thecount'])-&gt;having('thecount &gt; 0');                 }])             -&gt;with(['orders.orderitems' =&gt; function($q) {                     $q-&gt;select(['id', 'name', 'price', 'order_id']);                 }])             -&gt;with(['orders.orderitems.orderitemspictures' =&gt; function($q) {                     $q-&gt;select(['id', 'src_thumb', 'orderitem_id'])-&gt;orderBy("id desc")-&gt;limit(1);                 }])             -&gt;select(['id'])             -&gt;asArray()             -&gt;one(); </code></pre>  <p>This is one of the executed statements from the debugger:</p>  <pre><code>SELECT `id`, `src_thumb`, `orderitem_id` FROM `orderitempicture` WHERE `order_id` IN ('37', '42', '29', '36', '39', '41', '30', '40', '28', '38') ORDER BY `id` DESC LIMIT 1 </code></pre>  <p>Now my problem is in this this line:  <code>$q-&gt;select(['id', 'src_thumb', 'orderitem_id'])-&gt;orderBy("id desc")-&gt;limit(1);</code></p>  <p>What I am trying to do get one orderitempicture for each orderitem, however, what happens is that the SQL to get orderitempictures is merged into one statement, and the limit is applied to that statement, so the result is that I only get ONE orderitempicture for one orderitem, and I get nothing for the rest. </p>  <p>How can I set a limit to get one child for each parent? Is there a way to tell Yii to create multiple queries for each record in the parent and set a limit on that instead of creating one query?</p>