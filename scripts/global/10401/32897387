<p>I am looking for help writing a powershell script that will query Active Directory and output a CSV.</p>  <p>This script will list all groups and all users and signify with a character when a user belongs to that group.</p>  <p>The output will look like this: <a href="https://imgur.com/1MfFv7Q" rel="nofollow">https://imgur.com/1MfFv7Q</a></p>  <p>I've tried using dsquery and various other powershell methods, but none seem to work.</p>  <p>I'm hoping someone here will have a different perspective on this and be able to help out.</p>  <p>Thank you!</p>  <p>Update 1: As requested, here's my code that I was trying to work with previously.</p>  <pre><code>#Get a list of the groups $groups = Get-ADGroup -filter * -Properties Name | Select Name  #iterate through groups array and append each with a comma $output = ForEach ($g in $groups){ $topgroups.Add($g) $topgroups.Add(",") }  #for each group, find out if the user is part of that group $output = ForEach ($g in $groups) {  $results = Get-ADGroupMember -Identity $g.name -Recursive | Get-ADUser -Properties enabled, SamAccountName, givenname, surname,physicalDeliveryOfficeName  ForEach ($r in $results){  New-Object PSObject -Property @{     GroupName = $g.Name     Username = $r.name     DisplayName = $r.displayname   }  } }  $output | Export-Csv -path c:\temp\output.csv -NoTypeInformation </code></pre>