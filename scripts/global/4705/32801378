<p>Why this function return only one, the last element instend all from database? There ar a lot more from diffrent categories:</p>  <p>Function get category id from table "tentego_cat" and search element on "tenteg_img" which has a most records on table "tentego_vote"</p>  <p>Function code: </p>  <pre><code>function bestOfDay($pattern, $where, $currentPage, $objPerPage) {     global $ads, $user, $rewrite, $kernel, $page;     if (!isset($_SESSION['last_cat'])) $_SESSION['last_cat'] = false;     $plugins = $this-&gt;loadPlugins();     $sett = $page;     if (isset($currentPage) &amp;&amp; is_numeric($currentPage) &amp;&amp; $currentPage &gt; 0) {         $page = mysql_real_escape_string($currentPage - 1) * $objPerPage;     }     else $page = 0;     $selectCategory = mysql_query("SELECT tentego_img_cat.* FROM tentego_img_cat");     while ($cat = mysql_fetch_array($selectCategory)) {         $catID = $cat['id'];         $date = date('Y-m-d');         $query = mysql_query("SELECT tentego_img.* FROM tentego_img INNER JOIN tentego_img_vote ON tentego_img.id = tentego_img_vote.object_id WHERE cat =$catID GROUP BY tentego_img_vote.object_id ORDER BY SUM( (CASE WHEN tentego_img_vote.vote = '0' AND tentego_img_vote.date LIKE '" . $date . "%' THEN '1' ELSE '0' END) ) DESC LIMIT 1");         $text = NULL;         $return = NULL;         while ($img = mysql_fetch_array($query)) {             $return.= $ads-&gt;load('#AD[object]#');             $object = null;             $text = preg_replace("/\[object url=(.*)\]/", $object, $pattern);             $shortTitle = $img['title'];             if (strlen($shortTitle) &gt; 200) {                 $shortTitle = mb_substr($shortTitle, 0, 500, 'utf-8') . '&lt;a href="' . $rewrite-&gt;img("#ID#", "#REWRITE-TITLE#") . '" style="color: #0080; font-size: 16px;"&gt;   [...] - PrzejdÅº do wpisu&lt;/a&gt;';             }             else $shortTitle = $shortTitle . '&lt;a href="' . $rewrite-&gt;img("#ID#", "#REWRITE-TITLE#") . '"style="color: #0080; font-size: 16px;"&gt; - PrzejdÅº do wpisu &lt;/a&gt;';             $text = str_replace("#TITLE#", nl2br($shortTitle) , $text);             $text = str_replace("#REWRITE-TITLE#", $rewrite-&gt;changeSigns($img['title']) , $text);             $text = str_replace("#ID#", $img['id'], $text);             // GÅ‚osy             $votes = mysql_query("SELECT SUM(IF(vote=0,1,0)) as votes                                             FROM `tentego_img_vote` WHERE `object_id`=" . $img['id'] . " GROUP BY object_id");             $vote = mysql_fetch_array($votes);             if ($vote['votes'] != 0) {                 $text = str_replace("#VOTE#", $vote['votes'], $text);             }             else {                 $text = str_replace("#VOTE#", '0', $text);             }             $date = new DateTime($img['date']);             $text = str_replace("#DATE#", $date-&gt;format("d.m.y") . ', ' . $date-&gt;format("H:i") , $text);             if ($img['type'] == 'MyÅ›l') {                 // Owner                 if ($img['owner'] != 0) {                     $owner = mysql_fetch_array(mysql_query("SELECT tablicacms_users.user FROM `tablicacms_users` WHERE `id`=" . $img['owner']));                     $owner_name = $owner['user'];                 }                 else {                     $owner_name = "GoÅ›Ä‡";                     $owner['id'] = 0;                 }                 $text = str_replace("#OWNER#", '&lt;a href="' . $rewrite-&gt;user($img['owner'], $rewrite-&gt;changeSigns($owner_name)) . '"&gt;' . $owner_name . '&lt;/a&gt;', $text);                 // Owner Avatat                 if ($img['owner'] != 0) {                     $owner = mysql_fetch_array(mysql_query("SELECT * FROM `tablicacms_users` WHERE `id`=" . $img['owner']));                     $owner_name = $owner['user'];                 }                 else {                     $owner_name = "GoÅ›Ä‡";                     $owner['id'] = 0;                 }                 if ($img['owner'] != 0) {                     $owner = mysql_fetch_array(mysql_query("SELECT * FROM `tablicacms_users` WHERE `id`=" . $img['owner']));                     $owner_name = $owner['user'];                 }                 else {                     $owner_name = "GoÅ›Ä‡";                     $owner['id'] = 0;                     $owner['avatar'] = "upload/avatars/default.png";                 }                 if ($owner['avatar'] != NULL) {                     $owner_avatar = $owner['avatar'];                 }                 else {                     $owner['avatar'] = "upload/avatars/default.png";                 }                 $text = str_replace("#OWNER-AVATAR#", 'http://' . $_SERVER['HTTP_HOST'] . '/' . $owner['avatar'], $text);                 $text = str_replace("#BOOK#", null, $text);             }             else if ($img['type'] == 'Cytat') {                 // Owner                 $owner = mysql_fetch_array(mysql_query("SELECT * FROM `tentego_author` WHERE `id`=" . $img['author']));                 $text = str_replace("#OWNER#", '&lt;a href="' . $rewrite-&gt;author($img['author'], $rewrite-&gt;changeSigns($owner['author'])) . '"&gt;' . $owner['author'] . '&lt;/a&gt;', $text);                 if ($owner['avatar'] != null) {                     $text = str_replace("#OWNER-AVATAR#", 'http://' . $_SERVER['HTTP_HOST'] . '/' . $owner['avatar'], $text);                 }                 else {                     $text = str_replace("#OWNER-AVATAR#", 'http://' . $_SERVER['HTTP_HOST'] . '/                         upload/authors/author.jpeg', $text);                 }                 if ($img['book'] != null) {                     $book = mysql_fetch_array(mysql_query("SELECT * FROM `tentego_content_books` WHERE `id`=" . $img['book']));                     $text = str_replace("#BOOK#", '&lt;a href="' . $rewrite-&gt;book($book['id'], $rewrite-&gt;changeSigns($book['name'])) . '"&gt;' . $book['name'] . '&lt;/a&gt;', $text);                 }                 else {                     $text = str_replace("#BOOK#", null, $text);                 }             }             // MODERATOR #             $text = str_replace("#MOD_TOOLS#", $this-&gt;mod_tools($img) , $text);             // KONIEC MODERATORA #             if ($user-&gt;verifyLogin()) {                 $verify = mysql_num_rows(mysql_query("SELECT * FROM `tentego_img_vote` WHERE `object_id`=" . $img['id'] . " AND `user_id`=" . $user-&gt;userInfo('id')));                 if ($verify) $text = preg_replace('/\[FAV\=(.*)\|(.*)\]/', "$2", $text);                 else $text = preg_replace('/\[FAV\=(.*)\|(.*)\]/', "$1", $text);             }             else $text = preg_replace('/\[FAV\=(.*)\|(.*)\]/', "", $text);             if ($user-&gt;verifyLogin()) {                 $text = str_replace("#NOTES-POPUP#", '&lt;a href="" class="showModal" onClick="addToNote(' . $img['id'] . ',0)"&gt;&lt;i class="book icon"&gt;&lt;/i&gt;&lt;/a&gt;', $text);             }             else $text = str_replace("#NOTES-POPUP#", null, $text);             $cat = mysql_fetch_array(mysql_query("SELECT * FROM `tentego_img_cat` WHERE `id`=" . $img['cat']));             $text = str_replace("#COLOR#", $cat['color'], $text);             $text = str_replace("#CATEGORY#", '&lt;a href="' . $rewrite-&gt;categories($img['cat'], $rewrite-&gt;changeSigns($cat['name'])) . '"&gt;' . $cat['name'] . '&lt;/a&gt;', $text);             $return.= $text;         }     }     if (empty($return)) $return = "&lt;div id=\"display_error\"&gt;" . $kernel-&gt;lang['object']['empty'] . "&lt;/div&gt;";     $page = $sett;     return $return; } </code></pre>