<p>I need to use <code>bulk</code> operations with aggregate in order to delete duplicates with a certain condition in my <code>database</code>. I tried to use <code>rawCollection()</code> but I don't really know how.</p>  <p>Here's the code I need to execute with <code>cron</code> every x hours</p>  <pre><code>function removeDups() {   var count = 0,     collection = Beatmaps.rawCollection(),     bulk = collection.initializeUnorderedBulkOp();   collection.aggregate([     { '$sort': { 'difficultyrating': -1 }},     { '$group': { '_id': '$beatmapset_id', 'ids': { '$push': '$_id' }, 'count': { '$sum': 1 }}},     { '$match': { 'count': { '$gt': 1 }}}   ]).forEach(function(doc) {     doc.ids.shift();     bulk.find({'_id': { '$in': doc.ids }}).remove();     count++;     if(count === 100) {         bulk.execute();         bulk = collection.initializeUnorderedBulkOp();     }   });    if(count !== 0) {     bulk.execute();   } } </code></pre>  <p>but it produces an error: <code>Cannot call method 'forEach' of undefined</code></p>  <p>So what should I do?</p>