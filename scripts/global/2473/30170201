<p>I'm trying to create a unit test for a specific function that returns a given URL from a switch based on a set of params. Everything is fine until the return from url_for. </p>  <p>Here's the returned output:</p>  <pre><code>http:///opt/ipc/bin/phpunit/phpunit/nikon-d7200-review http:///opt/ipc/bin/phpunit/phpunit/nikon-d7200-review http:///opt/ipc/bin/phpunit/phpunit/benq-gw2765-specs http:///opt/ipc/bin/phpunit/phpunit/benq-gw2765-photos-2 http:///opt/ipc/bin/phpunit/phpunit/benq-gw2765-photos-2 http:///opt/ipc/bin/phpunit/phpunit/benq-gw2765-best-deals http:///opt/ipc/bin/phpunit/phpunit/nikon-d7200-user-reviews http:///opt/ipc/bin/phpunit/phpunit/canon-eos-7d-mkii-video-review http:///opt/ipc/bin/phpunit/phpunit/best-mobile-puzzle-games_round-up http:///opt/ipc/bin/phpunit/phpunit/best-mobile-puzzle-games_round-up http:///opt/ipc/bin/phpunit/phpunit/best-mobile-puzzle-games_round-up http:///opt/ipc/bin/phpunit/phpunit/best-mobile-puzzle-games_round-up http:///opt/ipc/bin/phpunit/phpunit/round-ups/laptops http:///opt/ipc/bin/phpunit/phpunit/news/wearables-fitness http:///opt/ipc/bin/phpunit/phpunit/opinions/5-ways-the-humble-light-bulb-is-being-reinvented http:///opt/ipc/bin/phpunit/phpunit/opinions/5-ways-the-humble-light-bulb-is-being-reinvented http:///opt/ipc/bin/phpunit/phpunit/digital-cameras http:///opt/ipc/bin/phpunit/phpunit/cameras http:///opt/ipc/bin/phpunit/phpunit/info/evan-kypreos http:///opt/ipc/bin/phpunit/phpunit/default/vitamix-s30 </code></pre>  <p>As you can see the returning URL has replaced the site URL with a PHUnit version. What I would like is a returned URL that is something more like this:</p>  <pre><code>http://www.somesite.com/nikon-d7200-review http://www.somesite.com/benq-gw2765-specs http://www.somesite.com/benq-gw2765-photos-2 http://www.somesite.com/benq-gw2765-best-deals http://www.somesite.com/nikon-d7200-user-reviews http://www.somesite.com/canon-eos-7d-mkii-video-review http://www.somesite.com/best-mobile-puzzle-games_round-up </code></pre>  <p>I'm using the command line to run my tests.</p>  <p>If you need more information please say i'll do my best to explain further.</p>  <p>The function that is causing the issue is this...</p>  <pre><code>url_for('@round_up?slug=digital_cameras', true); </code></pre>  <p>AND my test script</p>  <pre><code>    class Api2CompositionsHelperTest extends PHPUnit_Framework_TestCase {     public function setUp(){}     public function tearDown() {}      public function testUrlForItemType()     {         if(function_exists('url_for_itemtype')) {              /**              * Create stubs for function. itemType =&gt; params              *              * Params avaliable              * - itemSlug              * - absolute              * - page              * - pageTile              * - itemIndex              * - itemCategoryIdentifier              */             $stub = array(                 'itemType' =&gt; array(                     // TODO: Find out if Preview is even being used.                     // 'preview' =&gt; array(                     //    'itemSlug'  =&gt; '',                     //    'absolute'  =&gt; '',                     //    'page'      =&gt; '',                     //    'pageTile'  =&gt; '',                     //    'itemIndex' =&gt; ''                     //),                     'review' =&gt; array(                         'itemSlug'  =&gt; 'nikon-d7200',                         'pageTitle' =&gt; 'image-quality-performance-and-verdict',                     ),                     'reviews' =&gt; array(                         'itemSlug'  =&gt; 'nikon-d7200',                         'pageTitle' =&gt; 'image-quality-performance-and-verdict',                         'page'      =&gt; 2                     ),                     'review_specs' =&gt; array(                         'itemSlug' =&gt; 'benq-gw2765'                     ),                     'review_photo' =&gt; array(                         'itemSlug'  =&gt; 'benq-gw2765',                     ),                     'review_photos' =&gt; array(                         'itemSlug'  =&gt; 'benq-gw2765',                         'itemIndex' =&gt; 2                     ),                     'review_compareprices' =&gt; array(                         'itemSlug'  =&gt; 'benq-gw2765',                     ),                     // TODO: Check recombu deals are still being used.                     //'review_recombudeals' =&gt; array(                     //    'itemSlug'  =&gt; null,                     //    'absolute'  =&gt; null,                     //    'page'      =&gt; null,                     //    'pageTile'  =&gt; null,                     //    'itemIndex' =&gt; null,                     //    'itemCategoryIdentifier' =&gt; null                     //),                     'review_userreviews' =&gt; array(                         'itemSlug' =&gt; 'nikon-d7200'                     ),                     'review_video' =&gt; array(                         'itemSlug' =&gt; 'canon-eos-7d-mkii'                     ),                     'roundup|roundups|round_up|round_ups' =&gt; array(                         'itemSlug'  =&gt; 'best-mobile-puzzle-games'                     ),                     'round_up_index' =&gt; array(                         'itemSlug' =&gt; 'laptops'                     ),                     'news' =&gt; array(                         'itemSlug' =&gt; 'wearables-fitness'                     ),                     'opinion|opinions' =&gt; array(                         'itemSlug' =&gt; '5-ways-the-humble-light-bulb-is-being-reinvented'                     ),                     'category' =&gt; array(                         'itemSlug' =&gt; 'digital-cameras'                     ),                     'root_category' =&gt; array(                         'itemSlug' =&gt; 'cameras'                     ),                     'author' =&gt; array(                         'itemSlug' =&gt; 'evan-kypreos'                     ),                     'default' =&gt; array(                         'itemSlug' =&gt; 'vitamix-s30'                     )                 )             );              // Loop through             foreach($stub['itemType'] as $itemType =&gt; $params) {                  $itemType = explode('|', $itemType);                  foreach($itemType as $itemType) {                      // Test all params                     $route = url_for_itemtype(                         array_merge(                             array(                                 'itemType' =&gt; $itemType                             ),                             $params                         )                     );                      // Check URL.                     switch($itemType) {                         case 'preview':                             // See above TODO                             break;                         case 'review':                         case 'reviews':                             if(isset($params['page'])) {                                 $pattern = '^www.trustedreviews.com\/([a-zA-Z0-9-]+)review([a-zA-Z-]+)page([-0-9]+)^';                             } else {                                 $pattern = '^http:\/\/www.trustedreviews.com\/([a-zA-Z0-9-]+)-review^';                             }                             break;                         case 'review_specs':                             $pattern = '^http:\/\/www.trustedreviews.com\/([a-zA-Z0-9-]+)specs^';                             break;                         case 'review_photo':                         case 'review_photos':                             if(isset($params['itemIndex'])) {                                 $pattern = '^http:\/\/www.trustedreviews.com\/([a-zA-Z0-9-]+)photos([0-9-]+)^';                             } else {                                 $pattern = '^http:\/\/www.trustedreviews.com\/([a-zA-Z0-9-]+)photos^';                             }                             break;                         case 'review_compareprices':                             $pattern = '^http:\/\/www.trustedreviews.com\/([a-zA-Z0-9-]+)best-deals^';                             break;                         case 'review_recombudeals':                             // See above TODO                             break;                         case 'review_userreviews':                             $pattern = '^http:\/\/www.trustedreviews.com\/([a-zA-Z0-9-]+)user-reviews^';                             break;                         case 'review_video':                             $pattern = '^http:\/\/www.trustedreviews.com\/([a-zA-Z0-9-]+)video-review^';                             break;                         case 'roundup':                         case 'roundups':                         case 'round_up':                         case 'round_ups':                             $pattern = '^http:\/\/www.trustedreviews.com\/([a-zA-Z0-9-]+)_round-up^';                             break;                         case 'round_up_index':                             $pattern = '^http:\/\/www.trustedreviews.com\/round-ups\/([a-zA-Z0-9-]+)^';                             break;                         case 'news':                             $pattern = '^http:\/\/www.trustedreviews.com\/news\/([a-zA-Z0-9-]+)^';                             break;                         case 'opinion':                         case 'opinions':                         $pattern = '^http:\/\/www.trustedreviews.com\/opinions\/([a-zA-Z0-9-]+)^';                             break;                         case 'category':                             $pattern = '^http:\/\/www.trustedreviews.com\/([a-zA-Z0-9-]+)^';                             break;                         case 'root_category':                             $pattern = '^http:\/\/www.trustedreviews.com\/([a-zA-Z0-9-]+)^';                             break;                         case 'author':                             $pattern = '^http:\/\/www.trustedreviews.com\/info\/([a-zA-Z0-9-]+)^';                             break;                         default:                             // TODO: research pattern for default                             $pattern = '^http:\/\/www.trustedreviews.com\/([a-zA-Z0-9-]+)^';                             break;                     }                      // Check pattern matches URL structure                     $this-&gt;assertRegExp($pattern, $route);                 }             }         } else {             $this-&gt;assertFalse(true);         }     } }  </code></pre>  <p>Thanks.</p>