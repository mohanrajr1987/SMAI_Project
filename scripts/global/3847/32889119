<p>IÂ want to add a <code>protobuf</code> message as attachment to a Matroska (mkv) video file <strong>after all video frames have been written without copying the video data</strong>. This must be possible because attaching an arbitrary file to an mkv can be achieved with the MKVToolNix suite (for a JPG):</p>  <pre><code># add attachment, no copy according to man page mkvpropedit out.mkv --add-attachment ~/Downloads/hummingbird.jpg . . # get attachment id mkvmerge -i out.mkv . Attachment ID 1: type 'image/jpeg', size 821740 bytes, file name 'hummingbird.jpg' . # extract attachment mkvextract attachments out.mkv 1:./test.jpg </code></pre>  <p>I want to be capable to perform the same read-write-cycle by calling library methods. Preferably without the need to write the <code>protobuf</code> message to a file first (e.g. by passing a byte array of the serialized <code>protobuf</code> message).</p>  <p>Currently I'm using <code>libav</code> for reading/writing video data from/to mkv. Therefor my favorite solution would also only depend on <code>libav</code>. If this is not possible I would consider introducing <code>libEBML</code> and <code>libMatroska</code> as new dependencies (same as MKVToolNix).</p>  <p>What are the key functions in the frameworks that need to be called to achieve the goal? I'm pretty sure <a href="http://stackoverflow.com/users/507077/moritz-bunkus">mbunkus</a> knows the solution ...</p>