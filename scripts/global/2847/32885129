<p>I have rails app with authorization via <code>devise</code> and <code>omniauth-vk</code>. This is code in <code>omniauth_callbacks_controller.rb</code></p>  <pre><code>Users::OmniauthCallbacksController &lt; Devise::OmniauthCallbacksController def vkontakte binding.pry @user = User.from_omniauth(request.env["omniauth.auth"]) token = request.env["omniauth.auth"]["credentials"]["token"] current_user.token = @vk.token current_user.vk_id = @vk.user_id current_user.save  @vk = VkontakteApi::Client.new(current_user.token)  if @user.persisted?   sign_in_and_redirect @user, :event =&gt; :authentication #this will throw if @user is not activated   set_flash_message(:notice, :success, :kind =&gt; "vkontakte") if is_navigational_format? else   session["devise.vkontakte_data"] = request.env["omniauth.auth"]   redirect_to new_user_registration_url      if request.env["omniauth.auth"].info.email.blank?       redirect_to "/users/auth/vkontakte?auth_type=rerequest&amp;scope=email"     end   end end </code></pre>  <p>I want to tie current authenticated user with his token but I don't know how.  When I test with <code>pry</code> string <code>current_user.token = @vk.token</code> I am having the following exception:</p>  <pre><code> NoMethodError: undefined method `token' for nil:NilClass  from (pry):11:in `vkontakte' </code></pre>