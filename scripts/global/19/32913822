<p>Transforming XML to Excel using XSLT and receiving the below error when attempting to open the resulting XML in Excel. Based on research and the related post <a href="http://stackoverflow.com/questions/12072836/error-exporting-excel-through-xslt">Error : Exporting excel through XSLT</a> the error appears to be due to the row/cell index being incorrect after using MergeDown(). MergeAcross() used without specifying any indexes works just fine for some reason. </p>  <p>I haven't been able to figure out a way to index the rows because the specific cells are merged down a different number depending on a variable value that can be different for each one, so there is no easy way in my xslt to define what the index should be for each row that I've found. Please find the xslt, source xml, and desired xml below. Thanks in advance for any help. </p>  <pre><code>ERROR in ExcelWorkbook description REASON: Bad Value FILE:   results_output.xmlaj GROUP:  Row TAG:    Cell ATTRIB: Index VALUE:  0 </code></pre>  <p><strong>Source XML:</strong></p>  <pre><code>&lt;analysis&gt;  &lt;sample&gt;     &lt;assay name="Bpm" type="presence/absence"&gt;           &lt;amplicon reads="2"&gt;               &lt;significance flag="insufficient breadth of coverage"/&gt;           &lt;/amplicon&gt;       &lt;/assay&gt;      &lt;assay name="Bpm_M" type="presence/absence"&gt;           &lt;amplicon reads="43961"&gt;               &lt;snp&gt;                   &lt;snp_call count="105" percent="100.0"&gt;C&lt;/snp_call&gt;                   &lt;base_distribution C="105"/&gt;               &lt;/snp&gt;               &lt;snp&gt;                   &lt;snp_call count="5016" percent="94.48106988133358"&gt;T&lt;/snp_call&gt;                   &lt;base_distribution C="6" G="287" T="5016"/&gt;               &lt;/snp&gt;               &lt;snp&gt;                   &lt;snp_call count="16833" percent="98.76202769302981"&gt;C&lt;/snp_call&gt;                   &lt;base_distribution A="30" C="16833" G="178" T="2" _="1"/&gt;               &lt;/snp&gt;          &lt;/amplicon&gt;       &lt;/assay&gt;      &lt;assay name="Bpm_1" type="presence/absence"&gt;           &lt;amplicon reads="0"&gt;               &lt;significance flag="no coverage"/&gt;           &lt;/amplicon&gt;       &lt;/assay&gt;  &lt;/sample&gt; &lt;sample&gt;       &lt;assay name="Bpm" type="presence/absence"&gt;           &lt;amplicon reads="0"&gt;               &lt;significance flag="no coverage"/&gt;           &lt;/amplicon&gt;       &lt;/assay&gt;      &lt;assay name="Bpm_M" type="presence/absence"&gt;           &lt;amplicon reads="0"&gt;               &lt;significance flag="no coverage"/&gt;           &lt;/amplicon&gt;       &lt;/assay&gt;      &lt;assay name="Bpm_1" type="presence/absence"&gt;           &lt;amplicon reads="49177"&gt;               &lt;snp&gt;                   &lt;snp_call count="26322" percent="99.90890457754497"&gt;A&lt;/snp_call&gt;                   &lt;base_distribution A="26322" C="14" G="2" T="8"/&gt;               &lt;/snp&gt;               &lt;snp&gt;                   &lt;snp_call count="46825" percent="99.95303861506606"&gt;T&lt;/snp_call&gt;                   &lt;base_distribution A="1" C="4" G="17" T="46825"/&gt;               &lt;/snp&gt;           &lt;/amplicon&gt;        &lt;/assay&gt;  &lt;/sample&gt; &lt;/analysis&gt; </code></pre>  <p><strong>XSLT:</strong></p>  <pre><code>&lt;Table&gt;                     &lt;Column ss:AutoFitWidth="0" ss:Width="210" /&gt;                      &lt;Row&gt;                             &lt;Cell&gt;                                     &lt;Data ss:Type="String"&gt;                                     &lt;/Data&gt;                             &lt;/Cell&gt;                     &lt;/Row&gt;                     &lt;Row ss:AutoFitHeight="0" ss:Height="18"&gt;                             &lt;Cell&gt;                                     &lt;Data ss:Type="String"&gt;                                     &lt;/Data&gt;                             &lt;/Cell&gt;                              &lt;Cell ss:MergeAcross="count(//analysis/sample[position()=1]/assay) - 1"&gt;                                     &lt;Data ss:Type="String"&gt;Distro                                                        &lt;/Data&gt;                             &lt;/Cell&gt;                     &lt;/Row&gt;                     &lt;Row ss:AutoFitHeight="0" ss:Height="18"&gt;                              &lt;Cell&gt;                                     &lt;Data ss:Type="String"&gt;Sample Name                                                       &lt;/Data&gt;                             &lt;/Cell&gt;                      &lt;xsl:for-each select="//sample[position()=1]/assay"&gt;                               &lt;Cell&gt;                                     &lt;Data ss:Type="String"&gt;                                         &lt;xsl:value-of select="@name" /&gt;                                                  &lt;/Data&gt;                             &lt;/Cell&gt;                      &lt;/xsl:for-each&gt;                      &lt;/Row&gt;              &lt;xsl:for-each select="//analysis/sample"&gt;                      &lt;Row&gt;                          &lt;xsl:variable name="max"&gt;                             &lt;xsl:for-each select="assay"&gt;                                 &lt;xsl:sort select="count(amplicon/snp)" data-type="number" order="descending"/&gt;                                 &lt;xsl:if test="position() = 1"&gt;&lt;xsl:value-of select="count(amplicon/snp)"/&gt;&lt;/xsl:if&gt;                             &lt;/xsl:for-each&gt;                         &lt;/xsl:variable&gt;                           &lt;xsl:choose&gt;                             &lt;xsl:when test="$max &amp;gt; 0"&gt;                                  &lt;Cell ss:MergeDown="{$max - 1}"&gt;                                         &lt;Data ss:Type="String"&gt;                                             &lt;xsl:value-of select="@name" /&gt;                                         &lt;/Data&gt;                                 &lt;/Cell&gt;                              &lt;/xsl:when&gt;                             &lt;xsl:otherwise&gt;                                  &lt;Cell&gt;                                         &lt;Data ss:Type="String"&gt;                                             &lt;xsl:value-of select="@name" /&gt;                                         &lt;/Data&gt;                                 &lt;/Cell&gt;                              &lt;/xsl:otherwise&gt;                         &lt;/xsl:choose&gt;                      &lt;/Row&gt;              &lt;/xsl:for-each&gt; &lt;/Table&gt; </code></pre>  <p><strong>Desired XML:</strong> </p>  <pre><code>&lt;Table&gt;      &lt;Column ss:AutoFitWidth="0" ss:Width="210"/&gt;      &lt;Row&gt;         &lt;Cell&gt;            &lt;Data ss:Type="String"/&gt;         &lt;/Cell&gt;      &lt;/Row&gt;      &lt;Row ss:AutoFitHeight="0" ss:Height="18"&gt;         &lt;Cell&gt;            &lt;Data ss:Type="String"/&gt;         &lt;/Cell&gt;         &lt;Cell ss:StyleID="s22" ss:MergeAcross="2"&gt;            &lt;Data ss:Type="String"&gt;Dist                              &lt;/Data&gt;         &lt;/Cell&gt;      &lt;/Row&gt;      &lt;Row ss:AutoFitHeight="0" ss:Height="18"&gt;         &lt;Cell&gt;            &lt;Data ss:Type="String"&gt;Sample Name&lt;/Data&gt;         &lt;/Cell&gt;         &lt;Cell&gt;            &lt;Data ss:Type="String"&gt;Bpm&lt;/Data&gt;         &lt;/Cell&gt;         &lt;Cell&gt;            &lt;Data ss:Type="String"&gt;Bpm_M&lt;/Data&gt;         &lt;/Cell&gt;         &lt;Cell&gt;            &lt;Data ss:Type="String"&gt;Bpm_1&lt;/Data&gt;         &lt;/Cell&gt;      &lt;/Row&gt;      &lt;Row&gt;         &lt;Cell ss:MergeDown="2"&gt;            &lt;Data ss:Type="String"&gt;Sample 1&lt;/Data&gt;         &lt;/Cell&gt;      &lt;/Row&gt;      &lt;Row&gt;         &lt;Cell ss:MergeDown="1"&gt;            &lt;Data ss:Type="String"&gt;Sample 2&lt;/Data&gt;         &lt;/Cell&gt;      &lt;/Row&gt; &lt;/Table&gt; </code></pre>