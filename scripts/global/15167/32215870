<p><strong>Sales Table structure productId,courierId are (unique constrain)</strong></p>  <p>I have the problem with Nhibernate and SqlServer like this. There are two concurrent transactions trying to insert data in the Sales Table. Both transactions(user1-Transaction1,user2-Transaction2) query the data in table to check if the new productId,courierId to insert does not appear in the table.</p>  <p>The problem is that let say. </p>  <ul> <li>Transaction1 and Transaction2 read Sales Table and found that there is no productId(321),courierId(763) in Sales Table. </li> <li>Then Transaction2 trying to insert productId(321),courierId(763) in Sales table while Transaction1 has been inserted productId(321),courierId(763) and committed Sales in table already.</li> </ul>  <p><strong>Therefore Transaction2 get exception for unique constrain.</strong></p>  <p>I would like to make Transaction2(user2) data should be update instead of throwing unique constrain exception.</p>  <p>And my Nhibernate function is as below</p>  <pre><code>   public T SaveOrUpdate(T entity)     {         using (var tx = _session.BeginTransaction())         {             try             {                 var merged = Session.Merge(entity);                      Session.SaveOrUpdate(merged);                 tx.Commit();                 return merged;             }             catch (HibernateException)             {                 tx.Rollback();                 throw;             }         }     } </code></pre>  <p>Please help me to solve this problem, any ideas or article that may be useful.</p>