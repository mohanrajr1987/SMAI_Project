<p>I have a T-SQL function that will pull all records inserted into a main table within the last 60 minutes and insert them into a table variable. I've then got some more code that will filter that set into another table variable to be returned.</p>  <p>In this set I'm expecting some records to have multiple occurrences but they will have a unique date time. <strong>I would like to delete every record that has greater than or equal to 3 occurrences, but keep the one with the most recent datetime value.</strong></p>  <p>So far I've set up a CTE that manages to delete all the records with a count greater than or equal to 3, but this does not leave the record with the most recent occurrence.</p>  <pre><code>WITH cte AS  (     SELECT          ColA, ColB,          /*DateTimeColumn,*/          ColC,          ROW_NUMBER() OVER (PARTITION BY ColA, ColB, /*DateTimeColumn,*/ ColC ORDER BY ColA /*,DateTimeColumn*/) AS r_count     FROM          @table_variable_2 ) DELETE FROM cte WHERE          r_count &gt;= 3 -- I think I need an AND NOT IN subquery here </code></pre>  <p>EDIT: Sorry, I thought I was more clear than it appears I actually was.</p>  <p>This data is error log data from a legacy system, so duplicates can be expected. The idea is that if they cross a certain threshold they need to be reported.</p>  <p>For example, the below is what should end up in <code>@table_variable_2</code>:</p>  <pre><code>   |   ColA  |  ColB |      DateTimeColumn      | ColC |    --------------------------------------------------- 1  |    A    |   B   |  2015-08-24 11:06:14.000 |  C   | 2  |    A    |   B   |  2015-08-24 11:18:58.000 |  C   | 3  |    A    |   B   |  2015-08-24 12:07:45.000 |  C   | 4  |    A2   |   B2  |  2015-08-24 12:17:24.000 |  C2  | 5  |    A2   |   B2  |  2015-08-24 13:25:32.000 |  C2  | 6  |    A3   |   B3  |  2015-08-24 14:52:10.000 |  C3  | 7  |    A3   |   B3  |  2015-08-24 14:52:34.000 |  C3  | 8  |    A3   |   B3  |  2015-08-24 14:52:45.000 |  C3  | 9  |    A3   |   B3  |  2015-08-24 14:53:15.000 |  C3  | 10 |    A3   |   B3  |  2015-08-24 14:53:32.000 |  C3  | </code></pre>  <p>This is what I expect to be returned:</p>  <pre><code>   |   ColA  |  ColB |      DateTimeColumn      | ColC |    --------------------------------------------------- 1  |    A    |   B   |  2015-08-24 12:07:45.000 |  C   | 2  |    A2   |   B2  |  2015-08-24 12:09:35.000 |  C2  | 3  |    A2   |   B2  |  2015-08-24 13:25:32.000 |  C2  | 4  |    A3   |   A3  |  2015-08-24 14:53:32.000 |  C3  | </code></pre>  <p>It's okay to have some duplicates, there's just the chance of having a lot of them.</p>