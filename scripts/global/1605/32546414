<p>I am currently trying to profile MongoDB.</p>  <p>I am currently constrained in the tools that I have at my discretion, as I do not have kernel access and have to wait for some tools to be installed.</p>  <p>I am using <code>oprofile</code> (as it is what is currently available) to profile a set of queries.</p>  <p>Here are the top of some profiles:</p>  <pre><code>Counted CPU_CLK_UNHALTED events (Clock cycles when not halted) with a unit mask of 0x00 (No unit mask) count 90000 samples  %        image name               symbol name 2423     46.1788  no-vmlinux               /no-vmlinux 410       7.8140  mongod                   deflate_fast 355       6.7658  mongod                   longest_match 237       4.5169  mongod                   compress_block 174       3.3162  libc-2.19.so             memset  Counted CPU_CLK_UNHALTED events (Clock cycles when not halted) with a unit mask of 0x00 (No unit mask) count 90000 samples  %        image name               symbol name 2362     45.8908  no-vmlinux               /no-vmlinux 426       8.2767  mongod                   deflate_fast 367       7.1304  mongod                   longest_match 241       4.6823  mongod                   compress_block 169       3.2835  libc-2.19.so             memset  Counted CPU_CLK_UNHALTED events (Clock cycles when not halted) with a unit mask of 0x00 (No unit mask) count 90000 samples  %        image name               symbol name 1860     73.8388  no-vmlinux               /no-vmlinux 102       4.0492  mongod                   __evict_clear_all_walks 63        2.5010  mongod                   mongo::Listener::initAndListen() 48        1.9055  libc-2.19.so             __libc_disable_asynccancel 40        1.5879  libc-2.19.so             __select_nocancel  34        1.3497  mongod                   __evict_clear_walk </code></pre>  <p>As you can see, the overwhelming majority of time is spent in <code>/no-vmlinux</code> (the kernel). Again, I can't run oprofile with kernel privileges, so I can't get any more in depth than that.</p>  <p>Does anybody have any idea why this might be happening? My first instinct was that it was doing system calls -- mainly I/O work -- but running iostats shows that it spends less than 3% of the time doing I/O work. All I/O is done within the first second, and the query runs for over 30.</p>  <p>My other idea is read/write locks. However, that seems like a <em>huge</em> waste, as this is just a single instance system.</p>  <p>Does anybody else have any insights on why <code>mongod</code> might spend so much time in the kernel? FWIW, when <code>mongod</code> is idle (no queries) for about 30 seconds, <code>/no-vmlinux</code> still accounts for ~80% of all samples.</p>  <p>Thanks!</p>