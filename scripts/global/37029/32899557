<p>I wrote my own script for APNS access in PHP.</p>  <p>Everything looked OK although I didn't receive the push notification.  I figured maybe the device token was somehow invalid.  But then I realized I'd been forgetting to close the stream socket.  So I added the line to close the socket.  And it inevitably warns me that it's not a valid socket resource as if the socket got closed somehow.  So now I'm wondering if the reason I'm not receiving the push notification may be because it didn't really succeed in getting written all the way to the SSL address.</p>  <p>Does anyone know why the sock_close fails and why my $apns is suddenly not a valid resource?  Notice how many other error checks I have that do not get triggered.</p>  <pre><code>// Open the gateway $apnsHost = 'gateway.sandbox.push.apple.com'; $apnsPort = 2195; $apnsCert = ROOT.DS.'apns-dev-cert.pem'; $apnsCa = ROOT.DS.'entrust_2048_ca.cer'; if (!file_exists($apnsCert) or !file_exists($apnsCa)) {     $resultCode = -3;     $resultMsg = "pem or cer file not found: $apnsCert, a$pnsCa";     $this-&gt;set(compact('resultCode','resultMsg'));     return;             }  $streamContext = stream_context_create(); stream_context_set_option($streamContext, 'ssl', 'local_cert', $apnsCert); stream_context_set_option($streamContext, 'ssl', 'cafile', $apnsCert);  $apns = stream_socket_client('ssl://' . $apnsHost . ':' . $apnsPort, $error, $errorString, 2, STREAM_CLIENT_CONNECT, $streamContext); if (is_null($apns) or !$apns or $error != 0) {     $resultCode = -4;     $resultMsg = "stream_socket_client failed: ".$errorString;     $this-&gt;set(compact('resultCode','resultMsg'));     return; }  // Now write the data if (($bytesWritten = fwrite($apns, $apnFrameBinary)) != $apnFrameLength) {     $resultCode = -4;     $resultMsg = "fwrite wrote $bytesWritten of $apnFrameLength bytes";     $this-&gt;set(compact('resultCode','resultMsg'));     fclose($apns);     return; }  // Now check for an error response $apnCommResult = fread($apns, 6); if ($apnCommResult) {     $resultCode = -5;     $resultMsg = "Received error response from APN";     $this-&gt;set(compact('resultCode','resultMsg'));     socket_close($apns);     fclose($apns);     return; } socket_close($apns);   // WARNING socket_close supplied resource is not a valid Socket resource if (!fclose($apns)) {     $resultCode = -6;     $resultMsg = "fclose failed";     $this-&gt;set(compact('resultCode','resultMsg'));     return; } $resultCode = $bytesWritten; $resultMsg = "Success"; $this-&gt;set(compact('resultCode','resultMsg')); </code></pre>