<p>We are trying to apply an overlay on a series of images before merging them into one. Right now it seems imagemagick is converting the image to the color applied instead of applying an overlay. The docs are not very clear as to what we should be doing differently. I'd appreciate if you have any insight on this. Code follows:</p>  <pre><code>def self.concatenate_images (source, image)   height = FastImage.size(image.url)[0]   width = FastImage.size(image.url)[1]    source = source.first   source = source.resize_to_fill(height, width).quantize(256, Magick::GRAYColorspace).contrast(true)    User.color_variant.each_slice(3).with_index do |slice,variant_index|    slice.each_with_index do |color,color_index|                     colored = Magick::Image.new(height, width) { self.background_color = color.keys[0]}     colored.composite!(source.negate, 0, 0, Magick::CopyOpacityCompositeOp)      colored.write("#{User.get_img_path}#{color.values[0]}.png")      if variant_index == 2 &amp;&amp; color_index == 0       system "convert #{User.get_img_path}#{slice[0].values[0]}.png #{image.url} +append #{User.get_img_path}#{slice[0].values[0]}.png"     end      if color_index!=0 &amp;&amp; variant_index != 3       system "convert #{User.get_img_path}#{slice[0].values[0]}.png #{User.get_img_path}#{slice[color_index].values[0]}.png +append #{User.get_img_path}#{slice[0].values[0]}.png"     end   end   end </code></pre>