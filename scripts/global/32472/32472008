<p>I have a small <code>VC++</code> code to load an ASN.1 <code>.der</code> file and read its <code>private</code> key. It compiles and runs fine, but it crashes at function <code>d2i_RSAPrivateKey_fp</code>. </p>  <p><strong>Tools Used:</strong></p>  <ul> <li>Visual Studio 2008 [V90]</li> <li>OpenSSL 1.0.2d 9 Jul 2015</li> </ul>  <p>I have also tested the certificate to check if it was corrupted </p>  <p><strong>Testing certificate:</strong></p>  <pre class="lang-none prettyprint-override"><code>C:\OpenSSL-Win32\bin&gt;openssl rsa -in  private.der -check -inform DER RSA key ok writing RSA key -----BEGIN RSA PRIVATE KEY----- MIICXAIBAAKBgQC/4V4jxRYeFBDh8XBNq2EMs3hXWW5IIN51lM/Oyz0U/Bw8HF0m /VBJU3SCy2FzoYPa2o3HHYWDMnjmOlXb9aXR3hyLHnvgvE/0YkMXlxh58H1srjw4 FL7cLXe+lwFbZYtxRaHyn/3U3NIkZkCzR74oxHwyWJ1/zz+TzpmNx8AfyQIDAQAB AoGAMn+9puxXxdLCHrTMOaTBBfa11UdUHueHpKplhqc2jC9NvwQ3/+rrFmFAaKve GfCIIzEh3yWF3eGKsAzqS9l6qiyAT+LaCPcn7FbAsaMdVGPc4G290/3maASjQMj6 YfNTcmvPaqfq2+B+aNunS0pi6XGv3917KdGo4hTa2xFXwAECQQDfm5Rh0CjDwhjh urghbvBgGVRJiAFowgp9xdJj8Hm/U+zXK9Tz2SwVcbEKbcqSVZqB8Keb11TEfF3W JGIHGdOJAkEA260wKNAdWxgEXiSCEx/tSV3bcRQg4ypTqODc0cWtM295/lhV2Hgx 3zWQ5NiBYZsU104DLWlxnqulJKyBECmaQQJAFAjskpcEEAYkFJWWSeiWwQWD99Kn zasVJY/D+hBh2DK81cqnmfGrcYBuTHDp5ZKl9V6Kpfv1LGW4Qqef4OL/gQJAb1Mp IMW22r8lF4Bw2rhHS/LgjkGhGP4OP3sU7Mm8qGBJ9ndVqcnfnDpNH2wIxSoOOb4z JgRVrA9YNWmmTkaHAQJBANiY3RDyEouYoNKN0oWXsZ/N6BwSFOYAAknmdY5uRwu2 tUQHFiW7u2wZCFmIZVqSBZc5XBdZcmffZeEiO1nVYH4= -----END RSA PRIVATE KEY-----  C:\OpenSSL-Win32\bin&gt; </code></pre>  <p>Below is the code for the project.</p>  <p><strong>Thing I have tried</strong>:</p>  <ul> <li>Win32OpenSSL-0_9_8zg (but same issue), OpenSSL 1.0.1</li> <li>Tried linking libeay to MD, MDd, MT</li> <li>Set flags to Generate /MAP, /MAPINFO:EXPORTS ,/ASSEMBLYDEBUG</li> <li>exported to VS2010 project and compiled with openssl32 for VS2010</li> </ul>  <pre class="lang-c prettyprint-override"><code>#include &lt;stdio.h&gt; #include &lt;conio.h&gt; #include &lt;string.h&gt; #include &lt;openssl/rsa.h&gt; #include &lt;openssl/x509.h&gt; #include &lt;openssl/err.h&gt; #include &lt;stdio.h&gt;  int main() {     int ret;     RSA *pkey=NULL;//RSA_new();     RSA *rsa =NULL;//RSA_new();      unsigned char text[2048/8] = "this is a test string";     unsigned char  encrypted[4098]={};     unsigned char decrypted[4098]={};      OpenSSL_add_all_algorithms();        OpenSSL_add_all_ciphers();       OpenSSL_add_all_digests();       ERR_load_ERR_strings();      FILE *fp;     fp = fopen("C:/Users/Public/private.der","rb");      if (fp != NULL)      {         rsa = d2i_RSAPrivateKey_fp(fp, &amp;pkey);   // &lt;&lt;&lt; CRASH     }     else     {         //return "Error::Unable to read private key file";     }      if (rsa)     {         // RSA is good         ret = RSA_private_encrypt(RSA_size(pkey), text, encrypted, pkey, RSA_NO_PADDING);         if (ret == -1)         {             fclose(fp);             //return "Error::Failed to encrypt the data";         }     }     else     {         fclose(fp);         //return "Error::Failed to get *RSA Handle1";     }     fclose(fp); } </code></pre>  <hr>  <p><strong>Second attempt</strong></p>  <p>I am facing issue with importing private key from ASN.1 <code>.der</code> file to a <code>.pem</code> file.</p>  <pre class="lang-none prettyprint-override"><code>C:\OpenSSL-Win32\bin&gt;openssl rsa -in private.der -inform DER -out privatepem.pem -outform PEM   writing RSA key </code></pre>  <p>Now, I have .PEM file which have private key in Base64 Form which i will convert it to RSA *rsa; structure.</p>  <pre class="lang-c prettyprint-override"><code>int main() {     int ret;     RSA *pkey=NULL;//RSA_new();     RSA *rsa =NULL;//RSA_new();      FILE *fp;     fp = fopen("C:/Users/Public/privatepem.pem","r");      if(PEM_read_RSAPrivateKey(fp, &amp;rsa, NULL, NULL) == NULL)  // &lt;&lt;&lt;CRASH     {         printf("\n%s\n", "Error Reading public key");     }     else     {         printf("\n%s\n", "Private key Imported");     }      return 0; } </code></pre>  <p>But the new code operating on <code>.pem</code> files has a crash while copying to RSA structure at <code>PEM_read_RSAPrivateKey</code>.</p>  <p>Why am I getting the crash? Is there something I am missing to do, may be initialization of some sort or something wrong with the key?</p>