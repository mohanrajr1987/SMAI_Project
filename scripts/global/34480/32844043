<p>I have following application model with temporal network: Kpi can have single Metric connected. </p>  <p>I want to achieve following logic using single query:</p>  <ol> <li>If kpi has already metric connected and old metric id = new metric id, then do nothing</li> <li>If kpi has already metric connected and old metric id &lt;> new metric id, then terminate previous connection (oldMetric.to = {now}) and create new connection between kpi and metric</li> <li>If kpi doesn't have any metric connected, connect new metric.</li> </ol>  <p>In other words: break existing connection if exists, and create new one (+ do nothing when new connection equals to previous)</p>  <p>Here is my cypher:</p>  <pre><code>match (kpi:KpiIN)   where id(kpi) = {kpiId}   optional match (kpi)-[currentRel:Indicates]-&gt;(currentMetric:MetricIN)   where currentRel.to = {maxTime}   optional match (newMetric:MetricIN)   where id (newMetric) = {metricId}   with kpi, currentMetric, newMetric, currentRel   where COALESCE(id(currentMetric), -1) &lt;&gt; id(newMetric)   foreach (toTerminate in  [x IN [currentRel] where x is not null] | set toTerminate.to = {now} )  create (kpi)-[:Indicates {props} ]-&gt;(newMetric) </code></pre>  <p>Any option to make this query easier - especially foreach part where I actually check for null in current metric node. </p>